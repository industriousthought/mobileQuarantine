(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
var events = require('./events.js');
var Character = require('./character.js');

module.exports = function(options) {

    var player = Character({
        pos: options.pos,
        type: 'player',
        mode: 'standing',
        modes: {
            die: function() {
                events.emit('die');
            },
            standing: function() {
                player.pose.y = 0;
                player.velocity = 0;
            },
            running: function() {

            },
            walking: function() {

            },
            shooting: function() {
                player.pose.y = 1;
                if (player.currentWeapons.length === 0) return;
                var coolDown = player.currentWeapons[player.weilding].coolDown;
                var tick = coolDown - 1;
                player.addEffect(function() {
                    if (player.currentMode !== 'shooting') return false;
                    tick++;
                    if (tick > coolDown) { 
                        player.currentWeapons[player.weilding].use();
                        tick = 0;
                    }
                    return true;
                });
            }
        },

        collide: function(collider) {
            switch (collider.base) {
                case 'weapon':
                    if (!collider.inContainer()) player.takeItems(collider);
                    break;

            }

            switch (collider.type) {
                case 'zombie':
                    events.emit('gameOver');
                    console.log('gameoverrrrrr');
                    //player.health -= 0.4;
                    break;
            }

        }
        
    });
    player.nextWeapon = function() {
        player.weilding++;
        if (weilding === player.currentWeapons.length) weilding = 0;
    };
    player.weilding = 0;
    player.addEffect(function() {
        player.currentWeapons = player.getInventoryByBase('weapon');
        player.currentWeapons.forEach(function(weapon, index) {
            if (weapon.selectWeapon) player.weilding = index;
        });
        return true;
    });


    return player;
};

},{"./character.js":6,"./events.js":11}],2:[function(require,module,exports){
var Character = require('./character.js');

module.exports = function(options) {

    var currentAttractor = false;
    var speed = 1 + Math.random() * 3;

    var zombie = Character({
        type: 'zombie',
        mode: 'wandering',
        pos: options.pos,
        modes: {
            rewandering: function() {
                zombie.addMode('wandering');
            },
            wandering: function() {
                //console.log('wandering');
                //if (Math.random() < 0.05) zombie.audio = 'growl';
                var timeLength = 1 + parseInt(Math.random() * 3 * 1000);
                var startTime = Date.now();
                var randomSpeed = Math.random() * 2;
                zombie.pos.rot = Math.random() * Math.PI * 2;
                zombie.pose.y = 1;

                zombie.addEffect(function() {
                    var now = Date.now();
                    if (zombie.currentMode !== 'wandering') {
                        return false;
                    }
                    if (startTime + timeLength < now) {
                        zombie.addMode('rewandering');
                        return false; 
                    }
                    zombie.push({x: Math.cos(zombie.pos.rot) * randomSpeed, y: Math.sin(zombie.pos.rot) * randomSpeed});
                    return true;
                });
            },
            searching: function() {
            },
            chasing: function() {
                zombie.addEffect(function() {
                    var theta = zombie.lookAtObj(currentAttractor);
                    if (zombie.currentMode !== 'chasing' || !currentAttractor) {
                        return false;
                    }
                    zombie.push({x: Math.cos(theta) * speed / 2, y: Math.sin(theta) * speed / 2});
                    return true;
                });
            },
            running: function() {
            },
            biting: function() {
            },
            staggering: function() {
            },
            die: function() {
                zombie.unload();
            }
        },
        collide: function(collider) {
            switch (collider.type) {
                case 'bullet':
                case 'meelee':
                    zombie.health -= collider.power / 100;
                    break;
            }
        }
    });

    zombie.step(function() {
        currentAttractor = world.getItemsByType('player')[0];
        if (currentAttractor) {
            zombie.addMode('chasing');
        } else {
            zombie.addMode('wandering');
        }
    });

    return zombie;
};

},{"./character.js":6}],3:[function(require,module,exports){
(function() {
    var lastTime = 0;
    var vendors = ['ms', 'moz', 'webkit', 'o'];
    for(var x = 0; x < vendors.length && !window.requestAnimationFrame; ++x) {
        window.requestAnimationFrame = window[vendors[x]+'RequestAnimationFrame'];
        window.cancelAnimationFrame = window[vendors[x]+'CancelAnimationFrame'] 
            || window[vendors[x]+'CancelRequestAnimationFrame'];
    }

    if (!window.requestAnimationFrame)
        window.requestAnimationFrame = function(callback, element) {
            var currTime = new Date().getTime();
            var timeToCall = Math.max(0, 16 - (currTime - lastTime));
            var id = window.setTimeout(function() { callback(currTime + timeToCall); }, 
                                       timeToCall);
                                       lastTime = currTime + timeToCall;
                                       return id;
        };

        if (!window.cancelAnimationFrame)
            window.cancelAnimationFrame = function(id) {
                clearTimeout(id);
            };
}());

},{}],4:[function(require,module,exports){
var getId = require('./getId.js').getId;


module.exports = function() {
    var pushEvents = [];
    var moveEvents = [];
    var loadEvents = [];
    var unloadEvents = [];
    var stepEvents = [];
    var loaded = false;
    var moved = false;
    var newEffects = [];
    var effects = [];
    var obj = {
        inContainer: function() {
            return (!!obj.owner);
        },
        load: function() {
            var args = [].slice.call(arguments);
            if (args.length) {
                if (loaded) {
                    args.forEach(function(e) { e(); });
                } else {
                    loadEvents = args.concat(loadEvents);
                }
                return;
            }
            if (!loaded) {
                loadEvents.forEach(function(e) { e(); });
                loaded = true;
            }
        },
        unload: function() {
            var args = [].slice.call(arguments);
            if (args.length > 0) return unloadEvents = args.concat(unloadEvents);
            unloadEvents.forEach(function(e) { e(); });
            world.deleteItem(obj.id);
            if (obj.owner) obj.owner.dropItem(obj);
        },
        step: function() {
            var args = [].slice.call(arguments);
            if (args.length > 0) return stepEvents = args.concat(stepEvents);
            stepEvents.forEach(function(e) { e(); });
            effects = effects.concat(newEffects);
            newEffects = [];
            effects = effects.filter(function(item) { return item.call(obj); });
            if (moved) obj.processMovementEvents();
            if (obj.pos.rot > Math.PI * 2) obj.pos.rot -= Math.PI * 2;
            if (obj.pos.rot < 0) obj.pos.rot += Math.PI * 2;

        },
        processMovementEvents: function() {
            obj.velocity = Math.sqrt(obj.pos.vec.x * obj.pos.vec.x + obj.pos.vec.y * obj.pos.vec.y);
            if (obj.velocity > 30) {
                //debugger;
                obj.pos.vec.x = obj.pos.vec.x / (obj.velocity / 30);
                obj.pos.vec.y = obj.pos.vec.y / (obj.velocity / 30);
                obj.velocity = 30;
            }
            obj.pos.x += obj.pos.vec.x;
            obj.pos.y += obj.pos.vec.y;
            if (obj.owner) {
                obj.move(obj.owner.pos);
            }
            obj.pos.vec.x = 0;
            obj.pos.vec.y = 0;
            moveEvents.forEach(function(fn) { fn(); });
            moved = false;
        },
        id: getId(),
        pos: {
            x: 0,
            y: 0,
            rot: 0,
            vec: {
                x: 0,
                y: 0
            }
        },
        move: function(pos) {
            if (pos.ev) {
                moveEvents.push(pos.ev);
            }
            if (pos.x) obj.pos.x = pos.x;
            if (pos.y) obj.pos.y = pos.y;
            if (pos.rot) obj.pos.rot = pos.rot;
            moved = true;
        },
        push: function(vec) {
            if (vec.ev) {
                moveEvents.push(vec.ev);
            }
            if (vec.x) obj.pos.vec.x += vec.x;
            if (vec.y) obj.pos.vec.y += vec.y;
            moved = true;
        },
        addEffect: function(fn) {
            newEffects.push(fn);
        }
    };


    return obj;
};


},{"./getId.js":14}],5:[function(require,module,exports){
var projectile = require('./projectile.js');
var makeSolid = require('./makeSolid.js');

var Bullet = function(options) {

    var bullet = projectile();

    bullet.fire = function(pos) {
        var distance = 0;
        var theta = pos.rot;
        bullet.inertia = true;
        bullet.pos.rot = pos.rot;
        bullet.onTop = true;
        bullet.velocity = 25;
        makeSolid(bullet);
        bullet.step(function() {
            if (bullet.die || distance > bullet.range) bullet.unload();
            distance++;
            bullet.push({x: Math.cos(theta) * bullet.velocity, y: Math.sin(theta) * bullet.velocity});
        });
        bullet.radius = 1;
        bullet.collide = function(collider){
            switch (collider.type) {
                case 'zombie':
                    bullet.unload();
                    break;
            }
            switch (collider.base) {
                case 'square':
                    bullet.unload();
                    break;
            }
        }
        bullet.move({x: pos.x + Math.cos(theta) * 75, y: pos.y + Math.sin(theta) * 75});
    };

    for (var key in options) {
        bullet[key] = options[key];
    }

    bullet.type = 'bullet';
    return bullet;
};




module.exports = Bullet;

},{"./makeSolid.js":20,"./projectile.js":25}],6:[function(require,module,exports){
var baseEntity = require('./baseEntity.js');
var makeVisible = require('./makeVisible.js');
var makeInventory = require('./makeInventory.js');
var makeSolid = require('./makeSolid.js');
var makeGeometry = require('./makeGeometry.js');

module.exports = function(options) {
    var character = baseEntity();
    var aniTick = 0;
    makeInventory(character);
    makeGeometry(character, 'circle');
    makeSolid(character);
    makeVisible(character);
    character.radius = 50;
    character.solid = true;
    character.onTop = true;
    character.geometry = 'circle';
    character.lookAtVec = function(vec) {
        var theta = Math.atan2(vec.y, vec.x);
        character.pos.rot = theta + Math.PI;
        return theta;
    };
    character.lookAtObj = function(obj) {
        var theta = Math.atan2(obj.pos.y - character.pos.y, obj.pos.x - character.pos.x);
        character.pos.rot = theta;
        return theta;
    };
    character.base = 'character';
    character.health = 1;
    character.step(function() {
        if (character.health <= 0) character.addMode('die');
        aniTick++;
        if (!character.velocity) {
            character.pose.x = 0;
        } else {
            if (aniTick > 16 - character.velocity) {
                aniTick = 0;
                if (character.pose.x < character.textureData.poses.slides[character.pose.y] - 1) {
                    character.pose.x++;
                } else {
                    character.pose.x = 0;
                }
            } else {
                aniTick++;
            }
        }
    });
    character.modes = options.modes;
    character.collide = options.collide;
    character.type = options.type;
    character.addMode = function(mode) {
        if (character.currentMode === mode) return;
        character.currentMode = mode;
        character.modes[mode]();
    };
    character.pose = {x: 0, y: 0};
    character.load(function() { character.addMode(options.mode); });
    character.move(options.pos);
    return character;
};


},{"./baseEntity.js":4,"./makeGeometry.js":17,"./makeInventory.js":19,"./makeSolid.js":20,"./makeVisible.js":22}],7:[function(require,module,exports){
document.oncontextmenu = function() { return false; }
var loaded = false;
var events = require('./events.js');
var getId = require('./getId.js').getId;
var effects = require('./effects.js');
var objs = {};
var menus = {};
var inputs = {};
window.functions = {};
var menuCloseEvents = {};
var loadEvents = [];
var canvases = {};
var oldWeapons = [];
var iconEvents = [];
var weaponIcons = [];


window.onload = function() { 
    [].slice.call(document.getElementsByClassName('menus')).forEach(function(obj, index, array) { 
        menus[obj.id] = obj; 
        effects.fadeOut(obj);
    });
    [].slice.call(document.getElementsByClassName('domobj')).forEach(function(obj, index, array) { 
        objs[obj.id] = obj; 
    });
    [].slice.call(document.getElementsByTagName('input')).forEach(function(obj, index, array) { 
        inputs[obj.id] = obj; 
    });
    objs['modalAck'].addEventListener('click', function() { effects.fadeOut(objs['modal']); });
    objs['window'] = window;
    loaded = true; 
    loadEvents.forEach(function(ev) { ev(); }); 
};

var ensureObjId = function(obj) {
    if (obj.id) return obj.id;
    obj.id = getId();
    objs[obj.id] = obj;
    return obj.id;
};

var resetCanvas = function(canvas) {
    var canvasWidth = canvas.getAttribute('width');
    var canvasHeight = canvas.getAttribute('height');
    var screenWidth = window.innerWidth;
    var screenHeight = window.innerHeight;
    if (canvasWidth / canvasHeight > screenWidth / screenHeight) {
        canvas.style.width = screenWidth + 'px';
        canvas.style.height = screenWidth * (canvasHeight / canvasWidth) + 'px';
        canvas.style.top = (screenHeight - (screenWidth * (canvasHeight / canvasWidth))) / 2 + 'px';
        canvas.style.left = '0px'; 
    } else {
        canvas.style.height = screenHeight + 'px';
        canvas.style.width = screenHeight * (canvasWidth / canvasHeight) + 'px';
        canvas.style.left = (screenWidth - (screenHeight * (canvasWidth / canvasHeight))) / 2 + 'px';
        canvas.style.top = '0px'; 
    }
};



var api = {
    setCanvas: function(id, dim) {
        if (dim) {
            objs[id].setAttribute('width', dim.width);
            objs[id].setAttribute('height', dim.height);
            if (!canvases[id]) {
                canvases[id] = objs[id];
                resetCanvas(objs[id]);
                api.attachEvent('window', 'resize', resetCanvas.bind(null, objs[id]));
            } 
        }
        return objs[id].getContext('webgl');
    },
    clearInputs: function(ancestor) {
        ancestor = api.getObjById(ancestor);
        for (var input in inputs) {
            if (ancestor.contains(inputs[input])) inputs[input].value = '';
        }
    },
    onHideMenu: function(id, func) {
        if (!menuCloseEvents[id]) menuCloseEvents[id] = [];
        menuCloseEvents[id].push(func);
    },
    hideMenu: function(id) {
        if (id) {
            effects.fadeOut(menus[id]);
            if (menuCloseEvents[id]) {
                menuCloseEvents[id].forEach(function(f) { f(); });
                menuCloseEvents[id] = [];
            }
            return;
        }
        for (var menu in menus) {
            if (menus[menu].id !== 'worldInspector') {
                effects.fadeOut(menus[menu]);
                if (menuCloseEvents[menu]) {
                    menuCloseEvents[menu].forEach(function(f) { f(); });
                    menuCloseEvents[menu] = [];
                }
            }
        }
    },
    showMenu: function(id, pos) {
        effects.fadeIn(menus[id]);
        if (pos) {
            menus[id].style.left = parseInt(pos.x - 20) + 'px';
            menus[id].style.top = parseInt(pos.y - 20) + 'px';
        }
    },
    getItemsByClass: function(c) {
        return [].slice.call(document.getElementsByClassName(c)).map(function(item) {
            return item.id;
        });;
    },
    addListItem: function(ul, li) {
        objs[ul].appendChild(objs[li]);
    },
    addMenuListItem: function(id, text, click, mouseover) {
        var li = document.createElement('li');
        var span = document.createElement('span');
        ensureObjId(li);
        span.innerText = text;
        li.appendChild(span);
        if (click) span.addEventListener('click', click);
        if (mouseover) span.addEventListener('mouseover', mouseover);
        objs[id].appendChild(li);
        return li.id;
    },
    clearListItems: function(id) {
        [].slice.call(objs[id].children).forEach(function(child) {
           if (!child.className.split(' ').reduce(function(a, b) {
                if (a) return true;
                if (b === 'listItem') return true;
                return false;
           }, false)) objs[id].removeChild(child);
        });
    },
    getInputsValues: function(ancestor) {
        return [].slice.call(document.getElementsByTagName('select')).
            concat([].slice.call(document.getElementsByTagName('input'))).
            filter(function(item) {
                return (objs[ancestor].contains(item));
            }).map(function(item) {
                return {id: item.id, value: item.value};
            });
    },
    onload: function(ev) {
        if (loaded) return ev();
        loadEvents.push(ev);
    },
    getGenericListItem: function() {
        return document.getElementsByClassName('genericListItem')[0].cloneNode(true);
    },
    attachEvent: function(id, type, func) {
        if (id.cloneNode) id = ensureObjId(id);
        var fid = getId();
        functions[fid] = {f: func, id: id, type: type};
        api.onload(function() { 
            objs[id].addEventListener(type, func); 
        });
        return fid;
    },
    detachEvent: function(fid) {
        var ev = functions[fid];
        if (objs[ev.id].removeEventListener) objs[ev.id].removeEventListener(ev.type, ev.f);
        delete functions[fid];
    },
    display: function(id) {
        [].slice.call(document.getElementsByClassName('slides')).forEach(function(obj) { effects.fadeOut(obj); });
        effects.fadeIn(objs[id]);
    },
    getObjById: function(id) {
        return objs[id];
    },
    getGenericButton: function(text, click, mouseover) {
        var button = document.createElement('button');
        button.innerText = text;
        if (click) button.addEventListener('click', click);
        if (mouseover) button.addEventListener('mouseover', mouseover);
        return button;
    },
    modal: function(msg) {
        api.getObjById('modalMsg').innerText = msg;
        effects.fadeIn(api.getObjById('modal'));
    },
    updateWeaponIcons: function(weapons) {
        var changed;
        if (weapons) {
            weapons.forEach(function(weapon) {
                if (weapons.type !== oldWeapons.type) changed = true;
            });
            if (changed) {
                oldWeapons = weapons;
                weaponIcons.forEach(function(icon) {
                    weaponIcons[index].style.backgroundImage = '';
                });
                iconEvents.forEach(function(ev) {
                    ev.dom.removeEventListener(ev.func);
                });
                weapons.forEach(function(weapon, index) {
                    var click = function() {
                        weapon.selectWeapon = true;
                    };
                    weaponIcons[index].style.backgroundImage = weapon.icon;
                    iconEvents.push({dom: weaponIcons[index], func: click});
                    weaponIcons.addEventListener('click', click);
                });
            }
        }
    }
};

for (var i = 0; i < 4; i++) {
    weaponIcons.push(document.createElement('li'));
    weaponIcons[i].className = 'weaponicon';
    (function() { 
        var j = i;
        if (objs['weaponOptions']) api.onload(function() { 
            objs['weaponOptions'].appendChild(weaponIcons[j]); 
        });
    })();
}
module.exports = api;

},{"./effects.js":10,"./events.js":11,"./getId.js":14}],8:[function(require,module,exports){
var makeStartOptions = require('./makeStartOptions.js');
var post = require('./post.js');
var testObj = require('./test-obj.js');
var world = require('./world.js');
var canvas = document.getElementById('canvas');
var getId = require('./getId.js').getId;
var events = require('./events.js');
var dom = require('./dom.js');
var editingObj = false;
var draggingObj = false;
var worldInspectorFids = [];
var clickObj = {};
var camera = testObj({pos: {
    x: 1000,
    y: 1000
}});
camera.camera = true;
camera.load();
camera.step();

function pauseEvent(e){
    if(e.stopPropagation) e.stopPropagation();
    if(e.preventDefault) e.preventDefault();
    e.cancelBubble=true;
    e.returnValue=false;
    return false;
};

var screenWidth = canvas.clientWidth;
var screenHeight = canvas.clientHeight;
var mousePos = {x: 0, y: 0};
var menuItems = {
    geometry: {
        square: [],
        circle: []
    },
    base: {
        spawner: []
    }
};

var state = 'noMenus';
var states = {
    noMenus: function() {
        dom.hideMenu();
    },
    editingObj: function(ev, obj) {
        if (!obj) obj = clickObj;
        dom.hideMenu();
        dom.clearInputs('objInspector');
        dom.clearListItems('objInspector');
        editingObj = obj;
        updateObjInspectorOptions();
        dom.showMenu('objInspector');
        updateObjInspector();
        focusOnEditingObj();
        dom.onHideMenu('objInspector', function() { editingObj = null; });
    },
    levelMenu: function(gamePos, canvasPos) {
        dom.hideMenu();
        dom.showMenu('levelMenu', canvasPos);
        dom.clearListItems('levelMenuObjs');
        var fid = dom.attachEvent('levelMenu', 'mouseout', function(ev) {
            if (dom.getObjById('levelMenu').contains(ev.toElement)) return;
            updateState('noMenus');
        });
        dom.onHideMenu('levelMenu', function() { dom.detachEvent(fid); });
        getCollidingObjs(clickObj).forEach(function(item) {
            dom.addMenuListItem('levelMenuObjs', (item.type + '  ' + item.id), function(ev) {
                dom.hideMenu('levelMenu');
                updateState('editingObj', ev, item);
            }, function(ev) {
                
            });
        });
    }
};


var updateState = function(newState) {
    state = newState;
    states[state].apply(null, [].slice.call(arguments, 1));
};

var getCollidingObjs = function(testObj) {
    return world.getItems().filter(function(obj) {
        return (obj.detectCollide(testObj));
    });
};

var updateObjInspector = function() {
    if (!editingObj) return;
    dom.getObjById('objType').value = editingObj.type;
    dom.getObjById('objXPos').value = editingObj.pos.x;
    dom.getObjById('objYPos').value = editingObj.pos.y;
    dom.getObjById('objRotation').value = editingObj.pos.rot;
    if (editingObj.radius) dom.getObjById('objRadius').value = editingObj.radius;
    if (editingObj.width) {
        dom.getObjById('objWidth').value = editingObj.width;
        dom.getObjById('objHeight').value = editingObj.height;
    }
    if (editingObj.base === 'spawner') {
        dom.getObjById('objStart').value = editingObj.startOptions().start;
        dom.getObjById('objInterval').value = editingObj.startOptions().interval;
        dom.getObjById('objSpawnCount').value = editingObj.startOptions().spawnCount;
    }
};

var updateObjInspectorOptions = function() {
    if (editingObj.base === 'spawner') menuItems.base.spawner.forEach(function(item) {
        dom.addListItem('objInspector', item);
    });
    if (editingObj.geometry) menuItems.geometry[editingObj.geometry].forEach(function(item) {
        dom.addListItem('objInspector', item);
    });
};

var updateEditingObj = function() {
    if (!editingObj) return;
    var values = {};
    dom.getInputsValues('objInspector').forEach(function(item) {
        values[item.id] = item.value;
    });
    var newObj;
    if (values.objType !== editingObj.type) {
        newObj = world.loadItems({
            entity: dom.getObjById('objType').value,
            pos: {
                x: editingObj.pos.x,
                y: editingObj.pos.y
            }
        });
        editingObj.unload();
        editingObj = newObj;
        dom.clearListItems('objInspector');
        world.updateNewItems();
        updateObjInspectorOptions();
        updateObjInspector();
        values = {};
        dom.getInputsValues('objInspector').forEach(function(item) {
            values[item.id] = item.value;
        });
    }
    editingObj.move({x: parseInt(values.objXPos), y: parseInt(values.objYPos), rot: parseFloat(values.objRotation)});
    if (values.objRadius) editingObj.radius = parseInt(values.objRadius);
    if (values.objWidth) editingObj.setDimensions({width: values.objWidth, height: values.objHeight});
    if (editingObj.base === 'spawner') editingObj.startOptions({
        start: values.objStart,
        interval: values.objInterval,
        spawnCount: values.objSpawnCount
    });

    editingObj.processMovementEvents();
};

var deleteEditingObj = function() {
    editingObj.unload();
    updateState('noMenus');
};

var cloneEditingObj = function() {
    var newObj = world.loadItems({
        entity: editingObj.type,
        pos: {
            x: editingObj.pos.x, 
            y: editingObj.pos.y,
            rot: editingObj.pos.rot
        },
        width: editingObj.width,
        height: editingObj.height
    });
    if (editingObj.startOptions) {
        newObj.startOptions(editingObj.startOptions());
    }
    world.updateNewItems();
    newObj.processMovementEvents();
    newObj.load();
};

var translatePosition = function(pos) {
    var canvasPos = {
        x: pos.x * (world.canvasDim.x / screenWidth),
        y: pos.y * (world.canvasDim.y / screenHeight)
    };
    var gamePos = {
        x: canvasPos.x - (world.canvasDim.x / 2 - camera.pos.x),
        y: canvasPos.y - (world.canvasDim.y / 2 - camera.pos.y)
    }
    return gamePos;
};

var canvasClick = function(ev) {
    //ev.preventDefault();
    pauseEvent(ev);
    var startMousePos = {x: ev.clientX, y: ev.clientY};
    var startGamePos = translatePosition(startMousePos);
    var startObjPos;
    clickObj = testObj({pos: startGamePos});
    clickObj.load();
    clickObj.step();
    if (ev.button === 2) updateState('levelMenu', startGamePos, {x: ev.clientX, y: ev.clientY});
    if (ev.button === 0) {
        if (editingObj && getCollidingObjs(clickObj).filter(function(item) { return (item.id === editingObj.id); }).length) {
            draggingObj = editingObj;
        } else {
            draggingObj = api.camera;
        }
        startObjPos = {x: draggingObj.pos.x, y: draggingObj.pos.y};
        var mousemoveFid = dom.attachEvent('window', 'mousemove', function(ev) {
            pauseEvent(ev);
            var gamePos = translatePosition({x: ev.clientX, y: ev.clientY});
            var gamePosDelta = {x: (gamePos.x - startGamePos.x), y: (gamePos.y - startGamePos.y)};
            if (draggingObj.camera) {
                draggingObj.move({x:  (startObjPos.x - gamePosDelta.x), y:  (startObjPos.y - gamePosDelta.y)});
                startObjPos = {x: draggingObj.pos.x, y: draggingObj.pos.y};
                startGamePos = gamePos;
            } else {
                draggingObj.move({x: startObjPos.x + gamePosDelta.x, y: startObjPos.y + gamePosDelta.y});
            }
            draggingObj.processMovementEvents();
            updateObjInspector();
        });
        var mouseupFid = dom.attachEvent('window', 'mouseup', function() {
            dom.detachEvent(mousemoveFid);
            dom.detachEvent(mouseupFid);
            draggingObj = false;
        });
    }
};

var updateWorldInspector = function() {
    dom.getObjById('entityCount').innerText = world.getItems().length;
    dom.clearListItems('worldInspector');
    worldInspectorFids.forEach(function(fid) { dom.detachEvent(fid); });
    worldInspectorFids = [];
    world.getItems().forEach(function(entity) {
        var li = dom.getGenericListItem();
        li.innerText = entity.base + ', ' + entity.type + ', ' + entity.id;
        worldInspectorFids.push(dom.attachEvent(li, 'click', function(ev) {
            updateState('editingObj', ev, entity);
        }));
        dom.addListItem('worldInspector', li.id);
    });
};

var focusOnEditingObj = function() {
    camera.move(editingObj.pos);
};

var saveLevel = function() {
    var output = [];
    world.getItems().forEach(function(item) {
        output.push(item.getInitialConditions());
    });
    post('./levels/', {
        data: JSON.stringify(output),
        name: world.getLevelMetadata().name,
        id: world.getLevelMetadata().id
    }, function(response) {
        dom.modal(JSON.stringify(response));
        world.setLevelMetadata(response);
    });
    updateState('noMenus');
};

var updateLevelName = function() {
    dom.getObjById('levelName').value = world.getLevelMetadata().name;
};


var levelNameInputChanged = function() {
    world.setLevelMetadata({name: dom.getInputsValues('levelName')[0].value});
};

dom.attachEvent('canvas', 'mousedown', canvasClick);
dom.attachEvent('newLevel', 'click', events.emit.bind(null, 'newLevel'));
dom.attachEvent('newObject', 'click', updateState.bind(null, 'editingObj'));
dom.attachEvent('cloneObj', 'click', cloneEditingObj);
dom.attachEvent('deleteObj', 'click', deleteEditingObj);
dom.attachEvent('focusObj', 'click', focusOnEditingObj);
dom.attachEvent('levelName', 'change', levelNameInputChanged);
dom.attachEvent('saveLevel', 'click', saveLevel);
dom.attachEvent('mainMenuButton', 'click', events.emit.bind(null, 'mainMenu'));
dom.onload(function() {
    dom.showMenu('worldInspector');
    world.getEntityTypes().forEach(function(type) {
        var val = document.createElement('option');
        val.innerText = type;
        dom.getObjById('objType').appendChild(val);
    });
    dom.getItemsByClass('circleGeometry').forEach(function(item) {
        menuItems.geometry.circle.push(item);
    });
    dom.getItemsByClass('squareGeometry').forEach(function(item) {
        menuItems.geometry.square.push(item);
    });
    dom.getItemsByClass('spawnerBase').forEach(function(item) {
        menuItems.base.spawner.push(item);
    });
    dom.getInputsValues('objInspector').forEach(function(item) {
        dom.attachEvent(item.id, 'change', updateEditingObj);
    });
});

events.register('entityCount', updateWorldInspector, getId());
events.register('updateLevelName', updateLevelName, getId());

api = {
    camera: camera
};

updateState(state);

module.exports = api;

},{"./dom.js":7,"./events.js":11,"./getId.js":14,"./makeStartOptions.js":21,"./post.js":24,"./test-obj.js":31,"./world.js":36}],9:[function(require,module,exports){
require('./animationShim.js');
var post = require('./post.js');
window.logging = [];
var events = require('./events.js');
var makeInitialConditionsSavable = require('./makeInitialConditionsSavable.js');
var dom = require('./dom.js');
var renderer = require('./renderer.js');
window.world = require('./world.js');
var getId = require('./getId.js').getId;
var controller = require('./editor-controller.js');
var get = require('./get.js');
window.u_id = '';

get('./id', function(data) {
    u_id = data._id;
});

dom.onload(function() {

    renderer.connectCamera(controller.camera);
    var currentGameId = getId();
    world.decorateAllItems(makeInitialConditionsSavable);

    var states = {
        mainMenu: function() {
            dom.display('mainMenu');
            dom.clearListItems('ownerLevels');
            dom.clearListItems('publicLevels');
            get('./levels/', function(data) {
                data.forEach(function(level) {
                    var list = 'ownerLevels';
                    if (level.snapshot) list = 'publicLevels';
                    var li = dom.addMenuListItem(list, level.name, function() {
                        states.loadLevel(level.id);
                    });
                    if (!level.snapshot) dom.getObjById(li).appendChild(dom.getGenericButton('delete', function() {
                        post('./levels/delete/', {
                            levelId: level.id
                        }, function(data) {
                            states.mainMenu();
                        });
                    }));
                    if (!level.snapshot) dom.getObjById(li).appendChild(dom.getGenericButton('publish', function() {
                        post('./levels/publish/', {
                            levelId: level.id
                        }, function(data) {
                            states.mainMenu();
                        });
                    }));
                });
            });
        },
        newLevel: function() {
            world.unloadWorld();
            states.editingLevel();
        },
        loadLevel: function(id) {
            world.loadLevel(id, function() {
                states.editingLevel();
            });
        },
        editingLevel: function() {
            dom.display('gameView');
            events.register('animate', function() {
                renderer.step();
            }, currentGameId);
        },
        pausedLevel: function() {
            dom.display('pauseMenu');
            events.unregister(currentGameId);
            currentGameId = getId();
        }
    };

    
    events.register('newLevel', states.newLevel, getId());
    events.register('start', states.editingLevel, getId());

    events.register('pause', states.pausedLevel, getId());

    events.register('mainMenu', states.mainMenu, getId());
    states.mainMenu();

});







},{"./animationShim.js":3,"./dom.js":7,"./editor-controller.js":8,"./events.js":11,"./get.js":12,"./getId.js":14,"./makeInitialConditionsSavable.js":18,"./post.js":24,"./renderer.js":26,"./world.js":36}],10:[function(require,module,exports){
module.exports = {
    fadeIn: function(obj) {
        obj.style.opacity = 1;
        obj.style.zIndex = 3;
        obj.style.display = 'inherit';
    },
    fadeOut: function(obj) {
        obj.style.opacity = 0;
        obj.style.zIndex = 1;
        obj.style.display = 'none';
    }
};

},{}],11:[function(require,module,exports){
var events = {};

var api = {
    emit: function(e) {
        for (var id in events) {
            if (events[id].e === e) events[id].f();
        }
    },
    register: function(e, f, id) {
        //console.log('registering event ' + e, f, id);
        events[id] = {
            f: f,
            e: e
        };
    },
    unregister: function(id) {
        delete events[id];
    }
};

module.exports = api;

var animate = function() {
    api.emit('animate');
    window.requestAnimationFrame(animate);
};
if (typeof window !== 'undefined') animate();

},{}],12:[function(require,module,exports){

module.exports = function(url, callback) {
    var http = new XMLHttpRequest();

    http.open('GET', url, true);

    //Send the proper header information along with the request
    http.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');

    http.onreadystatechange = function() {
        var data;
        if((http.readyState === 4) && http.status === 200) {
            data = JSON.parse(http.responseText);
            callback(data)
        }
    };
    http.send();

};


},{}],13:[function(require,module,exports){
var Entities = {};

Entities['player'] = require('./Player.js');
Entities['test'] = require('./test-obj.js');
Entities['gun'] = require('./gun.js');
Entities['tile'] = require('./square.js');
Entities['zombieSpawner'] = require('./spawner.js');
Entities['zombie'] = require('./Zombie.js');
Entities['wall'] = require('./wall.js');
//Entities['door'] = require('./Door.js');
//Entities['sensor'] = require('./Sensor.js');

module.exports = Entities;

},{"./Player.js":1,"./Zombie.js":2,"./gun.js":15,"./spawner.js":27,"./square.js":29,"./test-obj.js":31,"./wall.js":33}],14:[function(require,module,exports){
var lastId = 0;

var api = {
    getId: function() {
        return 'a' + lastId++;
    }
};

module.exports = api;

},{}],15:[function(require,module,exports){
var weapon = require('./weapon.js');
//var world = require('./world.js');
var Bullet = require('./bullet.js');
var makeInventory = require('./makeInventory.js');

module.exports = function(options) {
    var gun = weapon();
    var bullet;
    if (options.pos) gun.move(options.pos);
    gun.use = function() {
        var bullet = gun.getInventory()[0];
        if (!bullet) {
            bullet = Bullet({velocity: 10, power: 10, range: 500});
            gun.takeItems(bullet);
            world.loadItems(bullet);
        }
        gun.dropItem(bullet);
        bullet.fire(gun.owner.pos);
    };

    gun.type = 'gun';

    for (var i = 0; i < options.startAmmo; i++) {
    }

    return gun;
};




},{"./bullet.js":5,"./makeInventory.js":19,"./weapon.js":34}],16:[function(require,module,exports){
module.exports = [
{"entity": "tile",
    "pos": {
        "x":9930,
        "y":10156,
        "rot":0.78
    },
    "width":"5000",
    "height":"5000"},
{"entity":"player",
    "pos": {"x":10023.028868996085,"y":9980.773164775213,"rot":0},"radius":50},
{"entity":"gun",
    "pos": {"x":10023.028868996085,"y":9980.773164775213,"rot":0}},
{"entity":"wall","pos":{"x":10448,"y":10773,"rot":0.78},"width":"100","height":"1200"},{"entity":"wall","pos":{"x":9599,"y":9799,"rot":0.78},"width":"100","height":"1200"},{"entity":"wall","pos":{"x":8133,"y":8445,"rot":0.78},"width":"100","height":"5000"},{"entity":"wall","pos":{"x":10681,"y":9777,"rot":2.34},"width":"100","height":"1200"},{"entity":"wall","pos":{"x":10924,"y":8514,"rot":1.58},"width":"100","height":"800"},{"entity":"wall","pos":{"x":10003,"y":8608,"rot":3.14},"width":"100","height":"1600"},{"entity":"wall","pos":{"x":11642,"y":8413,"rot":2.34},"width":"100","height":"5000"},{"entity":"wall","pos":{"x":11695,"y":11877,"rot":0.78},"width":"100","height":"5000"},{"entity":"wall","pos":{"x":8183,"y":11921,"rot":2.34},"width":"100","height":"5000"},{"entity":"wall","pos":{"x":10267,"y":8790,"rot":3.14},"width":"100","height":"1200"},{"entity":"wall","pos":{"x":10351,"y":7861,"rot":1.58},"width":"100","height":"800"},{"entity":"wall","pos":{"x":11024,"y":9055,"rot":0.3},"width":"400","height":"250"},{"entity":"wall","pos":{"x":11898,"y":9490,"rot":0.6},"width":"900","height":"100"},{"entity":"wall","pos":{"x":11619,"y":9895,"rot":0.6},"width":"900","height":"100"},{"entity":"wall","pos":{"x":9500,"y":11786,"rot":0},"width":"800","height":"800"},
{"entity":"zombieSpawner","pos":{"x":7769,"y":9411,"rot":0},"radius":10, "start": true, "interval": 20000, "spawnCount": 15},
{"entity":"zombieSpawner","pos":{"x":12379,"y":9449,"rot":0},"radius":10, "start": false, "interval": 45000, "spawnCount": 35},
{"entity":"zombieSpawner","pos":{"x":8760,"y":11983,"rot":0},"radius":10, "start": true, "interval": 20000, "spawnCount": 5}

];



},{}],17:[function(require,module,exports){
var perpPoint = function(verts, p) {
    var output = verts.map(function(v0, index, array) {
        var v1 = array[index + 1];
        if (index + 1 === array.length) v1 = array[0];
        var k = ((v1.y - v0.y) * (p.x - v0.x) - (v1.x - v0.x) * (p.y - v0.y)) / (Math.pow(v1.y - v0.y, 2) + Math.pow(v1.x - v0.x, 2));
        var perpPoint = {x: p.x - k * (v1.y - v0.y), y: p.y + k * (v1.x - v0.x)};
        var dis = Math.sqrt(Math.pow(p.x - perpPoint.x, 2) + Math.pow(p.y - perpPoint.y, 2));
        return {dis: dis, perpPoint: perpPoint};
    });
    return output.reduce(function(past, current) { 
        if (!past.dis) return current;
        if (current.dis < past.dis) return current;
        return past;
    }).perpPoint;
};


var pointInPolygon = function(square, circle) {
    var c = false;
    var i, j, x, y, p;
    var vertices = square.verts;
    var point = circle.pos;

    j = vertices.length - 1;

    for (i = 0; i < vertices.length; i++) {

        if ( ((vertices[i].y > point.y) !== (vertices[j].y > point.y)) &&
        (point.x < (vertices[j].x - vertices[i].x) * (point.y - vertices[i].y) / (vertices[j].y - vertices[i].y) + vertices[i].x) ) {
            c = !c;
        }

        j = i;
    }

    if (c) {
        if (square.solid && circle.solid) {
            p = perpPoint(vertices, point);
            //x = p.x - circle.pos.x;
            //y .= p.y - circle.pos.y;
            //circle.addEffect(function() { 
                circle.move({x: p.x, y: p.y}); 
            //});
            circle.collide(square);
            square.collide(circle);
        }
        return true;
    }
};

var longPush = function(a, b) {
    var then = Date.now();
    var x = Math.cos(b.pos.rot) * b.velocity;
    var y = Math.sin(b.pos.rot) * b.velocity;
    a.addEffect(function() {
        var elapsedTime = (Date.now() - then) / 1000;
        var scaler = Math.pow(elapsedTime - 1, 2);
        if (elapsedTime > 1) return false;
        a.push({x: x * scaler, y: y * scaler});

    });
};

var circleDetect = function(a, b) {
    var x, y, dis, radius, delta, theta, aDelta, bDelta;
    x = a.pos.x - b.pos.x;
    y = a.pos.y - b.pos.y;
    dis = Math.sqrt(Math.pow(x, 2) + Math.pow(y, 2));
    radius = parseInt(a.radius) + parseInt(b.radius);

    if (dis < radius) {
        if (a.solid && b.solid) {
            delta = (radius - dis);
            theta = Math.atan2(y, x);
            a.addEffect(function() { 
                a.push({
                    x: (Math.cos(theta) * delta), 
                    y: (Math.sin(theta) * delta)
                }); 
                return false;
            });
            b.addEffect(function() { 
                b.push({
                    x: (Math.cos(theta) * -delta),  
                    y: (Math.sin(theta) * -delta)
                }); 
                return false;
            });
            if (b.inertia) longPush(a, b);
            if (a.inertia) longPush(b, a);
            a.collide(b);
            b.collide(a);
        }
        return true;
    }
};

var setAABB = function(obj) {
    var AABB = {
        xs: [{type: 'b', val: Infinity, obj: obj}, {type: 'e', val: -Infinity, obj: obj}],
        ys: [{type: 'b', val: Infinity, obj: obj}, {type: 'e', val: -Infinity, obj: obj}]
    };

    if (obj.geometry === 'circle') {
        AABB.xs[0].val = obj.pos.x - obj.radius;
        AABB.xs[1].val = obj.pos.x + obj.radius;
        AABB.ys[0].val = obj.pos.y - obj.radius;
        AABB.ys[1].val = obj.pos.y + obj.radius;
        obj.AABB = AABB;
        return;
    };
    if (obj.geometry === 'square') {
        obj.AABB = obj.verts.reduce(function(acc, vert) {
            if (vert.x < acc.xs[0].val) acc.xs[0].val = vert.x;
            if (vert.x > acc.xs[1].val) acc.xs[1].val = vert.x;
            if (vert.y < acc.ys[0].val) acc.ys[0].val = vert.y;
            if (vert.y > acc.ys[1].val) acc.ys[1].val = vert.y;
            return acc;
        }, AABB);
    }
};

var setVerts = function(obj) {

    obj.pos.x = parseInt(obj.pos.x);
    obj.pos.y = parseInt(obj.pos.y);

    var verts = [
        {x: obj.pos.x - obj.width / 2, y: obj.pos.y - obj.height / 2}, 
        {x: obj.pos.x + obj.width / 2, y: obj.pos.y - obj.height / 2}, 
        {x: obj.pos.x + obj.width / 2, y: obj.pos.y + obj.height / 2}, 
        {x: obj.pos.x - obj.width / 2, y: obj.pos.y + obj.height / 2}, 
    ];

    var rot = obj.pos.rot;
    var ox = obj.pos.x;
    var oy = obj.pos.y;

    obj.verts = verts.map(function(item) {
        var vx = item.x;
        var vy = item.y;
        item.x = Math.cos(rot) * (vx - ox) - Math.sin(rot) * (vy - oy) + ox;
        item.y = Math.sin(rot) * (vx - ox) + Math.cos(rot) * (vy - oy) + oy;
        return item;
    });

    setAABB(obj);
};

module.exports = function(obj, type) {
    obj.geometry = type;
    if (type === 'circle') {
        obj.detectCollide = function(collider) {
            if (collider.geometry === 'circle') return circleDetect(obj, collider);
            if (collider.geometry === 'square') return pointInPolygon(collider, obj);
        };
        obj.move({ev: setAABB.bind(null, obj)});
        setAABB(obj);
    }
    if (type === 'square') {
        obj.detectCollide = function(collider) {
            if (collider.geometry === 'square') return false;
            if (collider.geometry === 'circle') return pointInPolygon(obj, collider);
        };
        obj.width = 100;
        obj.height = 100;
        obj.setDimensions = function(dim) {
            if (dim) {
                if (dim.width) obj.width = dim.width;
                if (dim.height) obj.height = dim.height;
                setVerts(obj);
            }
        }
        obj.move({ev: setVerts.bind(null, obj)});
        setVerts(obj);
    }
};

},{}],18:[function(require,module,exports){

module.exports = function(obj) {
    obj.getInitialConditions = function() {
        var initialConditions = {
            entity: obj.type,
            pos: {
                x: obj.pos.x,
                y: obj.pos.y,
                rot: obj.pos.rot
            },
        };
        if (obj.geometry && obj.geometry === 'circle') {
            initialConditions.radius = obj.radius;
        }
        if (obj.geometry && obj.geometry === 'square') {
            initialConditions.width = obj.width;
            initialConditions.height = obj.height;
        }
        var startOptions;
        if (obj.startOptions) {
            startOptions = obj.startOptions();
            for (var option in startOptions) {
                initialConditions[option] = startOptions[option];
            }
        }
        return initialConditions;
    };
};

},{}],19:[function(require,module,exports){

module.exports = function(obj) {

    var inventory = [];
    obj.takeItems = function(items) {
        if (!items.length) items = [items];
        items.forEach(function(item) {
            var currentObj = obj.getInventoryByType(item.type)[0];
            if (currentObj && currentObj.consolidateInventory) {
                currentObj.takeItems(item.getInventory());
                item.unload();
            } else {
                inventory.push(item);
                item.owner = obj;
                item.load();
            }
        });
    };
    obj.dropItem = function(item) {
        item.owner = false;
        inventory = inventory.filter(function(maybeItem) { if (maybeItem.id !== item.id) return true; });
    };
    obj.getInventory = function() {
        return inventory.slice();
    };
    obj.getInventoryByType = function(type) {
        return inventory.filter(function(item) { if (item.type === type) return true; });
    };
    obj.getInventoryByBase = function(base) {
        return inventory.filter(function(item) { if (item.base === base) return true; });
    };
}


},{}],20:[function(require,module,exports){
module.exports = function(obj) {
    obj.solid = true;
};

},{}],21:[function(require,module,exports){


module.exports = function(obj) {
    var startOptions = {};
    obj.startOptions = function(options) {
        if (!options) return startOptions;
        for (var option in options) {
            startOptions[option] = options[option];
        }
    };
};

},{}],22:[function(require,module,exports){
var textureData = require('./textureData.js');

module.exports = function makeVisible (obj) {
    obj.load(function() { 
        obj.textureData = textureData[obj.base][obj.type]; 
        obj.visible = true;
        obj.addEffect(function() {
            if (obj.inContainer()) {
                obj.visible = false;
            } else {
                obj.visible = true;
            }
            return true;
        });
    });
};

},{"./textureData.js":32}],23:[function(require,module,exports){
function MatrixStack() {
      this.stack = [];

      //since the stack is empty this will put an initial matrix in it
          this.restore();
}

// Pops the top of the stack restoring the previously saved matrix
MatrixStack.prototype.restore = function() {
    this.stack.pop();
    // Never let the stack be totally empty
    if (this.stack.length < 1) {
        this.stack[0] = m4.identity();
    }
};

// Pushes a copy of the current matrix on the stack
MatrixStack.prototype.save = function() {
    this.stack.push(this.getCurrentMatrix());
};

// Gets a copy of the current matrix (top of the stack)
MatrixStack.prototype.getCurrentMatrix = function() {
    return this.stack[this.stack.length - 1].slice();
};

// Lets us set the current matrix
MatrixStack.prototype.setCurrentMatrix = function(m) {
    return this.stack[this.stack.length - 1] = m;
};

// Translates the current matrix
MatrixStack.prototype.translate = function(x, y, z) {
    if (z === undefined) {
        z = 0;
    }
    var m = this.getCurrentMatrix();
    this.setCurrentMatrix(m4.translate(m, x, y, z));
};

// Rotates the current matrix around Z
MatrixStack.prototype.rotateZ = function(angleInRadians) {
    var m = this.getCurrentMatrix();
    this.setCurrentMatrix(m4.zRotate(m, angleInRadians));
};

// Scales the current matrix
MatrixStack.prototype.scale = function(x, y, z) {
    if (z === undefined) {
        z = 1;
    }
    var m = this.getCurrentMatrix();
    this.setCurrentMatrix(m4.scale(m, x, y, z));
};


module.exports = MatrixStack;

},{}],24:[function(require,module,exports){

module.exports = function(url, data, callback) {
    var http = new XMLHttpRequest();
    var params = '';
    for (var param in data) {
        params += ((params.length) ? '&' : '') + param + '=' + data[param];
    }
    http.open('POST', url, true);

    //Send the proper header information along with the request
    http.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');

    http.onreadystatechange = function() {//Call a function when the state changes.
        var data;
        if(http.readyState === 4 && http.status === 200) {
            data = JSON.parse(http.responseText);
            callback(data);
        }
    };
    http.send(params);

};


},{}],25:[function(require,module,exports){
var baseEntity = require('./baseEntity.js');
var makeVisible = require('./makeVisible.js');
var makeGeometry = require('./makeGeometry.js');

module.exports = function() {
    var projectile = baseEntity();
    makeVisible(projectile);
    makeGeometry(projectile, 'circle');
    projectile.base = 'projectile';

    return projectile;
};


},{"./baseEntity.js":4,"./makeGeometry.js":17,"./makeVisible.js":22}],26:[function(require,module,exports){
var events = require('events');
var gl = require('./webgl-lab.js');
var World = require('./world.js');
//var audio = require('./audio.js');
var currentLevel;
var pov;
var canvasDim = gl.canvasDimensions;
World.canvasDim = canvasDim;


var step = function() {

    gl.clear();
    var world = World.getItems();
    //if (pov) audio.updatePov(pov.pos);
    world.forEach(function(item) { 
        var width, height, sx, sy, i, sw, sh, pattern;
        if (item.audio) {
            audio[item.type][item.audio](item.pos);
            item.audio = null;
        }
        if (item.visible) {
            if (item.textureData.poses) {
                sw = item.textureData.frame.w / item.textureData.poses.x;
                sh = item.textureData.frame.h / item.textureData.poses.y;
                sx = item.textureData.frame.x + sw * item.pose.x;
                sy = item.textureData.frame.y + sh * item.pose.y;

            }  else {
                sx = item.textureData.frame.x
                sy = item.textureData.frame.y
                sw = item.textureData.frame.w;
                sh = item.textureData.frame.h;
            }
            if (item.geometry === 'square') { 
                width = item.width;
                height = item.height;
            }
            if (item.geometry === 'circle') { 
                width = sw;
                height = sh;
            }
            gl.matrix.restore(); 

            gl.matrix.translate( (item.pos.x + (canvasDim.x / 2 - pov.x)), (item.pos.y + (canvasDim.y / 2 - pov.y)));
            gl.matrix.rotateZ(item.pos.rot);
            gl.drawImg(sx, sy, sw, sh, - width / 2, - height / 2, width, height);

        }
    });

};

var api = {
    step: function() {
        if (pov) step();
    },
    connectCamera: function(camera) {
        pov = camera.pos;
    },
    setGl: function(g) {
        gl = g;
    }
};


module.exports = api;

},{"./webgl-lab.js":35,"./world.js":36,"events":37}],27:[function(require,module,exports){
var baseEntity = require('./baseEntity.js');
var zombie = require('./Zombie.js');
var makeStartOptions = require('./makeStartOptions.js');
var makeGeometry = require('./makeGeometry.js');
//var world = require('./world.js');

module.exports = function(options) {
    var spawner = baseEntity();
    makeStartOptions(spawner);
    makeGeometry(spawner, 'circle');
    var timer = Date.now();
    var spawning = options.start;
    var spawnCount = options.spawnCount;
    var lastSpawn = Date.now();
    spawner.startOptions({
        start: options.start,
        spawnCount: options.spawnCount,
        interval: options.interval
    });
    
    spawner.base = 'spawner';
    spawner.type = 'zombieSpawner';
    spawner.move(options.pos);
    spawner.step(function() {
        var now = Date.now();
        if (spawning) {
            if (spawnCount === 0) {
                spawnCount = options.spawnCount;
                spawning = false;
                timer = now;
            }
            if (now - lastSpawn > 500) {
                lastSpawn = now;
                world.loadItems(zombie({pos: spawner.pos}));
                spawnCount--;
            }

        } else {
            if (now - timer > options.interval) {
                spawning = true;
            }
        }
    });

    return spawner;
};


},{"./Zombie.js":2,"./baseEntity.js":4,"./makeGeometry.js":17,"./makeStartOptions.js":21}],28:[function(require,module,exports){
module.exports = {"frames":{"bullet":{"frame":{"x":453,"y":922,"w":201,"h":46},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":201,"h":46},"sourceSize":{"w":201,"h":46}},"machinegun":{"frame":{"x":0,"y":922,"w":150,"h":150},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":150,"h":150},"sourceSize":{"w":150,"h":150}},"pistol":{"frame":{"x":151,"y":922,"w":150,"h":150},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":150,"h":150},"sourceSize":{"w":150,"h":150}},"player":{"frame":{"x":0,"y":0,"w":1500,"h":280},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":1500,"h":280},"sourceSize":{"w":1500,"h":280}},"shotgun":{"frame":{"x":302,"y":922,"w":150,"h":150},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":150,"h":150},"sourceSize":{"w":150,"h":150}},"wall":{"frame":{"x":453,"y":969,"w":100,"h":100},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":100,"h":100},"sourceSize":{"w":100,"h":100}},"zombie1":{"frame":{"x":0,"y":1760,"w":1500,"h":560},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":1500,"h":560},"sourceSize":{"w":1500,"h":560}},"zombie2":{"frame":{"x":0,"y":281,"w":1500,"h":640},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":1500,"h":640},"sourceSize":{"w":1500,"h":640}},"zombie3":{"frame":{"x":0,"y":1634,"w":1500,"h":686},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":1500,"h":686},"sourceSize":{"w":1500,"h":686}}},"meta":{"app":"https://www.leshylabs.com/apps/sstool/","version":"Leshy SpriteSheet Tool v0.8.4","image":"spritesheet.png","size":{"w":1500,"h":2320},"scale":1}};

},{}],29:[function(require,module,exports){
var baseEntity = require('./baseEntity.js');
var makeVisible = require('./makeVisible.js');
var makeGeometry = require('./makeGeometry.js');

module.exports = function(options) {
    var square = baseEntity();
    makeVisible(square);
    makeGeometry(square, 'square');
    square.setDimensions({width: options.width, height: options.height});
    square.move(options.pos);
    square.base = 'square';
    square.type = 'tile';
    square.collide = function() {};

    return square;
};

},{"./baseEntity.js":4,"./makeGeometry.js":17,"./makeVisible.js":22}],30:[function(require,module,exports){
module.exports = [

    {entity: 'test', pos: {x: -400, y: -405, rot: 0}},
    {entity: 'test', pos: {x: -400, y: -405, rot: 0}}
    //{entity: 'wall', pos: {x: -450, y: -450, rot: 0}, dim: {w: 300, h: 300}},
    //{entity: 'square', pos: {x: -1250, y: -1250, rot: 45}, dim: {w: 2500, h: 2500}}

    /*{entity: 'Tile', pos: {x: 2500, y: 2500}, width: 5000, height: 5000, path: './img/background.jpg'},
    {entity: 'Block', path: './img/wall.png', pos: {x: 0, y: 3900, rot: 0}, width: 100, height: 2600},
    {entity: 'Block', path: './img/wall.png', pos: {x: 0, y: 1100, rot: 0}, width: 100, height: 2200},
    {entity: 'Block', path: './img/wall.png', pos: {x: 2500, y: 0, rot: 0}, width: 5000, height: 100},
    {entity: 'Block', path: './img/wall.png', pos: {x: 2500, y: 5000, rot: 0}, width: 5000, height: 100},
    {entity: 'Block', path: './img/wall.png', pos: {x: 5000, y: 2500, rot: 0}, width: 100, height: 5000},
    {entity: 'Block', path: './img/car1.png', pos: {x: 300, y: 300, rot: 2}, width: 200, height: 300},
    {entity: 'Zombie', img: 2, pos: {x: 1900, y: 1700, rot: 0}}
*/
];



},{}],31:[function(require,module,exports){
var baseEntity = require('./baseEntity.js');
var makeGeometry = require('./makeGeometry.js');
var makeSolid = require('./makeSolid.js');

module.exports = function(options) {
    var obj = baseEntity();
    obj.radius = 10;
    makeGeometry(obj, 'circle');
    makeSolid(obj);
    obj.base = 'obj';
    obj.type = 'test';
    obj.move(options.pos);
    obj.collide = function() {};

    return obj;
};


},{"./baseEntity.js":4,"./makeGeometry.js":17,"./makeSolid.js":20}],32:[function(require,module,exports){
var sprites = require('./sprites.js');

module.exports = {
    character: {
        zombie: { 
            frame: sprites.frames.zombie2.frame,
            poses: {
                x: 6,
                y: 4,
                slides: [6, 5, 2, 3]
            }
        },
        zombie2: { 
            frame: sprites.frames.zombie2.frame,
            poses: {
                x: 6,
                y: 2,
                slides: [6, 5]
            }
        },
        zombie3: { 
            frame: sprites.frames.zombie3.frame,
            poses: {
                x: 6,
                y: 2,
                slides: [6, 5]
            }
        },
        player: { 
            frame: sprites.frames.player.frame,
            poses: {
                x: 6,
                y: 2,
                slides: [6, 5]
            }
        }
    },
    projectile: {
        bullet: {
            frame: sprites.frames.bullet.frame
        }
    },
    square: {
        tile: {
            frame: sprites.frames.wall.frame
        },
        wall: {
            frame: sprites.frames.wall.frame
        }
    },
    weapon: {
        gun: {
            frame: sprites.frames.pistol.frame
        }
    }
};

},{"./sprites.js":28}],33:[function(require,module,exports){
var square = require('./square.js');
var makeSolid = require('./makeSolid.js');

module.exports = function(options) {
    wall = square(options);
    wall.onTop = true;
    makeSolid(wall);
    wall.type = 'wall';

    return wall;
};

},{"./makeSolid.js":20,"./square.js":29}],34:[function(require,module,exports){
var makeVisible = require('./makeVisible.js');
var makeInventory = require('./makeInventory.js');
var baseEntity = require('./baseEntity.js');
var makeSolid = require('./makeSolid.js');
var makeGeometry = require('./makeGeometry.js');


module.exports = function() {
    var weapon = baseEntity();
    makeGeometry(weapon, 'circle');
    makeSolid(weapon);
    makeVisible(weapon);
    makeInventory(weapon);
    weapon.base = 'weapon';
    weapon.radius = '10';
    weapon.coolDown = 5;
    weapon.consolidateInventory = true;
    weapon.collide = function(collider) {
        switch (collider.type) {
            case 'player':
                break;
        }

    };

    return weapon;
};

},{"./baseEntity.js":4,"./makeGeometry.js":17,"./makeInventory.js":19,"./makeSolid.js":20,"./makeVisible.js":22}],35:[function(require,module,exports){
"use strict";
var matrixStack = require('./matrixStack.js');
matrixStack = new matrixStack();

var canvasSpace = {};
canvasSpace.width = 3000;
canvasSpace.height = 1500;

var gl, drawImage = {}, drawInstances;
window.addEventListener('load', function() {
    var canvas = document.getElementById('canvas');
    canvas.setAttribute('width', canvasSpace.width);
    canvas.setAttribute('height', canvasSpace.height);
    gl = canvas.getContext('webgl');
    var ext = gl.getExtension("ANGLE_instanced_arrays"); // Vendor prefixes may apply!



    // Get A WebGL context
    /** @type {HTMLCanvasElement} */


    // setup GLSL program
    var program = webglUtils.createProgramFromScripts(gl, ["drawImage-vertex-shader", "drawImage-fragment-shader"]);

    // look up where the vertex data needs to go.
    var positionLocation = gl.getAttribLocation(program, "a_position");
    var texcoordLocation = gl.getAttribLocation(program, "a_texcoord");
    var instanceLocation = gl.getAttribLocation(program, "a_instance");

    // lookup uniforms
    var matrixLocation = gl.getUniformLocation(program, "u_matrix");
    var textureMatrixLocation = gl.getUniformLocation(program, "u_textureMatrix");
    var textureLocation = gl.getUniformLocation(program, "u_texture");

    var instanceBuffer = gl.createBuffer();
    gl.bindBuffer(gl.ARRAY_BUFFER, instanceBuffer);
    gl.bufferData(gl.ARRAY_BUFFER, [0, 0, 0], gl.STATIC_DRAW);
    // Create a buffer.
    var positionBuffer = gl.createBuffer();
    gl.bindBuffer(gl.ARRAY_BUFFER, positionBuffer);

    // Put a unit quad in the buffer
    var positions = [
        0, 0,
        0, 1,
        1, 0,
        1, 0,
        0, 1,
        1, 1,
    ];
    gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(positions), gl.STATIC_DRAW);

    // Create a buffer for texture coords
    var texcoordBuffer = gl.createBuffer();
    gl.bindBuffer(gl.ARRAY_BUFFER, texcoordBuffer);

    // Put texcoords in the buffer
    var texcoords = [
        0, 0,
        0, 1,
        1, 0,
        1, 0,
        0, 1,
        1, 1,
    ];
    gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(texcoords), gl.STATIC_DRAW);

    // creates a texture info { width: w, height: h, texture: tex }
    // The texture will start with 1x1 pixels and be updated
    // when the image has loaded
    function loadImageAndCreateTextureInfo(url) {
        var tex = gl.createTexture();
        gl.bindTexture(gl.TEXTURE_2D, tex);
        // Fill the texture with a 1x1 blue pixel.
        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, 1, 1, 0, gl.RGBA, gl.UNSIGNED_BYTE,
                new Uint8Array([0, 0, 255, 255]));

        // let's assume all images are not a power of 2
        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);
        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);
        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);

        var textureInfo = {
            width: 1,   // we don't know the size until it loads
            height: 1,
            texture: tex,
        };
        var img = new Image();
        img.addEventListener('load', function() {
            textureInfo.width = img.width;
            textureInfo.height = img.height;

            gl.bindTexture(gl.TEXTURE_2D, textureInfo.texture);
            gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, img);
        });
        img.src = url;

        return textureInfo;
    };

    var texture = loadImageAndCreateTextureInfo('./img/spritesheet.png');


    // Unlike images, textures do not have a width and height associated
    // with them so we'll pass in the width and height of the texture
    drawImage = function(
            srcX, srcY, srcWidth, srcHeight,
            dstX, dstY, dstWidth, dstHeight
            ) {
        var srcRotation = 0;
        if (dstX === undefined) {
            dstX = srcX;
            srcX = 0;
        }
        if (dstY === undefined) {
            dstY = srcY;
            srcY = 0;
        }
        if (srcWidth === undefined) {
            srcWidth = texture.width;
        }
        if (srcHeight === undefined) {
            srcHeight = texture.height;
        }
        if (dstWidth === undefined) {
            dstWidth = srcWidth;
            srcWidth = texture.width;
        }
        if (dstHeight === undefined) {
            dstHeight = srcHeight;
            srcHeight = texture.height;
        }

        gl.bindTexture(gl.TEXTURE_2D, texture.texture);

        // Tell WebGL to use our shader program pair
        gl.useProgram(program);

        // Setup the attributes to pull data from our buffers
        gl.bindBuffer(gl.ARRAY_BUFFER, positionBuffer);
        gl.enableVertexAttribArray(positionLocation);
        gl.vertexAttribPointer(positionLocation, 2, gl.FLOAT, false, 0, 0);
        gl.bindBuffer(gl.ARRAY_BUFFER, texcoordBuffer);
        gl.enableVertexAttribArray(texcoordLocation);
        gl.vertexAttribPointer(texcoordLocation, 2, gl.FLOAT, false, 0, 0);

        // this matirx will convert from pixels to clip space
        var matrix = m4.orthographic(0, canvasSpace.width, canvasSpace.height, 0, -1, 1);

        // this matrix moves the origin to the one represented by
        // the current matrix stack.
        matrix = m4.multiply(matrix, matrixStack.getCurrentMatrix());

        matrix = m4.translate(matrix, dstX, dstY, 0);

        // this matrix will scale our 1 unit quad
        // from 1 unit to texture.width, texture.height units
        matrix = m4.scale(matrix, dstWidth, dstHeight, 1);

        // Set the matrix.
        gl.uniformMatrix4fv(matrixLocation, false, matrix);

        // just like a 2d projection matrix except in texture space (0 to 1)
        // instead of clip space. This matrix puts us in pixel space.
        var texMatrix = m4.scaling(1 / texture.width, 1 / texture.height, 1);

        // We need to pick a place to rotate around
        // We'll move to the middle, rotate, then move back
        //texMatrix = m4.translate(texMatrix, (srcX + srcWidth * 0.5), (srcY + srcHeight * 0.5), 0);
        //texMatrix = m4.zRotate(texMatrix, srcRotation);
        //texMatrix = m4.translate(texMatrix, -(srcX + srcWidth * 0.5), -(srcY + srcHeight * 0.5), 0);

        // because were in pixel space
        // the scale and translation are now in pixels
        texMatrix = m4.translate(texMatrix, srcX, srcY, 0);
        texMatrix = m4.scale(texMatrix, srcWidth, srcHeight, 1);

        // Set the texture matrix.
        gl.uniformMatrix4fv(textureMatrixLocation, false, texMatrix);

        // Tell the shader to get the texture from texture unit 0
        gl.uniform1i(textureLocation, 0);

        // draw the quad (2 triangles, 6 vertices)
        gl.drawArrays(gl.TRIANGLES, 0, 6);
    };

    drawInstances = function(type, instances) {
        gl.bindTexture(gl.TEXTURE_2D, texture.texture);

        // Tell WebGL to use our shader program pair
        gl.useProgram(program);

        var data = new Float32Array(instances);
        var instanceCount = instances.length / 3;
        gl.bindBuffer(gl.ARRAY_BUFFER, instanceBuffer);
        gl.bufferData(gl.ARRAY_BUFFER, data, gl.STATIC_DRAW);
        gl.enableVertexAttribArray(instanceLocation);
        gl.vertexAttribPointer(instanceLocation, 3, gl.FLOAT, false, 12, 0);
        ext.vertexAttribDivisorANGLE(instanceLocation, 3); // This makes it instanced!

        // Setup the attributes to pull data from our buffers
        gl.bindBuffer(gl.ARRAY_BUFFER, positionBuffer);
        gl.enableVertexAttribArray(positionLocation);
        gl.vertexAttribPointer(positionLocation, 2, gl.FLOAT, false, 0, 0);
        gl.bindBuffer(gl.ARRAY_BUFFER, texcoordBuffer);
        gl.enableVertexAttribArray(texcoordLocation);
        gl.vertexAttribPointer(texcoordLocation, 2, gl.FLOAT, false, 0, 0);

        var matrix = m4.orthographic(0, canvasSpace.width, canvasSpace.height, 0, -1, 1);
        matrix = m4.multiply(matrix, matrixStack.getCurrentMatrix());
        gl.uniformMatrix4fv(matrixLocation, false, matrix);

        // Tell the shader to get the texture from texture unit 0
        gl.uniform1i(textureLocation, 0);

        // Bind the instance position data
        
        // Draw the instanced meshes
        ext.drawArraysInstancedANGLE(gl.TRIANGLES, 0, 6, instanceCount);
    };
});


module.exports = {
    drawInstances: function() {
        drawInstances.apply(null, arguments);
    },
    drawImg: function() {
        drawImage.apply(null, arguments);
    },
    clear: function() {
        gl.viewport(0, 0, canvasSpace.width, canvasSpace.height);

        gl.clear(gl.COLOR_BUFFER_BIT);
    },
    matrix: matrixStack,
    canvasDimensions: {
        x: canvasSpace.width,
        y: canvasSpace.height
    }
};

},{"./matrixStack.js":23}],36:[function(require,module,exports){
var events = require('./events.js');
var level = {};
level.game = require('./level.js');
level.test = require('./test-level.js');
var Entities = require('./getEntities.js');
var circles = [];
var squares = [];
var points = [];
var xs = [];

var get = require('./get.js');

var world = [];
var newItems = [];
var universalDecorators = [];
var levelMetadata = {};

var api = {
    setLevelMetadata: function(newData) {
        for (var val in newData) {
            levelMetadata[val] = newData[val];
        }
        events.emit('updateLevelName');
    },
    getLevelMetadata: function() {
        return levelMetadata;
    },
    decorateAllItems: function(decorator) {
        world.forEach(function(item) { decorator(item); });
        universalDecorators.push(decorator);
    },
    unloadWorld: function() {
        world.forEach(function(item) {
            item.unload();
        });
        api.setLevelMetadata({
            id: null,
            name: null
        });
    },
    loadLevel: function(levelId, callback) {
        api.unloadWorld();
        get('./levels/' + levelId, function(data) {
            api.loadItems(JSON.parse(data.data));
            api.step();
            api.setLevelMetadata({
                name: data.name,
                id: data.id
            });
            if (callback) callback();
        });
        api.sortItems();
    },
    loadItems: function(items) {
        
        if (!Array.isArray(items)) {
            items = [items];
        }

        items = items.map(function(item) {
            var entity = item;
            if (!entity.type) entity = Entities[item.entity](item);
            entity.load();
            universalDecorators.forEach(function(decorator) {
                decorator(entity);
            });
            return entity;
        });
        newItems = newItems.concat(items);
        if (items.length > 1) return items;
        return items[0];
    },
    getItems: function() {
        return world.slice();
    },
    getItemById: function(id) {
        return world.filter(function(item) {
            if (item.id === id) return true;
        })[0];
    },
    getItemsByType: function(type) {
        return world.filter(function(item) {
            if (item.type === type) return true;
        });
    },
    deleteItem: function(id) {
        world = world.filter(function(item) { if (item.id !== id) return true; });
        events.emit('entityCount');
    },
    getXs: function() {
        return xs;
    },
    updateNewItems: function() {
        world = world.concat(newItems);
        api.sortItems();
        if (newItems.length) events.emit('entityCount');
        newItems = [];
    },
    step: function() {
        api.updateNewItems();
        xs = [];
        ys = [];
        newItems = [];
        circles = [];
        squares = [];
        points = [];
        world.forEach(function(item) { 
            if (item.geometry === 'circle' && item.solid) {
                circles.push(item);
            }
            if (item.geometry === 'square' && item.solid) squares.push(item);
            if (item.geometry === 'point' && item.solid) points.push(item);
            item.collisionData = {};
            item.step.call(item); 
            if (item.geometry && item.solid && !item.inContainer()) xs = xs.concat(item.AABB.xs);
        });
        api.sortItems();
        xs.sort(function(a, b) {
            return (a.val - b.val);
        });
    },
    sortItems: function() {
        world.sort(function(a, b) {
            return a.onTop;
        });
    },
    getGeometry(geometry) {
        if (geometry === 'circle') return circles;
        if (geometry === 'square') return squares;
        if (geometry === 'point') return points;
    },
    getEntityTypes() {
        var entities = [];
        for (var entity in Entities) {
            entities.push(entity);
        };
        return entities;
    } 
};

module.exports = api;

},{"./events.js":11,"./get.js":12,"./getEntities.js":13,"./level.js":16,"./test-level.js":30}],37:[function(require,module,exports){
// Copyright Joyent, Inc. and other Node contributors.
//
// Permission is hereby granted, free of charge, to any person obtaining a
// copy of this software and associated documentation files (the
// "Software"), to deal in the Software without restriction, including
// without limitation the rights to use, copy, modify, merge, publish,
// distribute, sublicense, and/or sell copies of the Software, and to permit
// persons to whom the Software is furnished to do so, subject to the
// following conditions:
//
// The above copyright notice and this permission notice shall be included
// in all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS
// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN
// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE
// USE OR OTHER DEALINGS IN THE SOFTWARE.

function EventEmitter() {
  this._events = this._events || {};
  this._maxListeners = this._maxListeners || undefined;
}
module.exports = EventEmitter;

// Backwards-compat with node 0.10.x
EventEmitter.EventEmitter = EventEmitter;

EventEmitter.prototype._events = undefined;
EventEmitter.prototype._maxListeners = undefined;

// By default EventEmitters will print a warning if more than 10 listeners are
// added to it. This is a useful default which helps finding memory leaks.
EventEmitter.defaultMaxListeners = 10;

// Obviously not all Emitters should be limited to 10. This function allows
// that to be increased. Set to zero for unlimited.
EventEmitter.prototype.setMaxListeners = function(n) {
  if (!isNumber(n) || n < 0 || isNaN(n))
    throw TypeError('n must be a positive number');
  this._maxListeners = n;
  return this;
};

EventEmitter.prototype.emit = function(type) {
  var er, handler, len, args, i, listeners;

  if (!this._events)
    this._events = {};

  // If there is no 'error' event listener then throw.
  if (type === 'error') {
    if (!this._events.error ||
        (isObject(this._events.error) && !this._events.error.length)) {
      er = arguments[1];
      if (er instanceof Error) {
        throw er; // Unhandled 'error' event
      }
      throw TypeError('Uncaught, unspecified "error" event.');
    }
  }

  handler = this._events[type];

  if (isUndefined(handler))
    return false;

  if (isFunction(handler)) {
    switch (arguments.length) {
      // fast cases
      case 1:
        handler.call(this);
        break;
      case 2:
        handler.call(this, arguments[1]);
        break;
      case 3:
        handler.call(this, arguments[1], arguments[2]);
        break;
      // slower
      default:
        args = Array.prototype.slice.call(arguments, 1);
        handler.apply(this, args);
    }
  } else if (isObject(handler)) {
    args = Array.prototype.slice.call(arguments, 1);
    listeners = handler.slice();
    len = listeners.length;
    for (i = 0; i < len; i++)
      listeners[i].apply(this, args);
  }

  return true;
};

EventEmitter.prototype.addListener = function(type, listener) {
  var m;

  if (!isFunction(listener))
    throw TypeError('listener must be a function');

  if (!this._events)
    this._events = {};

  // To avoid recursion in the case that type === "newListener"! Before
  // adding it to the listeners, first emit "newListener".
  if (this._events.newListener)
    this.emit('newListener', type,
              isFunction(listener.listener) ?
              listener.listener : listener);

  if (!this._events[type])
    // Optimize the case of one listener. Don't need the extra array object.
    this._events[type] = listener;
  else if (isObject(this._events[type]))
    // If we've already got an array, just append.
    this._events[type].push(listener);
  else
    // Adding the second element, need to change to array.
    this._events[type] = [this._events[type], listener];

  // Check for listener leak
  if (isObject(this._events[type]) && !this._events[type].warned) {
    if (!isUndefined(this._maxListeners)) {
      m = this._maxListeners;
    } else {
      m = EventEmitter.defaultMaxListeners;
    }

    if (m && m > 0 && this._events[type].length > m) {
      this._events[type].warned = true;
      console.error('(node) warning: possible EventEmitter memory ' +
                    'leak detected. %d listeners added. ' +
                    'Use emitter.setMaxListeners() to increase limit.',
                    this._events[type].length);
      if (typeof console.trace === 'function') {
        // not supported in IE 10
        console.trace();
      }
    }
  }

  return this;
};

EventEmitter.prototype.on = EventEmitter.prototype.addListener;

EventEmitter.prototype.once = function(type, listener) {
  if (!isFunction(listener))
    throw TypeError('listener must be a function');

  var fired = false;

  function g() {
    this.removeListener(type, g);

    if (!fired) {
      fired = true;
      listener.apply(this, arguments);
    }
  }

  g.listener = listener;
  this.on(type, g);

  return this;
};

// emits a 'removeListener' event iff the listener was removed
EventEmitter.prototype.removeListener = function(type, listener) {
  var list, position, length, i;

  if (!isFunction(listener))
    throw TypeError('listener must be a function');

  if (!this._events || !this._events[type])
    return this;

  list = this._events[type];
  length = list.length;
  position = -1;

  if (list === listener ||
      (isFunction(list.listener) && list.listener === listener)) {
    delete this._events[type];
    if (this._events.removeListener)
      this.emit('removeListener', type, listener);

  } else if (isObject(list)) {
    for (i = length; i-- > 0;) {
      if (list[i] === listener ||
          (list[i].listener && list[i].listener === listener)) {
        position = i;
        break;
      }
    }

    if (position < 0)
      return this;

    if (list.length === 1) {
      list.length = 0;
      delete this._events[type];
    } else {
      list.splice(position, 1);
    }

    if (this._events.removeListener)
      this.emit('removeListener', type, listener);
  }

  return this;
};

EventEmitter.prototype.removeAllListeners = function(type) {
  var key, listeners;

  if (!this._events)
    return this;

  // not listening for removeListener, no need to emit
  if (!this._events.removeListener) {
    if (arguments.length === 0)
      this._events = {};
    else if (this._events[type])
      delete this._events[type];
    return this;
  }

  // emit removeListener for all listeners on all events
  if (arguments.length === 0) {
    for (key in this._events) {
      if (key === 'removeListener') continue;
      this.removeAllListeners(key);
    }
    this.removeAllListeners('removeListener');
    this._events = {};
    return this;
  }

  listeners = this._events[type];

  if (isFunction(listeners)) {
    this.removeListener(type, listeners);
  } else if (listeners) {
    // LIFO order
    while (listeners.length)
      this.removeListener(type, listeners[listeners.length - 1]);
  }
  delete this._events[type];

  return this;
};

EventEmitter.prototype.listeners = function(type) {
  var ret;
  if (!this._events || !this._events[type])
    ret = [];
  else if (isFunction(this._events[type]))
    ret = [this._events[type]];
  else
    ret = this._events[type].slice();
  return ret;
};

EventEmitter.prototype.listenerCount = function(type) {
  if (this._events) {
    var evlistener = this._events[type];

    if (isFunction(evlistener))
      return 1;
    else if (evlistener)
      return evlistener.length;
  }
  return 0;
};

EventEmitter.listenerCount = function(emitter, type) {
  return emitter.listenerCount(type);
};

function isFunction(arg) {
  return typeof arg === 'function';
}

function isNumber(arg) {
  return typeof arg === 'number';
}

function isObject(arg) {
  return typeof arg === 'object' && arg !== null;
}

function isUndefined(arg) {
  return arg === void 0;
}

},{}]},{},[9])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3Vzci9saWIvbm9kZV9tb2R1bGVzL2Jyb3dzZXJpZnkvbm9kZV9tb2R1bGVzL2Jyb3dzZXItcGFjay9fcHJlbHVkZS5qcyIsInB1YmxpYy9qcy9QbGF5ZXIuanMiLCJwdWJsaWMvanMvWm9tYmllLmpzIiwicHVibGljL2pzL2FuaW1hdGlvblNoaW0uanMiLCJwdWJsaWMvanMvYmFzZUVudGl0eS5qcyIsInB1YmxpYy9qcy9idWxsZXQuanMiLCJwdWJsaWMvanMvY2hhcmFjdGVyLmpzIiwicHVibGljL2pzL2RvbS5qcyIsInB1YmxpYy9qcy9lZGl0b3ItY29udHJvbGxlci5qcyIsInB1YmxpYy9qcy9lZGl0b3ItbWFpbi5qcyIsInB1YmxpYy9qcy9lZmZlY3RzLmpzIiwicHVibGljL2pzL2V2ZW50cy5qcyIsInB1YmxpYy9qcy9nZXQuanMiLCJwdWJsaWMvanMvZ2V0RW50aXRpZXMuanMiLCJwdWJsaWMvanMvZ2V0SWQuanMiLCJwdWJsaWMvanMvZ3VuLmpzIiwicHVibGljL2pzL2xldmVsLmpzIiwicHVibGljL2pzL21ha2VHZW9tZXRyeS5qcyIsInB1YmxpYy9qcy9tYWtlSW5pdGlhbENvbmRpdGlvbnNTYXZhYmxlLmpzIiwicHVibGljL2pzL21ha2VJbnZlbnRvcnkuanMiLCJwdWJsaWMvanMvbWFrZVNvbGlkLmpzIiwicHVibGljL2pzL21ha2VTdGFydE9wdGlvbnMuanMiLCJwdWJsaWMvanMvbWFrZVZpc2libGUuanMiLCJwdWJsaWMvanMvbWF0cml4U3RhY2suanMiLCJwdWJsaWMvanMvcG9zdC5qcyIsInB1YmxpYy9qcy9wcm9qZWN0aWxlLmpzIiwicHVibGljL2pzL3JlbmRlcmVyLmpzIiwicHVibGljL2pzL3NwYXduZXIuanMiLCJwdWJsaWMvanMvc3ByaXRlcy5qcyIsInB1YmxpYy9qcy9zcXVhcmUuanMiLCJwdWJsaWMvanMvdGVzdC1sZXZlbC5qcyIsInB1YmxpYy9qcy90ZXN0LW9iai5qcyIsInB1YmxpYy9qcy90ZXh0dXJlRGF0YS5qcyIsInB1YmxpYy9qcy93YWxsLmpzIiwicHVibGljL2pzL3dlYXBvbi5qcyIsInB1YmxpYy9qcy93ZWJnbC1sYWIuanMiLCJwdWJsaWMvanMvd29ybGQuanMiLCIuLi8uLi8uLi91c3IvbGliL25vZGVfbW9kdWxlcy9icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9ldmVudHMvZXZlbnRzLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FDQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDM0VBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNoRkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDeEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3pHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNoREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM3REE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2hPQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDMVRBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzFGQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNaQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMzQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3BCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ1RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzlCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNyQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDakxBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDNUJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2pDQTtBQUNBO0FBQ0E7QUFDQTs7QUNIQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDWEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNoQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDekRBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN2QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNiQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ25FQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDL0NBO0FBQ0E7O0FDREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNoQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNuQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2pCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDeERBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNYQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMzQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDblBBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzdJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3ZhciBmPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIrbytcIidcIik7dGhyb3cgZi5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGZ9dmFyIGw9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGwuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sbCxsLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2Zvcih2YXIgbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9KSIsInZhciBldmVudHMgPSByZXF1aXJlKCcuL2V2ZW50cy5qcycpO1xudmFyIENoYXJhY3RlciA9IHJlcXVpcmUoJy4vY2hhcmFjdGVyLmpzJyk7XG5cbm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24ob3B0aW9ucykge1xuXG4gICAgdmFyIHBsYXllciA9IENoYXJhY3Rlcih7XG4gICAgICAgIHBvczogb3B0aW9ucy5wb3MsXG4gICAgICAgIHR5cGU6ICdwbGF5ZXInLFxuICAgICAgICBtb2RlOiAnc3RhbmRpbmcnLFxuICAgICAgICBtb2Rlczoge1xuICAgICAgICAgICAgZGllOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBldmVudHMuZW1pdCgnZGllJyk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc3RhbmRpbmc6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHBsYXllci5wb3NlLnkgPSAwO1xuICAgICAgICAgICAgICAgIHBsYXllci52ZWxvY2l0eSA9IDA7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcnVubmluZzogZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB3YWxraW5nOiBmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNob290aW5nOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBwbGF5ZXIucG9zZS55ID0gMTtcbiAgICAgICAgICAgICAgICBpZiAocGxheWVyLmN1cnJlbnRXZWFwb25zLmxlbmd0aCA9PT0gMCkgcmV0dXJuO1xuICAgICAgICAgICAgICAgIHZhciBjb29sRG93biA9IHBsYXllci5jdXJyZW50V2VhcG9uc1twbGF5ZXIud2VpbGRpbmddLmNvb2xEb3duO1xuICAgICAgICAgICAgICAgIHZhciB0aWNrID0gY29vbERvd24gLSAxO1xuICAgICAgICAgICAgICAgIHBsYXllci5hZGRFZmZlY3QoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChwbGF5ZXIuY3VycmVudE1vZGUgIT09ICdzaG9vdGluZycpIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgdGljaysrO1xuICAgICAgICAgICAgICAgICAgICBpZiAodGljayA+IGNvb2xEb3duKSB7IFxuICAgICAgICAgICAgICAgICAgICAgICAgcGxheWVyLmN1cnJlbnRXZWFwb25zW3BsYXllci53ZWlsZGluZ10udXNlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aWNrID0gMDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBjb2xsaWRlOiBmdW5jdGlvbihjb2xsaWRlcikge1xuICAgICAgICAgICAgc3dpdGNoIChjb2xsaWRlci5iYXNlKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAnd2VhcG9uJzpcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFjb2xsaWRlci5pbkNvbnRhaW5lcigpKSBwbGF5ZXIudGFrZUl0ZW1zKGNvbGxpZGVyKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgc3dpdGNoIChjb2xsaWRlci50eXBlKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAnem9tYmllJzpcbiAgICAgICAgICAgICAgICAgICAgZXZlbnRzLmVtaXQoJ2dhbWVPdmVyJyk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdnYW1lb3ZlcnJycnJyJyk7XG4gICAgICAgICAgICAgICAgICAgIC8vcGxheWVyLmhlYWx0aCAtPSAwLjQ7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgfSk7XG4gICAgcGxheWVyLm5leHRXZWFwb24gPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcGxheWVyLndlaWxkaW5nKys7XG4gICAgICAgIGlmICh3ZWlsZGluZyA9PT0gcGxheWVyLmN1cnJlbnRXZWFwb25zLmxlbmd0aCkgd2VpbGRpbmcgPSAwO1xuICAgIH07XG4gICAgcGxheWVyLndlaWxkaW5nID0gMDtcbiAgICBwbGF5ZXIuYWRkRWZmZWN0KGZ1bmN0aW9uKCkge1xuICAgICAgICBwbGF5ZXIuY3VycmVudFdlYXBvbnMgPSBwbGF5ZXIuZ2V0SW52ZW50b3J5QnlCYXNlKCd3ZWFwb24nKTtcbiAgICAgICAgcGxheWVyLmN1cnJlbnRXZWFwb25zLmZvckVhY2goZnVuY3Rpb24od2VhcG9uLCBpbmRleCkge1xuICAgICAgICAgICAgaWYgKHdlYXBvbi5zZWxlY3RXZWFwb24pIHBsYXllci53ZWlsZGluZyA9IGluZGV4O1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSk7XG5cblxuICAgIHJldHVybiBwbGF5ZXI7XG59O1xuIiwidmFyIENoYXJhY3RlciA9IHJlcXVpcmUoJy4vY2hhcmFjdGVyLmpzJyk7XG5cbm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24ob3B0aW9ucykge1xuXG4gICAgdmFyIGN1cnJlbnRBdHRyYWN0b3IgPSBmYWxzZTtcbiAgICB2YXIgc3BlZWQgPSAxICsgTWF0aC5yYW5kb20oKSAqIDM7XG5cbiAgICB2YXIgem9tYmllID0gQ2hhcmFjdGVyKHtcbiAgICAgICAgdHlwZTogJ3pvbWJpZScsXG4gICAgICAgIG1vZGU6ICd3YW5kZXJpbmcnLFxuICAgICAgICBwb3M6IG9wdGlvbnMucG9zLFxuICAgICAgICBtb2Rlczoge1xuICAgICAgICAgICAgcmV3YW5kZXJpbmc6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHpvbWJpZS5hZGRNb2RlKCd3YW5kZXJpbmcnKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB3YW5kZXJpbmc6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2coJ3dhbmRlcmluZycpO1xuICAgICAgICAgICAgICAgIC8vaWYgKE1hdGgucmFuZG9tKCkgPCAwLjA1KSB6b21iaWUuYXVkaW8gPSAnZ3Jvd2wnO1xuICAgICAgICAgICAgICAgIHZhciB0aW1lTGVuZ3RoID0gMSArIHBhcnNlSW50KE1hdGgucmFuZG9tKCkgKiAzICogMTAwMCk7XG4gICAgICAgICAgICAgICAgdmFyIHN0YXJ0VGltZSA9IERhdGUubm93KCk7XG4gICAgICAgICAgICAgICAgdmFyIHJhbmRvbVNwZWVkID0gTWF0aC5yYW5kb20oKSAqIDI7XG4gICAgICAgICAgICAgICAgem9tYmllLnBvcy5yb3QgPSBNYXRoLnJhbmRvbSgpICogTWF0aC5QSSAqIDI7XG4gICAgICAgICAgICAgICAgem9tYmllLnBvc2UueSA9IDE7XG5cbiAgICAgICAgICAgICAgICB6b21iaWUuYWRkRWZmZWN0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgbm93ID0gRGF0ZS5ub3coKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHpvbWJpZS5jdXJyZW50TW9kZSAhPT0gJ3dhbmRlcmluZycpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAoc3RhcnRUaW1lICsgdGltZUxlbmd0aCA8IG5vdykge1xuICAgICAgICAgICAgICAgICAgICAgICAgem9tYmllLmFkZE1vZGUoJ3Jld2FuZGVyaW5nJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7IFxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHpvbWJpZS5wdXNoKHt4OiBNYXRoLmNvcyh6b21iaWUucG9zLnJvdCkgKiByYW5kb21TcGVlZCwgeTogTWF0aC5zaW4oem9tYmllLnBvcy5yb3QpICogcmFuZG9tU3BlZWR9KTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2VhcmNoaW5nOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjaGFzaW5nOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICB6b21iaWUuYWRkRWZmZWN0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgdGhldGEgPSB6b21iaWUubG9va0F0T2JqKGN1cnJlbnRBdHRyYWN0b3IpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoem9tYmllLmN1cnJlbnRNb2RlICE9PSAnY2hhc2luZycgfHwgIWN1cnJlbnRBdHRyYWN0b3IpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB6b21iaWUucHVzaCh7eDogTWF0aC5jb3ModGhldGEpICogc3BlZWQgLyAyLCB5OiBNYXRoLnNpbih0aGV0YSkgKiBzcGVlZCAvIDJ9KTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcnVubmluZzogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgYml0aW5nOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzdGFnZ2VyaW5nOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBkaWU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHpvbWJpZS51bmxvYWQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgY29sbGlkZTogZnVuY3Rpb24oY29sbGlkZXIpIHtcbiAgICAgICAgICAgIHN3aXRjaCAoY29sbGlkZXIudHlwZSkge1xuICAgICAgICAgICAgICAgIGNhc2UgJ2J1bGxldCc6XG4gICAgICAgICAgICAgICAgY2FzZSAnbWVlbGVlJzpcbiAgICAgICAgICAgICAgICAgICAgem9tYmllLmhlYWx0aCAtPSBjb2xsaWRlci5wb3dlciAvIDEwMDtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9KTtcblxuICAgIHpvbWJpZS5zdGVwKGZ1bmN0aW9uKCkge1xuICAgICAgICBjdXJyZW50QXR0cmFjdG9yID0gd29ybGQuZ2V0SXRlbXNCeVR5cGUoJ3BsYXllcicpWzBdO1xuICAgICAgICBpZiAoY3VycmVudEF0dHJhY3Rvcikge1xuICAgICAgICAgICAgem9tYmllLmFkZE1vZGUoJ2NoYXNpbmcnKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHpvbWJpZS5hZGRNb2RlKCd3YW5kZXJpbmcnKTtcbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgcmV0dXJuIHpvbWJpZTtcbn07XG4iLCIoZnVuY3Rpb24oKSB7XG4gICAgdmFyIGxhc3RUaW1lID0gMDtcbiAgICB2YXIgdmVuZG9ycyA9IFsnbXMnLCAnbW96JywgJ3dlYmtpdCcsICdvJ107XG4gICAgZm9yKHZhciB4ID0gMDsgeCA8IHZlbmRvcnMubGVuZ3RoICYmICF3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lOyArK3gpIHtcbiAgICAgICAgd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZSA9IHdpbmRvd1t2ZW5kb3JzW3hdKydSZXF1ZXN0QW5pbWF0aW9uRnJhbWUnXTtcbiAgICAgICAgd2luZG93LmNhbmNlbEFuaW1hdGlvbkZyYW1lID0gd2luZG93W3ZlbmRvcnNbeF0rJ0NhbmNlbEFuaW1hdGlvbkZyYW1lJ10gXG4gICAgICAgICAgICB8fCB3aW5kb3dbdmVuZG9yc1t4XSsnQ2FuY2VsUmVxdWVzdEFuaW1hdGlvbkZyYW1lJ107XG4gICAgfVxuXG4gICAgaWYgKCF3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lKVxuICAgICAgICB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lID0gZnVuY3Rpb24oY2FsbGJhY2ssIGVsZW1lbnQpIHtcbiAgICAgICAgICAgIHZhciBjdXJyVGltZSA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xuICAgICAgICAgICAgdmFyIHRpbWVUb0NhbGwgPSBNYXRoLm1heCgwLCAxNiAtIChjdXJyVGltZSAtIGxhc3RUaW1lKSk7XG4gICAgICAgICAgICB2YXIgaWQgPSB3aW5kb3cuc2V0VGltZW91dChmdW5jdGlvbigpIHsgY2FsbGJhY2soY3VyclRpbWUgKyB0aW1lVG9DYWxsKTsgfSwgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aW1lVG9DYWxsKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhc3RUaW1lID0gY3VyclRpbWUgKyB0aW1lVG9DYWxsO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGlkO1xuICAgICAgICB9O1xuXG4gICAgICAgIGlmICghd2luZG93LmNhbmNlbEFuaW1hdGlvbkZyYW1lKVxuICAgICAgICAgICAgd2luZG93LmNhbmNlbEFuaW1hdGlvbkZyYW1lID0gZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQoaWQpO1xuICAgICAgICAgICAgfTtcbn0oKSk7XG4iLCJ2YXIgZ2V0SWQgPSByZXF1aXJlKCcuL2dldElkLmpzJykuZ2V0SWQ7XG5cblxubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgcHVzaEV2ZW50cyA9IFtdO1xuICAgIHZhciBtb3ZlRXZlbnRzID0gW107XG4gICAgdmFyIGxvYWRFdmVudHMgPSBbXTtcbiAgICB2YXIgdW5sb2FkRXZlbnRzID0gW107XG4gICAgdmFyIHN0ZXBFdmVudHMgPSBbXTtcbiAgICB2YXIgbG9hZGVkID0gZmFsc2U7XG4gICAgdmFyIG1vdmVkID0gZmFsc2U7XG4gICAgdmFyIG5ld0VmZmVjdHMgPSBbXTtcbiAgICB2YXIgZWZmZWN0cyA9IFtdO1xuICAgIHZhciBvYmogPSB7XG4gICAgICAgIGluQ29udGFpbmVyOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiAoISFvYmoub3duZXIpO1xuICAgICAgICB9LFxuICAgICAgICBsb2FkOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhciBhcmdzID0gW10uc2xpY2UuY2FsbChhcmd1bWVudHMpO1xuICAgICAgICAgICAgaWYgKGFyZ3MubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgaWYgKGxvYWRlZCkge1xuICAgICAgICAgICAgICAgICAgICBhcmdzLmZvckVhY2goZnVuY3Rpb24oZSkgeyBlKCk7IH0pO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGxvYWRFdmVudHMgPSBhcmdzLmNvbmNhdChsb2FkRXZlbnRzKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCFsb2FkZWQpIHtcbiAgICAgICAgICAgICAgICBsb2FkRXZlbnRzLmZvckVhY2goZnVuY3Rpb24oZSkgeyBlKCk7IH0pO1xuICAgICAgICAgICAgICAgIGxvYWRlZCA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHVubG9hZDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXIgYXJncyA9IFtdLnNsaWNlLmNhbGwoYXJndW1lbnRzKTtcbiAgICAgICAgICAgIGlmIChhcmdzLmxlbmd0aCA+IDApIHJldHVybiB1bmxvYWRFdmVudHMgPSBhcmdzLmNvbmNhdCh1bmxvYWRFdmVudHMpO1xuICAgICAgICAgICAgdW5sb2FkRXZlbnRzLmZvckVhY2goZnVuY3Rpb24oZSkgeyBlKCk7IH0pO1xuICAgICAgICAgICAgd29ybGQuZGVsZXRlSXRlbShvYmouaWQpO1xuICAgICAgICAgICAgaWYgKG9iai5vd25lcikgb2JqLm93bmVyLmRyb3BJdGVtKG9iaik7XG4gICAgICAgIH0sXG4gICAgICAgIHN0ZXA6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyIGFyZ3MgPSBbXS5zbGljZS5jYWxsKGFyZ3VtZW50cyk7XG4gICAgICAgICAgICBpZiAoYXJncy5sZW5ndGggPiAwKSByZXR1cm4gc3RlcEV2ZW50cyA9IGFyZ3MuY29uY2F0KHN0ZXBFdmVudHMpO1xuICAgICAgICAgICAgc3RlcEV2ZW50cy5mb3JFYWNoKGZ1bmN0aW9uKGUpIHsgZSgpOyB9KTtcbiAgICAgICAgICAgIGVmZmVjdHMgPSBlZmZlY3RzLmNvbmNhdChuZXdFZmZlY3RzKTtcbiAgICAgICAgICAgIG5ld0VmZmVjdHMgPSBbXTtcbiAgICAgICAgICAgIGVmZmVjdHMgPSBlZmZlY3RzLmZpbHRlcihmdW5jdGlvbihpdGVtKSB7IHJldHVybiBpdGVtLmNhbGwob2JqKTsgfSk7XG4gICAgICAgICAgICBpZiAobW92ZWQpIG9iai5wcm9jZXNzTW92ZW1lbnRFdmVudHMoKTtcbiAgICAgICAgICAgIGlmIChvYmoucG9zLnJvdCA+IE1hdGguUEkgKiAyKSBvYmoucG9zLnJvdCAtPSBNYXRoLlBJICogMjtcbiAgICAgICAgICAgIGlmIChvYmoucG9zLnJvdCA8IDApIG9iai5wb3Mucm90ICs9IE1hdGguUEkgKiAyO1xuXG4gICAgICAgIH0sXG4gICAgICAgIHByb2Nlc3NNb3ZlbWVudEV2ZW50czogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBvYmoudmVsb2NpdHkgPSBNYXRoLnNxcnQob2JqLnBvcy52ZWMueCAqIG9iai5wb3MudmVjLnggKyBvYmoucG9zLnZlYy55ICogb2JqLnBvcy52ZWMueSk7XG4gICAgICAgICAgICBpZiAob2JqLnZlbG9jaXR5ID4gMzApIHtcbiAgICAgICAgICAgICAgICAvL2RlYnVnZ2VyO1xuICAgICAgICAgICAgICAgIG9iai5wb3MudmVjLnggPSBvYmoucG9zLnZlYy54IC8gKG9iai52ZWxvY2l0eSAvIDMwKTtcbiAgICAgICAgICAgICAgICBvYmoucG9zLnZlYy55ID0gb2JqLnBvcy52ZWMueSAvIChvYmoudmVsb2NpdHkgLyAzMCk7XG4gICAgICAgICAgICAgICAgb2JqLnZlbG9jaXR5ID0gMzA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBvYmoucG9zLnggKz0gb2JqLnBvcy52ZWMueDtcbiAgICAgICAgICAgIG9iai5wb3MueSArPSBvYmoucG9zLnZlYy55O1xuICAgICAgICAgICAgaWYgKG9iai5vd25lcikge1xuICAgICAgICAgICAgICAgIG9iai5tb3ZlKG9iai5vd25lci5wb3MpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgb2JqLnBvcy52ZWMueCA9IDA7XG4gICAgICAgICAgICBvYmoucG9zLnZlYy55ID0gMDtcbiAgICAgICAgICAgIG1vdmVFdmVudHMuZm9yRWFjaChmdW5jdGlvbihmbikgeyBmbigpOyB9KTtcbiAgICAgICAgICAgIG1vdmVkID0gZmFsc2U7XG4gICAgICAgIH0sXG4gICAgICAgIGlkOiBnZXRJZCgpLFxuICAgICAgICBwb3M6IHtcbiAgICAgICAgICAgIHg6IDAsXG4gICAgICAgICAgICB5OiAwLFxuICAgICAgICAgICAgcm90OiAwLFxuICAgICAgICAgICAgdmVjOiB7XG4gICAgICAgICAgICAgICAgeDogMCxcbiAgICAgICAgICAgICAgICB5OiAwXG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIG1vdmU6IGZ1bmN0aW9uKHBvcykge1xuICAgICAgICAgICAgaWYgKHBvcy5ldikge1xuICAgICAgICAgICAgICAgIG1vdmVFdmVudHMucHVzaChwb3MuZXYpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHBvcy54KSBvYmoucG9zLnggPSBwb3MueDtcbiAgICAgICAgICAgIGlmIChwb3MueSkgb2JqLnBvcy55ID0gcG9zLnk7XG4gICAgICAgICAgICBpZiAocG9zLnJvdCkgb2JqLnBvcy5yb3QgPSBwb3Mucm90O1xuICAgICAgICAgICAgbW92ZWQgPSB0cnVlO1xuICAgICAgICB9LFxuICAgICAgICBwdXNoOiBmdW5jdGlvbih2ZWMpIHtcbiAgICAgICAgICAgIGlmICh2ZWMuZXYpIHtcbiAgICAgICAgICAgICAgICBtb3ZlRXZlbnRzLnB1c2godmVjLmV2KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh2ZWMueCkgb2JqLnBvcy52ZWMueCArPSB2ZWMueDtcbiAgICAgICAgICAgIGlmICh2ZWMueSkgb2JqLnBvcy52ZWMueSArPSB2ZWMueTtcbiAgICAgICAgICAgIG1vdmVkID0gdHJ1ZTtcbiAgICAgICAgfSxcbiAgICAgICAgYWRkRWZmZWN0OiBmdW5jdGlvbihmbikge1xuICAgICAgICAgICAgbmV3RWZmZWN0cy5wdXNoKGZuKTtcbiAgICAgICAgfVxuICAgIH07XG5cblxuICAgIHJldHVybiBvYmo7XG59O1xuXG4iLCJ2YXIgcHJvamVjdGlsZSA9IHJlcXVpcmUoJy4vcHJvamVjdGlsZS5qcycpO1xudmFyIG1ha2VTb2xpZCA9IHJlcXVpcmUoJy4vbWFrZVNvbGlkLmpzJyk7XG5cbnZhciBCdWxsZXQgPSBmdW5jdGlvbihvcHRpb25zKSB7XG5cbiAgICB2YXIgYnVsbGV0ID0gcHJvamVjdGlsZSgpO1xuXG4gICAgYnVsbGV0LmZpcmUgPSBmdW5jdGlvbihwb3MpIHtcbiAgICAgICAgdmFyIGRpc3RhbmNlID0gMDtcbiAgICAgICAgdmFyIHRoZXRhID0gcG9zLnJvdDtcbiAgICAgICAgYnVsbGV0LmluZXJ0aWEgPSB0cnVlO1xuICAgICAgICBidWxsZXQucG9zLnJvdCA9IHBvcy5yb3Q7XG4gICAgICAgIGJ1bGxldC5vblRvcCA9IHRydWU7XG4gICAgICAgIGJ1bGxldC52ZWxvY2l0eSA9IDI1O1xuICAgICAgICBtYWtlU29saWQoYnVsbGV0KTtcbiAgICAgICAgYnVsbGV0LnN0ZXAoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZiAoYnVsbGV0LmRpZSB8fCBkaXN0YW5jZSA+IGJ1bGxldC5yYW5nZSkgYnVsbGV0LnVubG9hZCgpO1xuICAgICAgICAgICAgZGlzdGFuY2UrKztcbiAgICAgICAgICAgIGJ1bGxldC5wdXNoKHt4OiBNYXRoLmNvcyh0aGV0YSkgKiBidWxsZXQudmVsb2NpdHksIHk6IE1hdGguc2luKHRoZXRhKSAqIGJ1bGxldC52ZWxvY2l0eX0pO1xuICAgICAgICB9KTtcbiAgICAgICAgYnVsbGV0LnJhZGl1cyA9IDE7XG4gICAgICAgIGJ1bGxldC5jb2xsaWRlID0gZnVuY3Rpb24oY29sbGlkZXIpe1xuICAgICAgICAgICAgc3dpdGNoIChjb2xsaWRlci50eXBlKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAnem9tYmllJzpcbiAgICAgICAgICAgICAgICAgICAgYnVsbGV0LnVubG9hZCgpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHN3aXRjaCAoY29sbGlkZXIuYmFzZSkge1xuICAgICAgICAgICAgICAgIGNhc2UgJ3NxdWFyZSc6XG4gICAgICAgICAgICAgICAgICAgIGJ1bGxldC51bmxvYWQoKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgYnVsbGV0Lm1vdmUoe3g6IHBvcy54ICsgTWF0aC5jb3ModGhldGEpICogNzUsIHk6IHBvcy55ICsgTWF0aC5zaW4odGhldGEpICogNzV9KTtcbiAgICB9O1xuXG4gICAgZm9yICh2YXIga2V5IGluIG9wdGlvbnMpIHtcbiAgICAgICAgYnVsbGV0W2tleV0gPSBvcHRpb25zW2tleV07XG4gICAgfVxuXG4gICAgYnVsbGV0LnR5cGUgPSAnYnVsbGV0JztcbiAgICByZXR1cm4gYnVsbGV0O1xufTtcblxuXG5cblxubW9kdWxlLmV4cG9ydHMgPSBCdWxsZXQ7XG4iLCJ2YXIgYmFzZUVudGl0eSA9IHJlcXVpcmUoJy4vYmFzZUVudGl0eS5qcycpO1xudmFyIG1ha2VWaXNpYmxlID0gcmVxdWlyZSgnLi9tYWtlVmlzaWJsZS5qcycpO1xudmFyIG1ha2VJbnZlbnRvcnkgPSByZXF1aXJlKCcuL21ha2VJbnZlbnRvcnkuanMnKTtcbnZhciBtYWtlU29saWQgPSByZXF1aXJlKCcuL21ha2VTb2xpZC5qcycpO1xudmFyIG1ha2VHZW9tZXRyeSA9IHJlcXVpcmUoJy4vbWFrZUdlb21ldHJ5LmpzJyk7XG5cbm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24ob3B0aW9ucykge1xuICAgIHZhciBjaGFyYWN0ZXIgPSBiYXNlRW50aXR5KCk7XG4gICAgdmFyIGFuaVRpY2sgPSAwO1xuICAgIG1ha2VJbnZlbnRvcnkoY2hhcmFjdGVyKTtcbiAgICBtYWtlR2VvbWV0cnkoY2hhcmFjdGVyLCAnY2lyY2xlJyk7XG4gICAgbWFrZVNvbGlkKGNoYXJhY3Rlcik7XG4gICAgbWFrZVZpc2libGUoY2hhcmFjdGVyKTtcbiAgICBjaGFyYWN0ZXIucmFkaXVzID0gNTA7XG4gICAgY2hhcmFjdGVyLnNvbGlkID0gdHJ1ZTtcbiAgICBjaGFyYWN0ZXIub25Ub3AgPSB0cnVlO1xuICAgIGNoYXJhY3Rlci5nZW9tZXRyeSA9ICdjaXJjbGUnO1xuICAgIGNoYXJhY3Rlci5sb29rQXRWZWMgPSBmdW5jdGlvbih2ZWMpIHtcbiAgICAgICAgdmFyIHRoZXRhID0gTWF0aC5hdGFuMih2ZWMueSwgdmVjLngpO1xuICAgICAgICBjaGFyYWN0ZXIucG9zLnJvdCA9IHRoZXRhICsgTWF0aC5QSTtcbiAgICAgICAgcmV0dXJuIHRoZXRhO1xuICAgIH07XG4gICAgY2hhcmFjdGVyLmxvb2tBdE9iaiA9IGZ1bmN0aW9uKG9iaikge1xuICAgICAgICB2YXIgdGhldGEgPSBNYXRoLmF0YW4yKG9iai5wb3MueSAtIGNoYXJhY3Rlci5wb3MueSwgb2JqLnBvcy54IC0gY2hhcmFjdGVyLnBvcy54KTtcbiAgICAgICAgY2hhcmFjdGVyLnBvcy5yb3QgPSB0aGV0YTtcbiAgICAgICAgcmV0dXJuIHRoZXRhO1xuICAgIH07XG4gICAgY2hhcmFjdGVyLmJhc2UgPSAnY2hhcmFjdGVyJztcbiAgICBjaGFyYWN0ZXIuaGVhbHRoID0gMTtcbiAgICBjaGFyYWN0ZXIuc3RlcChmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKGNoYXJhY3Rlci5oZWFsdGggPD0gMCkgY2hhcmFjdGVyLmFkZE1vZGUoJ2RpZScpO1xuICAgICAgICBhbmlUaWNrKys7XG4gICAgICAgIGlmICghY2hhcmFjdGVyLnZlbG9jaXR5KSB7XG4gICAgICAgICAgICBjaGFyYWN0ZXIucG9zZS54ID0gMDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmIChhbmlUaWNrID4gMTYgLSBjaGFyYWN0ZXIudmVsb2NpdHkpIHtcbiAgICAgICAgICAgICAgICBhbmlUaWNrID0gMDtcbiAgICAgICAgICAgICAgICBpZiAoY2hhcmFjdGVyLnBvc2UueCA8IGNoYXJhY3Rlci50ZXh0dXJlRGF0YS5wb3Nlcy5zbGlkZXNbY2hhcmFjdGVyLnBvc2UueV0gLSAxKSB7XG4gICAgICAgICAgICAgICAgICAgIGNoYXJhY3Rlci5wb3NlLngrKztcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBjaGFyYWN0ZXIucG9zZS54ID0gMDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGFuaVRpY2srKztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0pO1xuICAgIGNoYXJhY3Rlci5tb2RlcyA9IG9wdGlvbnMubW9kZXM7XG4gICAgY2hhcmFjdGVyLmNvbGxpZGUgPSBvcHRpb25zLmNvbGxpZGU7XG4gICAgY2hhcmFjdGVyLnR5cGUgPSBvcHRpb25zLnR5cGU7XG4gICAgY2hhcmFjdGVyLmFkZE1vZGUgPSBmdW5jdGlvbihtb2RlKSB7XG4gICAgICAgIGlmIChjaGFyYWN0ZXIuY3VycmVudE1vZGUgPT09IG1vZGUpIHJldHVybjtcbiAgICAgICAgY2hhcmFjdGVyLmN1cnJlbnRNb2RlID0gbW9kZTtcbiAgICAgICAgY2hhcmFjdGVyLm1vZGVzW21vZGVdKCk7XG4gICAgfTtcbiAgICBjaGFyYWN0ZXIucG9zZSA9IHt4OiAwLCB5OiAwfTtcbiAgICBjaGFyYWN0ZXIubG9hZChmdW5jdGlvbigpIHsgY2hhcmFjdGVyLmFkZE1vZGUob3B0aW9ucy5tb2RlKTsgfSk7XG4gICAgY2hhcmFjdGVyLm1vdmUob3B0aW9ucy5wb3MpO1xuICAgIHJldHVybiBjaGFyYWN0ZXI7XG59O1xuXG4iLCJkb2N1bWVudC5vbmNvbnRleHRtZW51ID0gZnVuY3Rpb24oKSB7IHJldHVybiBmYWxzZTsgfVxudmFyIGxvYWRlZCA9IGZhbHNlO1xudmFyIGV2ZW50cyA9IHJlcXVpcmUoJy4vZXZlbnRzLmpzJyk7XG52YXIgZ2V0SWQgPSByZXF1aXJlKCcuL2dldElkLmpzJykuZ2V0SWQ7XG52YXIgZWZmZWN0cyA9IHJlcXVpcmUoJy4vZWZmZWN0cy5qcycpO1xudmFyIG9ianMgPSB7fTtcbnZhciBtZW51cyA9IHt9O1xudmFyIGlucHV0cyA9IHt9O1xud2luZG93LmZ1bmN0aW9ucyA9IHt9O1xudmFyIG1lbnVDbG9zZUV2ZW50cyA9IHt9O1xudmFyIGxvYWRFdmVudHMgPSBbXTtcbnZhciBjYW52YXNlcyA9IHt9O1xudmFyIG9sZFdlYXBvbnMgPSBbXTtcbnZhciBpY29uRXZlbnRzID0gW107XG52YXIgd2VhcG9uSWNvbnMgPSBbXTtcblxuXG53aW5kb3cub25sb2FkID0gZnVuY3Rpb24oKSB7IFxuICAgIFtdLnNsaWNlLmNhbGwoZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgnbWVudXMnKSkuZm9yRWFjaChmdW5jdGlvbihvYmosIGluZGV4LCBhcnJheSkgeyBcbiAgICAgICAgbWVudXNbb2JqLmlkXSA9IG9iajsgXG4gICAgICAgIGVmZmVjdHMuZmFkZU91dChvYmopO1xuICAgIH0pO1xuICAgIFtdLnNsaWNlLmNhbGwoZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgnZG9tb2JqJykpLmZvckVhY2goZnVuY3Rpb24ob2JqLCBpbmRleCwgYXJyYXkpIHsgXG4gICAgICAgIG9ianNbb2JqLmlkXSA9IG9iajsgXG4gICAgfSk7XG4gICAgW10uc2xpY2UuY2FsbChkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnaW5wdXQnKSkuZm9yRWFjaChmdW5jdGlvbihvYmosIGluZGV4LCBhcnJheSkgeyBcbiAgICAgICAgaW5wdXRzW29iai5pZF0gPSBvYmo7IFxuICAgIH0pO1xuICAgIG9ianNbJ21vZGFsQWNrJ10uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbigpIHsgZWZmZWN0cy5mYWRlT3V0KG9ianNbJ21vZGFsJ10pOyB9KTtcbiAgICBvYmpzWyd3aW5kb3cnXSA9IHdpbmRvdztcbiAgICBsb2FkZWQgPSB0cnVlOyBcbiAgICBsb2FkRXZlbnRzLmZvckVhY2goZnVuY3Rpb24oZXYpIHsgZXYoKTsgfSk7IFxufTtcblxudmFyIGVuc3VyZU9iaklkID0gZnVuY3Rpb24ob2JqKSB7XG4gICAgaWYgKG9iai5pZCkgcmV0dXJuIG9iai5pZDtcbiAgICBvYmouaWQgPSBnZXRJZCgpO1xuICAgIG9ianNbb2JqLmlkXSA9IG9iajtcbiAgICByZXR1cm4gb2JqLmlkO1xufTtcblxudmFyIHJlc2V0Q2FudmFzID0gZnVuY3Rpb24oY2FudmFzKSB7XG4gICAgdmFyIGNhbnZhc1dpZHRoID0gY2FudmFzLmdldEF0dHJpYnV0ZSgnd2lkdGgnKTtcbiAgICB2YXIgY2FudmFzSGVpZ2h0ID0gY2FudmFzLmdldEF0dHJpYnV0ZSgnaGVpZ2h0Jyk7XG4gICAgdmFyIHNjcmVlbldpZHRoID0gd2luZG93LmlubmVyV2lkdGg7XG4gICAgdmFyIHNjcmVlbkhlaWdodCA9IHdpbmRvdy5pbm5lckhlaWdodDtcbiAgICBpZiAoY2FudmFzV2lkdGggLyBjYW52YXNIZWlnaHQgPiBzY3JlZW5XaWR0aCAvIHNjcmVlbkhlaWdodCkge1xuICAgICAgICBjYW52YXMuc3R5bGUud2lkdGggPSBzY3JlZW5XaWR0aCArICdweCc7XG4gICAgICAgIGNhbnZhcy5zdHlsZS5oZWlnaHQgPSBzY3JlZW5XaWR0aCAqIChjYW52YXNIZWlnaHQgLyBjYW52YXNXaWR0aCkgKyAncHgnO1xuICAgICAgICBjYW52YXMuc3R5bGUudG9wID0gKHNjcmVlbkhlaWdodCAtIChzY3JlZW5XaWR0aCAqIChjYW52YXNIZWlnaHQgLyBjYW52YXNXaWR0aCkpKSAvIDIgKyAncHgnO1xuICAgICAgICBjYW52YXMuc3R5bGUubGVmdCA9ICcwcHgnOyBcbiAgICB9IGVsc2Uge1xuICAgICAgICBjYW52YXMuc3R5bGUuaGVpZ2h0ID0gc2NyZWVuSGVpZ2h0ICsgJ3B4JztcbiAgICAgICAgY2FudmFzLnN0eWxlLndpZHRoID0gc2NyZWVuSGVpZ2h0ICogKGNhbnZhc1dpZHRoIC8gY2FudmFzSGVpZ2h0KSArICdweCc7XG4gICAgICAgIGNhbnZhcy5zdHlsZS5sZWZ0ID0gKHNjcmVlbldpZHRoIC0gKHNjcmVlbkhlaWdodCAqIChjYW52YXNXaWR0aCAvIGNhbnZhc0hlaWdodCkpKSAvIDIgKyAncHgnO1xuICAgICAgICBjYW52YXMuc3R5bGUudG9wID0gJzBweCc7IFxuICAgIH1cbn07XG5cblxuXG52YXIgYXBpID0ge1xuICAgIHNldENhbnZhczogZnVuY3Rpb24oaWQsIGRpbSkge1xuICAgICAgICBpZiAoZGltKSB7XG4gICAgICAgICAgICBvYmpzW2lkXS5zZXRBdHRyaWJ1dGUoJ3dpZHRoJywgZGltLndpZHRoKTtcbiAgICAgICAgICAgIG9ianNbaWRdLnNldEF0dHJpYnV0ZSgnaGVpZ2h0JywgZGltLmhlaWdodCk7XG4gICAgICAgICAgICBpZiAoIWNhbnZhc2VzW2lkXSkge1xuICAgICAgICAgICAgICAgIGNhbnZhc2VzW2lkXSA9IG9ianNbaWRdO1xuICAgICAgICAgICAgICAgIHJlc2V0Q2FudmFzKG9ianNbaWRdKTtcbiAgICAgICAgICAgICAgICBhcGkuYXR0YWNoRXZlbnQoJ3dpbmRvdycsICdyZXNpemUnLCByZXNldENhbnZhcy5iaW5kKG51bGwsIG9ianNbaWRdKSk7XG4gICAgICAgICAgICB9IFxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBvYmpzW2lkXS5nZXRDb250ZXh0KCd3ZWJnbCcpO1xuICAgIH0sXG4gICAgY2xlYXJJbnB1dHM6IGZ1bmN0aW9uKGFuY2VzdG9yKSB7XG4gICAgICAgIGFuY2VzdG9yID0gYXBpLmdldE9iakJ5SWQoYW5jZXN0b3IpO1xuICAgICAgICBmb3IgKHZhciBpbnB1dCBpbiBpbnB1dHMpIHtcbiAgICAgICAgICAgIGlmIChhbmNlc3Rvci5jb250YWlucyhpbnB1dHNbaW5wdXRdKSkgaW5wdXRzW2lucHV0XS52YWx1ZSA9ICcnO1xuICAgICAgICB9XG4gICAgfSxcbiAgICBvbkhpZGVNZW51OiBmdW5jdGlvbihpZCwgZnVuYykge1xuICAgICAgICBpZiAoIW1lbnVDbG9zZUV2ZW50c1tpZF0pIG1lbnVDbG9zZUV2ZW50c1tpZF0gPSBbXTtcbiAgICAgICAgbWVudUNsb3NlRXZlbnRzW2lkXS5wdXNoKGZ1bmMpO1xuICAgIH0sXG4gICAgaGlkZU1lbnU6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgIGlmIChpZCkge1xuICAgICAgICAgICAgZWZmZWN0cy5mYWRlT3V0KG1lbnVzW2lkXSk7XG4gICAgICAgICAgICBpZiAobWVudUNsb3NlRXZlbnRzW2lkXSkge1xuICAgICAgICAgICAgICAgIG1lbnVDbG9zZUV2ZW50c1tpZF0uZm9yRWFjaChmdW5jdGlvbihmKSB7IGYoKTsgfSk7XG4gICAgICAgICAgICAgICAgbWVudUNsb3NlRXZlbnRzW2lkXSA9IFtdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGZvciAodmFyIG1lbnUgaW4gbWVudXMpIHtcbiAgICAgICAgICAgIGlmIChtZW51c1ttZW51XS5pZCAhPT0gJ3dvcmxkSW5zcGVjdG9yJykge1xuICAgICAgICAgICAgICAgIGVmZmVjdHMuZmFkZU91dChtZW51c1ttZW51XSk7XG4gICAgICAgICAgICAgICAgaWYgKG1lbnVDbG9zZUV2ZW50c1ttZW51XSkge1xuICAgICAgICAgICAgICAgICAgICBtZW51Q2xvc2VFdmVudHNbbWVudV0uZm9yRWFjaChmdW5jdGlvbihmKSB7IGYoKTsgfSk7XG4gICAgICAgICAgICAgICAgICAgIG1lbnVDbG9zZUV2ZW50c1ttZW51XSA9IFtdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0sXG4gICAgc2hvd01lbnU6IGZ1bmN0aW9uKGlkLCBwb3MpIHtcbiAgICAgICAgZWZmZWN0cy5mYWRlSW4obWVudXNbaWRdKTtcbiAgICAgICAgaWYgKHBvcykge1xuICAgICAgICAgICAgbWVudXNbaWRdLnN0eWxlLmxlZnQgPSBwYXJzZUludChwb3MueCAtIDIwKSArICdweCc7XG4gICAgICAgICAgICBtZW51c1tpZF0uc3R5bGUudG9wID0gcGFyc2VJbnQocG9zLnkgLSAyMCkgKyAncHgnO1xuICAgICAgICB9XG4gICAgfSxcbiAgICBnZXRJdGVtc0J5Q2xhc3M6IGZ1bmN0aW9uKGMpIHtcbiAgICAgICAgcmV0dXJuIFtdLnNsaWNlLmNhbGwoZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZShjKSkubWFwKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICAgICAgICAgIHJldHVybiBpdGVtLmlkO1xuICAgICAgICB9KTs7XG4gICAgfSxcbiAgICBhZGRMaXN0SXRlbTogZnVuY3Rpb24odWwsIGxpKSB7XG4gICAgICAgIG9ianNbdWxdLmFwcGVuZENoaWxkKG9ianNbbGldKTtcbiAgICB9LFxuICAgIGFkZE1lbnVMaXN0SXRlbTogZnVuY3Rpb24oaWQsIHRleHQsIGNsaWNrLCBtb3VzZW92ZXIpIHtcbiAgICAgICAgdmFyIGxpID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGknKTtcbiAgICAgICAgdmFyIHNwYW4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJyk7XG4gICAgICAgIGVuc3VyZU9iaklkKGxpKTtcbiAgICAgICAgc3Bhbi5pbm5lclRleHQgPSB0ZXh0O1xuICAgICAgICBsaS5hcHBlbmRDaGlsZChzcGFuKTtcbiAgICAgICAgaWYgKGNsaWNrKSBzcGFuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgY2xpY2spO1xuICAgICAgICBpZiAobW91c2VvdmVyKSBzcGFuLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlb3ZlcicsIG1vdXNlb3Zlcik7XG4gICAgICAgIG9ianNbaWRdLmFwcGVuZENoaWxkKGxpKTtcbiAgICAgICAgcmV0dXJuIGxpLmlkO1xuICAgIH0sXG4gICAgY2xlYXJMaXN0SXRlbXM6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgIFtdLnNsaWNlLmNhbGwob2Jqc1tpZF0uY2hpbGRyZW4pLmZvckVhY2goZnVuY3Rpb24oY2hpbGQpIHtcbiAgICAgICAgICAgaWYgKCFjaGlsZC5jbGFzc05hbWUuc3BsaXQoJyAnKS5yZWR1Y2UoZnVuY3Rpb24oYSwgYikge1xuICAgICAgICAgICAgICAgIGlmIChhKSByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICBpZiAoYiA9PT0gJ2xpc3RJdGVtJykgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICB9LCBmYWxzZSkpIG9ianNbaWRdLnJlbW92ZUNoaWxkKGNoaWxkKTtcbiAgICAgICAgfSk7XG4gICAgfSxcbiAgICBnZXRJbnB1dHNWYWx1ZXM6IGZ1bmN0aW9uKGFuY2VzdG9yKSB7XG4gICAgICAgIHJldHVybiBbXS5zbGljZS5jYWxsKGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdzZWxlY3QnKSkuXG4gICAgICAgICAgICBjb25jYXQoW10uc2xpY2UuY2FsbChkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnaW5wdXQnKSkpLlxuICAgICAgICAgICAgZmlsdGVyKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gKG9ianNbYW5jZXN0b3JdLmNvbnRhaW5zKGl0ZW0pKTtcbiAgICAgICAgICAgIH0pLm1hcChmdW5jdGlvbihpdGVtKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHtpZDogaXRlbS5pZCwgdmFsdWU6IGl0ZW0udmFsdWV9O1xuICAgICAgICAgICAgfSk7XG4gICAgfSxcbiAgICBvbmxvYWQ6IGZ1bmN0aW9uKGV2KSB7XG4gICAgICAgIGlmIChsb2FkZWQpIHJldHVybiBldigpO1xuICAgICAgICBsb2FkRXZlbnRzLnB1c2goZXYpO1xuICAgIH0sXG4gICAgZ2V0R2VuZXJpY0xpc3RJdGVtOiBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ2dlbmVyaWNMaXN0SXRlbScpWzBdLmNsb25lTm9kZSh0cnVlKTtcbiAgICB9LFxuICAgIGF0dGFjaEV2ZW50OiBmdW5jdGlvbihpZCwgdHlwZSwgZnVuYykge1xuICAgICAgICBpZiAoaWQuY2xvbmVOb2RlKSBpZCA9IGVuc3VyZU9iaklkKGlkKTtcbiAgICAgICAgdmFyIGZpZCA9IGdldElkKCk7XG4gICAgICAgIGZ1bmN0aW9uc1tmaWRdID0ge2Y6IGZ1bmMsIGlkOiBpZCwgdHlwZTogdHlwZX07XG4gICAgICAgIGFwaS5vbmxvYWQoZnVuY3Rpb24oKSB7IFxuICAgICAgICAgICAgb2Jqc1tpZF0uYWRkRXZlbnRMaXN0ZW5lcih0eXBlLCBmdW5jKTsgXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gZmlkO1xuICAgIH0sXG4gICAgZGV0YWNoRXZlbnQ6IGZ1bmN0aW9uKGZpZCkge1xuICAgICAgICB2YXIgZXYgPSBmdW5jdGlvbnNbZmlkXTtcbiAgICAgICAgaWYgKG9ianNbZXYuaWRdLnJlbW92ZUV2ZW50TGlzdGVuZXIpIG9ianNbZXYuaWRdLnJlbW92ZUV2ZW50TGlzdGVuZXIoZXYudHlwZSwgZXYuZik7XG4gICAgICAgIGRlbGV0ZSBmdW5jdGlvbnNbZmlkXTtcbiAgICB9LFxuICAgIGRpc3BsYXk6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgIFtdLnNsaWNlLmNhbGwoZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgnc2xpZGVzJykpLmZvckVhY2goZnVuY3Rpb24ob2JqKSB7IGVmZmVjdHMuZmFkZU91dChvYmopOyB9KTtcbiAgICAgICAgZWZmZWN0cy5mYWRlSW4ob2Jqc1tpZF0pO1xuICAgIH0sXG4gICAgZ2V0T2JqQnlJZDogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgcmV0dXJuIG9ianNbaWRdO1xuICAgIH0sXG4gICAgZ2V0R2VuZXJpY0J1dHRvbjogZnVuY3Rpb24odGV4dCwgY2xpY2ssIG1vdXNlb3Zlcikge1xuICAgICAgICB2YXIgYnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYnV0dG9uJyk7XG4gICAgICAgIGJ1dHRvbi5pbm5lclRleHQgPSB0ZXh0O1xuICAgICAgICBpZiAoY2xpY2spIGJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGNsaWNrKTtcbiAgICAgICAgaWYgKG1vdXNlb3ZlcikgYnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlb3ZlcicsIG1vdXNlb3Zlcik7XG4gICAgICAgIHJldHVybiBidXR0b247XG4gICAgfSxcbiAgICBtb2RhbDogZnVuY3Rpb24obXNnKSB7XG4gICAgICAgIGFwaS5nZXRPYmpCeUlkKCdtb2RhbE1zZycpLmlubmVyVGV4dCA9IG1zZztcbiAgICAgICAgZWZmZWN0cy5mYWRlSW4oYXBpLmdldE9iakJ5SWQoJ21vZGFsJykpO1xuICAgIH0sXG4gICAgdXBkYXRlV2VhcG9uSWNvbnM6IGZ1bmN0aW9uKHdlYXBvbnMpIHtcbiAgICAgICAgdmFyIGNoYW5nZWQ7XG4gICAgICAgIGlmICh3ZWFwb25zKSB7XG4gICAgICAgICAgICB3ZWFwb25zLmZvckVhY2goZnVuY3Rpb24od2VhcG9uKSB7XG4gICAgICAgICAgICAgICAgaWYgKHdlYXBvbnMudHlwZSAhPT0gb2xkV2VhcG9ucy50eXBlKSBjaGFuZ2VkID0gdHJ1ZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgaWYgKGNoYW5nZWQpIHtcbiAgICAgICAgICAgICAgICBvbGRXZWFwb25zID0gd2VhcG9ucztcbiAgICAgICAgICAgICAgICB3ZWFwb25JY29ucy5mb3JFYWNoKGZ1bmN0aW9uKGljb24pIHtcbiAgICAgICAgICAgICAgICAgICAgd2VhcG9uSWNvbnNbaW5kZXhdLnN0eWxlLmJhY2tncm91bmRJbWFnZSA9ICcnO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGljb25FdmVudHMuZm9yRWFjaChmdW5jdGlvbihldikge1xuICAgICAgICAgICAgICAgICAgICBldi5kb20ucmVtb3ZlRXZlbnRMaXN0ZW5lcihldi5mdW5jKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB3ZWFwb25zLmZvckVhY2goZnVuY3Rpb24od2VhcG9uLCBpbmRleCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgY2xpY2sgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdlYXBvbi5zZWxlY3RXZWFwb24gPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICB3ZWFwb25JY29uc1tpbmRleF0uc3R5bGUuYmFja2dyb3VuZEltYWdlID0gd2VhcG9uLmljb247XG4gICAgICAgICAgICAgICAgICAgIGljb25FdmVudHMucHVzaCh7ZG9tOiB3ZWFwb25JY29uc1tpbmRleF0sIGZ1bmM6IGNsaWNrfSk7XG4gICAgICAgICAgICAgICAgICAgIHdlYXBvbkljb25zLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgY2xpY2spO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxufTtcblxuZm9yICh2YXIgaSA9IDA7IGkgPCA0OyBpKyspIHtcbiAgICB3ZWFwb25JY29ucy5wdXNoKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJykpO1xuICAgIHdlYXBvbkljb25zW2ldLmNsYXNzTmFtZSA9ICd3ZWFwb25pY29uJztcbiAgICAoZnVuY3Rpb24oKSB7IFxuICAgICAgICB2YXIgaiA9IGk7XG4gICAgICAgIGlmIChvYmpzWyd3ZWFwb25PcHRpb25zJ10pIGFwaS5vbmxvYWQoZnVuY3Rpb24oKSB7IFxuICAgICAgICAgICAgb2Jqc1snd2VhcG9uT3B0aW9ucyddLmFwcGVuZENoaWxkKHdlYXBvbkljb25zW2pdKTsgXG4gICAgICAgIH0pO1xuICAgIH0pKCk7XG59XG5tb2R1bGUuZXhwb3J0cyA9IGFwaTtcbiIsInZhciBtYWtlU3RhcnRPcHRpb25zID0gcmVxdWlyZSgnLi9tYWtlU3RhcnRPcHRpb25zLmpzJyk7XG52YXIgcG9zdCA9IHJlcXVpcmUoJy4vcG9zdC5qcycpO1xudmFyIHRlc3RPYmogPSByZXF1aXJlKCcuL3Rlc3Qtb2JqLmpzJyk7XG52YXIgd29ybGQgPSByZXF1aXJlKCcuL3dvcmxkLmpzJyk7XG52YXIgY2FudmFzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NhbnZhcycpO1xudmFyIGdldElkID0gcmVxdWlyZSgnLi9nZXRJZC5qcycpLmdldElkO1xudmFyIGV2ZW50cyA9IHJlcXVpcmUoJy4vZXZlbnRzLmpzJyk7XG52YXIgZG9tID0gcmVxdWlyZSgnLi9kb20uanMnKTtcbnZhciBlZGl0aW5nT2JqID0gZmFsc2U7XG52YXIgZHJhZ2dpbmdPYmogPSBmYWxzZTtcbnZhciB3b3JsZEluc3BlY3RvckZpZHMgPSBbXTtcbnZhciBjbGlja09iaiA9IHt9O1xudmFyIGNhbWVyYSA9IHRlc3RPYmooe3Bvczoge1xuICAgIHg6IDEwMDAsXG4gICAgeTogMTAwMFxufX0pO1xuY2FtZXJhLmNhbWVyYSA9IHRydWU7XG5jYW1lcmEubG9hZCgpO1xuY2FtZXJhLnN0ZXAoKTtcblxuZnVuY3Rpb24gcGF1c2VFdmVudChlKXtcbiAgICBpZihlLnN0b3BQcm9wYWdhdGlvbikgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICBpZihlLnByZXZlbnREZWZhdWx0KSBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgZS5jYW5jZWxCdWJibGU9dHJ1ZTtcbiAgICBlLnJldHVyblZhbHVlPWZhbHNlO1xuICAgIHJldHVybiBmYWxzZTtcbn07XG5cbnZhciBzY3JlZW5XaWR0aCA9IGNhbnZhcy5jbGllbnRXaWR0aDtcbnZhciBzY3JlZW5IZWlnaHQgPSBjYW52YXMuY2xpZW50SGVpZ2h0O1xudmFyIG1vdXNlUG9zID0ge3g6IDAsIHk6IDB9O1xudmFyIG1lbnVJdGVtcyA9IHtcbiAgICBnZW9tZXRyeToge1xuICAgICAgICBzcXVhcmU6IFtdLFxuICAgICAgICBjaXJjbGU6IFtdXG4gICAgfSxcbiAgICBiYXNlOiB7XG4gICAgICAgIHNwYXduZXI6IFtdXG4gICAgfVxufTtcblxudmFyIHN0YXRlID0gJ25vTWVudXMnO1xudmFyIHN0YXRlcyA9IHtcbiAgICBub01lbnVzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgZG9tLmhpZGVNZW51KCk7XG4gICAgfSxcbiAgICBlZGl0aW5nT2JqOiBmdW5jdGlvbihldiwgb2JqKSB7XG4gICAgICAgIGlmICghb2JqKSBvYmogPSBjbGlja09iajtcbiAgICAgICAgZG9tLmhpZGVNZW51KCk7XG4gICAgICAgIGRvbS5jbGVhcklucHV0cygnb2JqSW5zcGVjdG9yJyk7XG4gICAgICAgIGRvbS5jbGVhckxpc3RJdGVtcygnb2JqSW5zcGVjdG9yJyk7XG4gICAgICAgIGVkaXRpbmdPYmogPSBvYmo7XG4gICAgICAgIHVwZGF0ZU9iakluc3BlY3Rvck9wdGlvbnMoKTtcbiAgICAgICAgZG9tLnNob3dNZW51KCdvYmpJbnNwZWN0b3InKTtcbiAgICAgICAgdXBkYXRlT2JqSW5zcGVjdG9yKCk7XG4gICAgICAgIGZvY3VzT25FZGl0aW5nT2JqKCk7XG4gICAgICAgIGRvbS5vbkhpZGVNZW51KCdvYmpJbnNwZWN0b3InLCBmdW5jdGlvbigpIHsgZWRpdGluZ09iaiA9IG51bGw7IH0pO1xuICAgIH0sXG4gICAgbGV2ZWxNZW51OiBmdW5jdGlvbihnYW1lUG9zLCBjYW52YXNQb3MpIHtcbiAgICAgICAgZG9tLmhpZGVNZW51KCk7XG4gICAgICAgIGRvbS5zaG93TWVudSgnbGV2ZWxNZW51JywgY2FudmFzUG9zKTtcbiAgICAgICAgZG9tLmNsZWFyTGlzdEl0ZW1zKCdsZXZlbE1lbnVPYmpzJyk7XG4gICAgICAgIHZhciBmaWQgPSBkb20uYXR0YWNoRXZlbnQoJ2xldmVsTWVudScsICdtb3VzZW91dCcsIGZ1bmN0aW9uKGV2KSB7XG4gICAgICAgICAgICBpZiAoZG9tLmdldE9iakJ5SWQoJ2xldmVsTWVudScpLmNvbnRhaW5zKGV2LnRvRWxlbWVudCkpIHJldHVybjtcbiAgICAgICAgICAgIHVwZGF0ZVN0YXRlKCdub01lbnVzJyk7XG4gICAgICAgIH0pO1xuICAgICAgICBkb20ub25IaWRlTWVudSgnbGV2ZWxNZW51JywgZnVuY3Rpb24oKSB7IGRvbS5kZXRhY2hFdmVudChmaWQpOyB9KTtcbiAgICAgICAgZ2V0Q29sbGlkaW5nT2JqcyhjbGlja09iaikuZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7XG4gICAgICAgICAgICBkb20uYWRkTWVudUxpc3RJdGVtKCdsZXZlbE1lbnVPYmpzJywgKGl0ZW0udHlwZSArICcgICcgKyBpdGVtLmlkKSwgZnVuY3Rpb24oZXYpIHtcbiAgICAgICAgICAgICAgICBkb20uaGlkZU1lbnUoJ2xldmVsTWVudScpO1xuICAgICAgICAgICAgICAgIHVwZGF0ZVN0YXRlKCdlZGl0aW5nT2JqJywgZXYsIGl0ZW0pO1xuICAgICAgICAgICAgfSwgZnVuY3Rpb24oZXYpIHtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9XG59O1xuXG5cbnZhciB1cGRhdGVTdGF0ZSA9IGZ1bmN0aW9uKG5ld1N0YXRlKSB7XG4gICAgc3RhdGUgPSBuZXdTdGF0ZTtcbiAgICBzdGF0ZXNbc3RhdGVdLmFwcGx5KG51bGwsIFtdLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKSk7XG59O1xuXG52YXIgZ2V0Q29sbGlkaW5nT2JqcyA9IGZ1bmN0aW9uKHRlc3RPYmopIHtcbiAgICByZXR1cm4gd29ybGQuZ2V0SXRlbXMoKS5maWx0ZXIoZnVuY3Rpb24ob2JqKSB7XG4gICAgICAgIHJldHVybiAob2JqLmRldGVjdENvbGxpZGUodGVzdE9iaikpO1xuICAgIH0pO1xufTtcblxudmFyIHVwZGF0ZU9iakluc3BlY3RvciA9IGZ1bmN0aW9uKCkge1xuICAgIGlmICghZWRpdGluZ09iaikgcmV0dXJuO1xuICAgIGRvbS5nZXRPYmpCeUlkKCdvYmpUeXBlJykudmFsdWUgPSBlZGl0aW5nT2JqLnR5cGU7XG4gICAgZG9tLmdldE9iakJ5SWQoJ29ialhQb3MnKS52YWx1ZSA9IGVkaXRpbmdPYmoucG9zLng7XG4gICAgZG9tLmdldE9iakJ5SWQoJ29iallQb3MnKS52YWx1ZSA9IGVkaXRpbmdPYmoucG9zLnk7XG4gICAgZG9tLmdldE9iakJ5SWQoJ29ialJvdGF0aW9uJykudmFsdWUgPSBlZGl0aW5nT2JqLnBvcy5yb3Q7XG4gICAgaWYgKGVkaXRpbmdPYmoucmFkaXVzKSBkb20uZ2V0T2JqQnlJZCgnb2JqUmFkaXVzJykudmFsdWUgPSBlZGl0aW5nT2JqLnJhZGl1cztcbiAgICBpZiAoZWRpdGluZ09iai53aWR0aCkge1xuICAgICAgICBkb20uZ2V0T2JqQnlJZCgnb2JqV2lkdGgnKS52YWx1ZSA9IGVkaXRpbmdPYmoud2lkdGg7XG4gICAgICAgIGRvbS5nZXRPYmpCeUlkKCdvYmpIZWlnaHQnKS52YWx1ZSA9IGVkaXRpbmdPYmouaGVpZ2h0O1xuICAgIH1cbiAgICBpZiAoZWRpdGluZ09iai5iYXNlID09PSAnc3Bhd25lcicpIHtcbiAgICAgICAgZG9tLmdldE9iakJ5SWQoJ29ialN0YXJ0JykudmFsdWUgPSBlZGl0aW5nT2JqLnN0YXJ0T3B0aW9ucygpLnN0YXJ0O1xuICAgICAgICBkb20uZ2V0T2JqQnlJZCgnb2JqSW50ZXJ2YWwnKS52YWx1ZSA9IGVkaXRpbmdPYmouc3RhcnRPcHRpb25zKCkuaW50ZXJ2YWw7XG4gICAgICAgIGRvbS5nZXRPYmpCeUlkKCdvYmpTcGF3bkNvdW50JykudmFsdWUgPSBlZGl0aW5nT2JqLnN0YXJ0T3B0aW9ucygpLnNwYXduQ291bnQ7XG4gICAgfVxufTtcblxudmFyIHVwZGF0ZU9iakluc3BlY3Rvck9wdGlvbnMgPSBmdW5jdGlvbigpIHtcbiAgICBpZiAoZWRpdGluZ09iai5iYXNlID09PSAnc3Bhd25lcicpIG1lbnVJdGVtcy5iYXNlLnNwYXduZXIuZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7XG4gICAgICAgIGRvbS5hZGRMaXN0SXRlbSgnb2JqSW5zcGVjdG9yJywgaXRlbSk7XG4gICAgfSk7XG4gICAgaWYgKGVkaXRpbmdPYmouZ2VvbWV0cnkpIG1lbnVJdGVtcy5nZW9tZXRyeVtlZGl0aW5nT2JqLmdlb21ldHJ5XS5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICAgICAgZG9tLmFkZExpc3RJdGVtKCdvYmpJbnNwZWN0b3InLCBpdGVtKTtcbiAgICB9KTtcbn07XG5cbnZhciB1cGRhdGVFZGl0aW5nT2JqID0gZnVuY3Rpb24oKSB7XG4gICAgaWYgKCFlZGl0aW5nT2JqKSByZXR1cm47XG4gICAgdmFyIHZhbHVlcyA9IHt9O1xuICAgIGRvbS5nZXRJbnB1dHNWYWx1ZXMoJ29iakluc3BlY3RvcicpLmZvckVhY2goZnVuY3Rpb24oaXRlbSkge1xuICAgICAgICB2YWx1ZXNbaXRlbS5pZF0gPSBpdGVtLnZhbHVlO1xuICAgIH0pO1xuICAgIHZhciBuZXdPYmo7XG4gICAgaWYgKHZhbHVlcy5vYmpUeXBlICE9PSBlZGl0aW5nT2JqLnR5cGUpIHtcbiAgICAgICAgbmV3T2JqID0gd29ybGQubG9hZEl0ZW1zKHtcbiAgICAgICAgICAgIGVudGl0eTogZG9tLmdldE9iakJ5SWQoJ29ialR5cGUnKS52YWx1ZSxcbiAgICAgICAgICAgIHBvczoge1xuICAgICAgICAgICAgICAgIHg6IGVkaXRpbmdPYmoucG9zLngsXG4gICAgICAgICAgICAgICAgeTogZWRpdGluZ09iai5wb3MueVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgZWRpdGluZ09iai51bmxvYWQoKTtcbiAgICAgICAgZWRpdGluZ09iaiA9IG5ld09iajtcbiAgICAgICAgZG9tLmNsZWFyTGlzdEl0ZW1zKCdvYmpJbnNwZWN0b3InKTtcbiAgICAgICAgd29ybGQudXBkYXRlTmV3SXRlbXMoKTtcbiAgICAgICAgdXBkYXRlT2JqSW5zcGVjdG9yT3B0aW9ucygpO1xuICAgICAgICB1cGRhdGVPYmpJbnNwZWN0b3IoKTtcbiAgICAgICAgdmFsdWVzID0ge307XG4gICAgICAgIGRvbS5nZXRJbnB1dHNWYWx1ZXMoJ29iakluc3BlY3RvcicpLmZvckVhY2goZnVuY3Rpb24oaXRlbSkge1xuICAgICAgICAgICAgdmFsdWVzW2l0ZW0uaWRdID0gaXRlbS52YWx1ZTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGVkaXRpbmdPYmoubW92ZSh7eDogcGFyc2VJbnQodmFsdWVzLm9ialhQb3MpLCB5OiBwYXJzZUludCh2YWx1ZXMub2JqWVBvcyksIHJvdDogcGFyc2VGbG9hdCh2YWx1ZXMub2JqUm90YXRpb24pfSk7XG4gICAgaWYgKHZhbHVlcy5vYmpSYWRpdXMpIGVkaXRpbmdPYmoucmFkaXVzID0gcGFyc2VJbnQodmFsdWVzLm9ialJhZGl1cyk7XG4gICAgaWYgKHZhbHVlcy5vYmpXaWR0aCkgZWRpdGluZ09iai5zZXREaW1lbnNpb25zKHt3aWR0aDogdmFsdWVzLm9ialdpZHRoLCBoZWlnaHQ6IHZhbHVlcy5vYmpIZWlnaHR9KTtcbiAgICBpZiAoZWRpdGluZ09iai5iYXNlID09PSAnc3Bhd25lcicpIGVkaXRpbmdPYmouc3RhcnRPcHRpb25zKHtcbiAgICAgICAgc3RhcnQ6IHZhbHVlcy5vYmpTdGFydCxcbiAgICAgICAgaW50ZXJ2YWw6IHZhbHVlcy5vYmpJbnRlcnZhbCxcbiAgICAgICAgc3Bhd25Db3VudDogdmFsdWVzLm9ialNwYXduQ291bnRcbiAgICB9KTtcblxuICAgIGVkaXRpbmdPYmoucHJvY2Vzc01vdmVtZW50RXZlbnRzKCk7XG59O1xuXG52YXIgZGVsZXRlRWRpdGluZ09iaiA9IGZ1bmN0aW9uKCkge1xuICAgIGVkaXRpbmdPYmoudW5sb2FkKCk7XG4gICAgdXBkYXRlU3RhdGUoJ25vTWVudXMnKTtcbn07XG5cbnZhciBjbG9uZUVkaXRpbmdPYmogPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgbmV3T2JqID0gd29ybGQubG9hZEl0ZW1zKHtcbiAgICAgICAgZW50aXR5OiBlZGl0aW5nT2JqLnR5cGUsXG4gICAgICAgIHBvczoge1xuICAgICAgICAgICAgeDogZWRpdGluZ09iai5wb3MueCwgXG4gICAgICAgICAgICB5OiBlZGl0aW5nT2JqLnBvcy55LFxuICAgICAgICAgICAgcm90OiBlZGl0aW5nT2JqLnBvcy5yb3RcbiAgICAgICAgfSxcbiAgICAgICAgd2lkdGg6IGVkaXRpbmdPYmoud2lkdGgsXG4gICAgICAgIGhlaWdodDogZWRpdGluZ09iai5oZWlnaHRcbiAgICB9KTtcbiAgICBpZiAoZWRpdGluZ09iai5zdGFydE9wdGlvbnMpIHtcbiAgICAgICAgbmV3T2JqLnN0YXJ0T3B0aW9ucyhlZGl0aW5nT2JqLnN0YXJ0T3B0aW9ucygpKTtcbiAgICB9XG4gICAgd29ybGQudXBkYXRlTmV3SXRlbXMoKTtcbiAgICBuZXdPYmoucHJvY2Vzc01vdmVtZW50RXZlbnRzKCk7XG4gICAgbmV3T2JqLmxvYWQoKTtcbn07XG5cbnZhciB0cmFuc2xhdGVQb3NpdGlvbiA9IGZ1bmN0aW9uKHBvcykge1xuICAgIHZhciBjYW52YXNQb3MgPSB7XG4gICAgICAgIHg6IHBvcy54ICogKHdvcmxkLmNhbnZhc0RpbS54IC8gc2NyZWVuV2lkdGgpLFxuICAgICAgICB5OiBwb3MueSAqICh3b3JsZC5jYW52YXNEaW0ueSAvIHNjcmVlbkhlaWdodClcbiAgICB9O1xuICAgIHZhciBnYW1lUG9zID0ge1xuICAgICAgICB4OiBjYW52YXNQb3MueCAtICh3b3JsZC5jYW52YXNEaW0ueCAvIDIgLSBjYW1lcmEucG9zLngpLFxuICAgICAgICB5OiBjYW52YXNQb3MueSAtICh3b3JsZC5jYW52YXNEaW0ueSAvIDIgLSBjYW1lcmEucG9zLnkpXG4gICAgfVxuICAgIHJldHVybiBnYW1lUG9zO1xufTtcblxudmFyIGNhbnZhc0NsaWNrID0gZnVuY3Rpb24oZXYpIHtcbiAgICAvL2V2LnByZXZlbnREZWZhdWx0KCk7XG4gICAgcGF1c2VFdmVudChldik7XG4gICAgdmFyIHN0YXJ0TW91c2VQb3MgPSB7eDogZXYuY2xpZW50WCwgeTogZXYuY2xpZW50WX07XG4gICAgdmFyIHN0YXJ0R2FtZVBvcyA9IHRyYW5zbGF0ZVBvc2l0aW9uKHN0YXJ0TW91c2VQb3MpO1xuICAgIHZhciBzdGFydE9ialBvcztcbiAgICBjbGlja09iaiA9IHRlc3RPYmooe3Bvczogc3RhcnRHYW1lUG9zfSk7XG4gICAgY2xpY2tPYmoubG9hZCgpO1xuICAgIGNsaWNrT2JqLnN0ZXAoKTtcbiAgICBpZiAoZXYuYnV0dG9uID09PSAyKSB1cGRhdGVTdGF0ZSgnbGV2ZWxNZW51Jywgc3RhcnRHYW1lUG9zLCB7eDogZXYuY2xpZW50WCwgeTogZXYuY2xpZW50WX0pO1xuICAgIGlmIChldi5idXR0b24gPT09IDApIHtcbiAgICAgICAgaWYgKGVkaXRpbmdPYmogJiYgZ2V0Q29sbGlkaW5nT2JqcyhjbGlja09iaikuZmlsdGVyKGZ1bmN0aW9uKGl0ZW0pIHsgcmV0dXJuIChpdGVtLmlkID09PSBlZGl0aW5nT2JqLmlkKTsgfSkubGVuZ3RoKSB7XG4gICAgICAgICAgICBkcmFnZ2luZ09iaiA9IGVkaXRpbmdPYmo7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBkcmFnZ2luZ09iaiA9IGFwaS5jYW1lcmE7XG4gICAgICAgIH1cbiAgICAgICAgc3RhcnRPYmpQb3MgPSB7eDogZHJhZ2dpbmdPYmoucG9zLngsIHk6IGRyYWdnaW5nT2JqLnBvcy55fTtcbiAgICAgICAgdmFyIG1vdXNlbW92ZUZpZCA9IGRvbS5hdHRhY2hFdmVudCgnd2luZG93JywgJ21vdXNlbW92ZScsIGZ1bmN0aW9uKGV2KSB7XG4gICAgICAgICAgICBwYXVzZUV2ZW50KGV2KTtcbiAgICAgICAgICAgIHZhciBnYW1lUG9zID0gdHJhbnNsYXRlUG9zaXRpb24oe3g6IGV2LmNsaWVudFgsIHk6IGV2LmNsaWVudFl9KTtcbiAgICAgICAgICAgIHZhciBnYW1lUG9zRGVsdGEgPSB7eDogKGdhbWVQb3MueCAtIHN0YXJ0R2FtZVBvcy54KSwgeTogKGdhbWVQb3MueSAtIHN0YXJ0R2FtZVBvcy55KX07XG4gICAgICAgICAgICBpZiAoZHJhZ2dpbmdPYmouY2FtZXJhKSB7XG4gICAgICAgICAgICAgICAgZHJhZ2dpbmdPYmoubW92ZSh7eDogIChzdGFydE9ialBvcy54IC0gZ2FtZVBvc0RlbHRhLngpLCB5OiAgKHN0YXJ0T2JqUG9zLnkgLSBnYW1lUG9zRGVsdGEueSl9KTtcbiAgICAgICAgICAgICAgICBzdGFydE9ialBvcyA9IHt4OiBkcmFnZ2luZ09iai5wb3MueCwgeTogZHJhZ2dpbmdPYmoucG9zLnl9O1xuICAgICAgICAgICAgICAgIHN0YXJ0R2FtZVBvcyA9IGdhbWVQb3M7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGRyYWdnaW5nT2JqLm1vdmUoe3g6IHN0YXJ0T2JqUG9zLnggKyBnYW1lUG9zRGVsdGEueCwgeTogc3RhcnRPYmpQb3MueSArIGdhbWVQb3NEZWx0YS55fSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBkcmFnZ2luZ09iai5wcm9jZXNzTW92ZW1lbnRFdmVudHMoKTtcbiAgICAgICAgICAgIHVwZGF0ZU9iakluc3BlY3RvcigpO1xuICAgICAgICB9KTtcbiAgICAgICAgdmFyIG1vdXNldXBGaWQgPSBkb20uYXR0YWNoRXZlbnQoJ3dpbmRvdycsICdtb3VzZXVwJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBkb20uZGV0YWNoRXZlbnQobW91c2Vtb3ZlRmlkKTtcbiAgICAgICAgICAgIGRvbS5kZXRhY2hFdmVudChtb3VzZXVwRmlkKTtcbiAgICAgICAgICAgIGRyYWdnaW5nT2JqID0gZmFsc2U7XG4gICAgICAgIH0pO1xuICAgIH1cbn07XG5cbnZhciB1cGRhdGVXb3JsZEluc3BlY3RvciA9IGZ1bmN0aW9uKCkge1xuICAgIGRvbS5nZXRPYmpCeUlkKCdlbnRpdHlDb3VudCcpLmlubmVyVGV4dCA9IHdvcmxkLmdldEl0ZW1zKCkubGVuZ3RoO1xuICAgIGRvbS5jbGVhckxpc3RJdGVtcygnd29ybGRJbnNwZWN0b3InKTtcbiAgICB3b3JsZEluc3BlY3RvckZpZHMuZm9yRWFjaChmdW5jdGlvbihmaWQpIHsgZG9tLmRldGFjaEV2ZW50KGZpZCk7IH0pO1xuICAgIHdvcmxkSW5zcGVjdG9yRmlkcyA9IFtdO1xuICAgIHdvcmxkLmdldEl0ZW1zKCkuZm9yRWFjaChmdW5jdGlvbihlbnRpdHkpIHtcbiAgICAgICAgdmFyIGxpID0gZG9tLmdldEdlbmVyaWNMaXN0SXRlbSgpO1xuICAgICAgICBsaS5pbm5lclRleHQgPSBlbnRpdHkuYmFzZSArICcsICcgKyBlbnRpdHkudHlwZSArICcsICcgKyBlbnRpdHkuaWQ7XG4gICAgICAgIHdvcmxkSW5zcGVjdG9yRmlkcy5wdXNoKGRvbS5hdHRhY2hFdmVudChsaSwgJ2NsaWNrJywgZnVuY3Rpb24oZXYpIHtcbiAgICAgICAgICAgIHVwZGF0ZVN0YXRlKCdlZGl0aW5nT2JqJywgZXYsIGVudGl0eSk7XG4gICAgICAgIH0pKTtcbiAgICAgICAgZG9tLmFkZExpc3RJdGVtKCd3b3JsZEluc3BlY3RvcicsIGxpLmlkKTtcbiAgICB9KTtcbn07XG5cbnZhciBmb2N1c09uRWRpdGluZ09iaiA9IGZ1bmN0aW9uKCkge1xuICAgIGNhbWVyYS5tb3ZlKGVkaXRpbmdPYmoucG9zKTtcbn07XG5cbnZhciBzYXZlTGV2ZWwgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgb3V0cHV0ID0gW107XG4gICAgd29ybGQuZ2V0SXRlbXMoKS5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICAgICAgb3V0cHV0LnB1c2goaXRlbS5nZXRJbml0aWFsQ29uZGl0aW9ucygpKTtcbiAgICB9KTtcbiAgICBwb3N0KCcuL2xldmVscy8nLCB7XG4gICAgICAgIGRhdGE6IEpTT04uc3RyaW5naWZ5KG91dHB1dCksXG4gICAgICAgIG5hbWU6IHdvcmxkLmdldExldmVsTWV0YWRhdGEoKS5uYW1lLFxuICAgICAgICBpZDogd29ybGQuZ2V0TGV2ZWxNZXRhZGF0YSgpLmlkXG4gICAgfSwgZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgZG9tLm1vZGFsKEpTT04uc3RyaW5naWZ5KHJlc3BvbnNlKSk7XG4gICAgICAgIHdvcmxkLnNldExldmVsTWV0YWRhdGEocmVzcG9uc2UpO1xuICAgIH0pO1xuICAgIHVwZGF0ZVN0YXRlKCdub01lbnVzJyk7XG59O1xuXG52YXIgdXBkYXRlTGV2ZWxOYW1lID0gZnVuY3Rpb24oKSB7XG4gICAgZG9tLmdldE9iakJ5SWQoJ2xldmVsTmFtZScpLnZhbHVlID0gd29ybGQuZ2V0TGV2ZWxNZXRhZGF0YSgpLm5hbWU7XG59O1xuXG5cbnZhciBsZXZlbE5hbWVJbnB1dENoYW5nZWQgPSBmdW5jdGlvbigpIHtcbiAgICB3b3JsZC5zZXRMZXZlbE1ldGFkYXRhKHtuYW1lOiBkb20uZ2V0SW5wdXRzVmFsdWVzKCdsZXZlbE5hbWUnKVswXS52YWx1ZX0pO1xufTtcblxuZG9tLmF0dGFjaEV2ZW50KCdjYW52YXMnLCAnbW91c2Vkb3duJywgY2FudmFzQ2xpY2spO1xuZG9tLmF0dGFjaEV2ZW50KCduZXdMZXZlbCcsICdjbGljaycsIGV2ZW50cy5lbWl0LmJpbmQobnVsbCwgJ25ld0xldmVsJykpO1xuZG9tLmF0dGFjaEV2ZW50KCduZXdPYmplY3QnLCAnY2xpY2snLCB1cGRhdGVTdGF0ZS5iaW5kKG51bGwsICdlZGl0aW5nT2JqJykpO1xuZG9tLmF0dGFjaEV2ZW50KCdjbG9uZU9iaicsICdjbGljaycsIGNsb25lRWRpdGluZ09iaik7XG5kb20uYXR0YWNoRXZlbnQoJ2RlbGV0ZU9iaicsICdjbGljaycsIGRlbGV0ZUVkaXRpbmdPYmopO1xuZG9tLmF0dGFjaEV2ZW50KCdmb2N1c09iaicsICdjbGljaycsIGZvY3VzT25FZGl0aW5nT2JqKTtcbmRvbS5hdHRhY2hFdmVudCgnbGV2ZWxOYW1lJywgJ2NoYW5nZScsIGxldmVsTmFtZUlucHV0Q2hhbmdlZCk7XG5kb20uYXR0YWNoRXZlbnQoJ3NhdmVMZXZlbCcsICdjbGljaycsIHNhdmVMZXZlbCk7XG5kb20uYXR0YWNoRXZlbnQoJ21haW5NZW51QnV0dG9uJywgJ2NsaWNrJywgZXZlbnRzLmVtaXQuYmluZChudWxsLCAnbWFpbk1lbnUnKSk7XG5kb20ub25sb2FkKGZ1bmN0aW9uKCkge1xuICAgIGRvbS5zaG93TWVudSgnd29ybGRJbnNwZWN0b3InKTtcbiAgICB3b3JsZC5nZXRFbnRpdHlUeXBlcygpLmZvckVhY2goZnVuY3Rpb24odHlwZSkge1xuICAgICAgICB2YXIgdmFsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnb3B0aW9uJyk7XG4gICAgICAgIHZhbC5pbm5lclRleHQgPSB0eXBlO1xuICAgICAgICBkb20uZ2V0T2JqQnlJZCgnb2JqVHlwZScpLmFwcGVuZENoaWxkKHZhbCk7XG4gICAgfSk7XG4gICAgZG9tLmdldEl0ZW1zQnlDbGFzcygnY2lyY2xlR2VvbWV0cnknKS5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICAgICAgbWVudUl0ZW1zLmdlb21ldHJ5LmNpcmNsZS5wdXNoKGl0ZW0pO1xuICAgIH0pO1xuICAgIGRvbS5nZXRJdGVtc0J5Q2xhc3MoJ3NxdWFyZUdlb21ldHJ5JykuZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7XG4gICAgICAgIG1lbnVJdGVtcy5nZW9tZXRyeS5zcXVhcmUucHVzaChpdGVtKTtcbiAgICB9KTtcbiAgICBkb20uZ2V0SXRlbXNCeUNsYXNzKCdzcGF3bmVyQmFzZScpLmZvckVhY2goZnVuY3Rpb24oaXRlbSkge1xuICAgICAgICBtZW51SXRlbXMuYmFzZS5zcGF3bmVyLnB1c2goaXRlbSk7XG4gICAgfSk7XG4gICAgZG9tLmdldElucHV0c1ZhbHVlcygnb2JqSW5zcGVjdG9yJykuZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7XG4gICAgICAgIGRvbS5hdHRhY2hFdmVudChpdGVtLmlkLCAnY2hhbmdlJywgdXBkYXRlRWRpdGluZ09iaik7XG4gICAgfSk7XG59KTtcblxuZXZlbnRzLnJlZ2lzdGVyKCdlbnRpdHlDb3VudCcsIHVwZGF0ZVdvcmxkSW5zcGVjdG9yLCBnZXRJZCgpKTtcbmV2ZW50cy5yZWdpc3RlcigndXBkYXRlTGV2ZWxOYW1lJywgdXBkYXRlTGV2ZWxOYW1lLCBnZXRJZCgpKTtcblxuYXBpID0ge1xuICAgIGNhbWVyYTogY2FtZXJhXG59O1xuXG51cGRhdGVTdGF0ZShzdGF0ZSk7XG5cbm1vZHVsZS5leHBvcnRzID0gYXBpO1xuIiwicmVxdWlyZSgnLi9hbmltYXRpb25TaGltLmpzJyk7XG52YXIgcG9zdCA9IHJlcXVpcmUoJy4vcG9zdC5qcycpO1xud2luZG93LmxvZ2dpbmcgPSBbXTtcbnZhciBldmVudHMgPSByZXF1aXJlKCcuL2V2ZW50cy5qcycpO1xudmFyIG1ha2VJbml0aWFsQ29uZGl0aW9uc1NhdmFibGUgPSByZXF1aXJlKCcuL21ha2VJbml0aWFsQ29uZGl0aW9uc1NhdmFibGUuanMnKTtcbnZhciBkb20gPSByZXF1aXJlKCcuL2RvbS5qcycpO1xudmFyIHJlbmRlcmVyID0gcmVxdWlyZSgnLi9yZW5kZXJlci5qcycpO1xud2luZG93LndvcmxkID0gcmVxdWlyZSgnLi93b3JsZC5qcycpO1xudmFyIGdldElkID0gcmVxdWlyZSgnLi9nZXRJZC5qcycpLmdldElkO1xudmFyIGNvbnRyb2xsZXIgPSByZXF1aXJlKCcuL2VkaXRvci1jb250cm9sbGVyLmpzJyk7XG52YXIgZ2V0ID0gcmVxdWlyZSgnLi9nZXQuanMnKTtcbndpbmRvdy51X2lkID0gJyc7XG5cbmdldCgnLi9pZCcsIGZ1bmN0aW9uKGRhdGEpIHtcbiAgICB1X2lkID0gZGF0YS5faWQ7XG59KTtcblxuZG9tLm9ubG9hZChmdW5jdGlvbigpIHtcblxuICAgIHJlbmRlcmVyLmNvbm5lY3RDYW1lcmEoY29udHJvbGxlci5jYW1lcmEpO1xuICAgIHZhciBjdXJyZW50R2FtZUlkID0gZ2V0SWQoKTtcbiAgICB3b3JsZC5kZWNvcmF0ZUFsbEl0ZW1zKG1ha2VJbml0aWFsQ29uZGl0aW9uc1NhdmFibGUpO1xuXG4gICAgdmFyIHN0YXRlcyA9IHtcbiAgICAgICAgbWFpbk1lbnU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgZG9tLmRpc3BsYXkoJ21haW5NZW51Jyk7XG4gICAgICAgICAgICBkb20uY2xlYXJMaXN0SXRlbXMoJ293bmVyTGV2ZWxzJyk7XG4gICAgICAgICAgICBkb20uY2xlYXJMaXN0SXRlbXMoJ3B1YmxpY0xldmVscycpO1xuICAgICAgICAgICAgZ2V0KCcuL2xldmVscy8nLCBmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAgICAgZGF0YS5mb3JFYWNoKGZ1bmN0aW9uKGxldmVsKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBsaXN0ID0gJ293bmVyTGV2ZWxzJztcbiAgICAgICAgICAgICAgICAgICAgaWYgKGxldmVsLnNuYXBzaG90KSBsaXN0ID0gJ3B1YmxpY0xldmVscyc7XG4gICAgICAgICAgICAgICAgICAgIHZhciBsaSA9IGRvbS5hZGRNZW51TGlzdEl0ZW0obGlzdCwgbGV2ZWwubmFtZSwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZXMubG9hZExldmVsKGxldmVsLmlkKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIGlmICghbGV2ZWwuc25hcHNob3QpIGRvbS5nZXRPYmpCeUlkKGxpKS5hcHBlbmRDaGlsZChkb20uZ2V0R2VuZXJpY0J1dHRvbignZGVsZXRlJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwb3N0KCcuL2xldmVscy9kZWxldGUvJywge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldmVsSWQ6IGxldmVsLmlkXG4gICAgICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGVzLm1haW5NZW51KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoIWxldmVsLnNuYXBzaG90KSBkb20uZ2V0T2JqQnlJZChsaSkuYXBwZW5kQ2hpbGQoZG9tLmdldEdlbmVyaWNCdXR0b24oJ3B1Ymxpc2gnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBvc3QoJy4vbGV2ZWxzL3B1Ymxpc2gvJywge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldmVsSWQ6IGxldmVsLmlkXG4gICAgICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGVzLm1haW5NZW51KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIG5ld0xldmVsOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHdvcmxkLnVubG9hZFdvcmxkKCk7XG4gICAgICAgICAgICBzdGF0ZXMuZWRpdGluZ0xldmVsKCk7XG4gICAgICAgIH0sXG4gICAgICAgIGxvYWRMZXZlbDogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgIHdvcmxkLmxvYWRMZXZlbChpZCwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgc3RhdGVzLmVkaXRpbmdMZXZlbCgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIGVkaXRpbmdMZXZlbDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBkb20uZGlzcGxheSgnZ2FtZVZpZXcnKTtcbiAgICAgICAgICAgIGV2ZW50cy5yZWdpc3RlcignYW5pbWF0ZScsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHJlbmRlcmVyLnN0ZXAoKTtcbiAgICAgICAgICAgIH0sIGN1cnJlbnRHYW1lSWQpO1xuICAgICAgICB9LFxuICAgICAgICBwYXVzZWRMZXZlbDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBkb20uZGlzcGxheSgncGF1c2VNZW51Jyk7XG4gICAgICAgICAgICBldmVudHMudW5yZWdpc3RlcihjdXJyZW50R2FtZUlkKTtcbiAgICAgICAgICAgIGN1cnJlbnRHYW1lSWQgPSBnZXRJZCgpO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIFxuICAgIGV2ZW50cy5yZWdpc3RlcignbmV3TGV2ZWwnLCBzdGF0ZXMubmV3TGV2ZWwsIGdldElkKCkpO1xuICAgIGV2ZW50cy5yZWdpc3Rlcignc3RhcnQnLCBzdGF0ZXMuZWRpdGluZ0xldmVsLCBnZXRJZCgpKTtcblxuICAgIGV2ZW50cy5yZWdpc3RlcigncGF1c2UnLCBzdGF0ZXMucGF1c2VkTGV2ZWwsIGdldElkKCkpO1xuXG4gICAgZXZlbnRzLnJlZ2lzdGVyKCdtYWluTWVudScsIHN0YXRlcy5tYWluTWVudSwgZ2V0SWQoKSk7XG4gICAgc3RhdGVzLm1haW5NZW51KCk7XG5cbn0pO1xuXG5cblxuXG5cblxuIiwibW9kdWxlLmV4cG9ydHMgPSB7XG4gICAgZmFkZUluOiBmdW5jdGlvbihvYmopIHtcbiAgICAgICAgb2JqLnN0eWxlLm9wYWNpdHkgPSAxO1xuICAgICAgICBvYmouc3R5bGUuekluZGV4ID0gMztcbiAgICAgICAgb2JqLnN0eWxlLmRpc3BsYXkgPSAnaW5oZXJpdCc7XG4gICAgfSxcbiAgICBmYWRlT3V0OiBmdW5jdGlvbihvYmopIHtcbiAgICAgICAgb2JqLnN0eWxlLm9wYWNpdHkgPSAwO1xuICAgICAgICBvYmouc3R5bGUuekluZGV4ID0gMTtcbiAgICAgICAgb2JqLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XG4gICAgfVxufTtcbiIsInZhciBldmVudHMgPSB7fTtcblxudmFyIGFwaSA9IHtcbiAgICBlbWl0OiBmdW5jdGlvbihlKSB7XG4gICAgICAgIGZvciAodmFyIGlkIGluIGV2ZW50cykge1xuICAgICAgICAgICAgaWYgKGV2ZW50c1tpZF0uZSA9PT0gZSkgZXZlbnRzW2lkXS5mKCk7XG4gICAgICAgIH1cbiAgICB9LFxuICAgIHJlZ2lzdGVyOiBmdW5jdGlvbihlLCBmLCBpZCkge1xuICAgICAgICAvL2NvbnNvbGUubG9nKCdyZWdpc3RlcmluZyBldmVudCAnICsgZSwgZiwgaWQpO1xuICAgICAgICBldmVudHNbaWRdID0ge1xuICAgICAgICAgICAgZjogZixcbiAgICAgICAgICAgIGU6IGVcbiAgICAgICAgfTtcbiAgICB9LFxuICAgIHVucmVnaXN0ZXI6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgIGRlbGV0ZSBldmVudHNbaWRdO1xuICAgIH1cbn07XG5cbm1vZHVsZS5leHBvcnRzID0gYXBpO1xuXG52YXIgYW5pbWF0ZSA9IGZ1bmN0aW9uKCkge1xuICAgIGFwaS5lbWl0KCdhbmltYXRlJyk7XG4gICAgd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZShhbmltYXRlKTtcbn07XG5pZiAodHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcpIGFuaW1hdGUoKTtcbiIsIlxubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbih1cmwsIGNhbGxiYWNrKSB7XG4gICAgdmFyIGh0dHAgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcblxuICAgIGh0dHAub3BlbignR0VUJywgdXJsLCB0cnVlKTtcblxuICAgIC8vU2VuZCB0aGUgcHJvcGVyIGhlYWRlciBpbmZvcm1hdGlvbiBhbG9uZyB3aXRoIHRoZSByZXF1ZXN0XG4gICAgaHR0cC5zZXRSZXF1ZXN0SGVhZGVyKCdDb250ZW50LXR5cGUnLCAnYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkJyk7XG5cbiAgICBodHRwLm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgZGF0YTtcbiAgICAgICAgaWYoKGh0dHAucmVhZHlTdGF0ZSA9PT0gNCkgJiYgaHR0cC5zdGF0dXMgPT09IDIwMCkge1xuICAgICAgICAgICAgZGF0YSA9IEpTT04ucGFyc2UoaHR0cC5yZXNwb25zZVRleHQpO1xuICAgICAgICAgICAgY2FsbGJhY2soZGF0YSlcbiAgICAgICAgfVxuICAgIH07XG4gICAgaHR0cC5zZW5kKCk7XG5cbn07XG5cbiIsInZhciBFbnRpdGllcyA9IHt9O1xuXG5FbnRpdGllc1sncGxheWVyJ10gPSByZXF1aXJlKCcuL1BsYXllci5qcycpO1xuRW50aXRpZXNbJ3Rlc3QnXSA9IHJlcXVpcmUoJy4vdGVzdC1vYmouanMnKTtcbkVudGl0aWVzWydndW4nXSA9IHJlcXVpcmUoJy4vZ3VuLmpzJyk7XG5FbnRpdGllc1sndGlsZSddID0gcmVxdWlyZSgnLi9zcXVhcmUuanMnKTtcbkVudGl0aWVzWyd6b21iaWVTcGF3bmVyJ10gPSByZXF1aXJlKCcuL3NwYXduZXIuanMnKTtcbkVudGl0aWVzWyd6b21iaWUnXSA9IHJlcXVpcmUoJy4vWm9tYmllLmpzJyk7XG5FbnRpdGllc1snd2FsbCddID0gcmVxdWlyZSgnLi93YWxsLmpzJyk7XG4vL0VudGl0aWVzWydkb29yJ10gPSByZXF1aXJlKCcuL0Rvb3IuanMnKTtcbi8vRW50aXRpZXNbJ3NlbnNvciddID0gcmVxdWlyZSgnLi9TZW5zb3IuanMnKTtcblxubW9kdWxlLmV4cG9ydHMgPSBFbnRpdGllcztcbiIsInZhciBsYXN0SWQgPSAwO1xuXG52YXIgYXBpID0ge1xuICAgIGdldElkOiBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuICdhJyArIGxhc3RJZCsrO1xuICAgIH1cbn07XG5cbm1vZHVsZS5leHBvcnRzID0gYXBpO1xuIiwidmFyIHdlYXBvbiA9IHJlcXVpcmUoJy4vd2VhcG9uLmpzJyk7XG4vL3ZhciB3b3JsZCA9IHJlcXVpcmUoJy4vd29ybGQuanMnKTtcbnZhciBCdWxsZXQgPSByZXF1aXJlKCcuL2J1bGxldC5qcycpO1xudmFyIG1ha2VJbnZlbnRvcnkgPSByZXF1aXJlKCcuL21ha2VJbnZlbnRvcnkuanMnKTtcblxubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgdmFyIGd1biA9IHdlYXBvbigpO1xuICAgIHZhciBidWxsZXQ7XG4gICAgaWYgKG9wdGlvbnMucG9zKSBndW4ubW92ZShvcHRpb25zLnBvcyk7XG4gICAgZ3VuLnVzZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgYnVsbGV0ID0gZ3VuLmdldEludmVudG9yeSgpWzBdO1xuICAgICAgICBpZiAoIWJ1bGxldCkge1xuICAgICAgICAgICAgYnVsbGV0ID0gQnVsbGV0KHt2ZWxvY2l0eTogMTAsIHBvd2VyOiAxMCwgcmFuZ2U6IDUwMH0pO1xuICAgICAgICAgICAgZ3VuLnRha2VJdGVtcyhidWxsZXQpO1xuICAgICAgICAgICAgd29ybGQubG9hZEl0ZW1zKGJ1bGxldCk7XG4gICAgICAgIH1cbiAgICAgICAgZ3VuLmRyb3BJdGVtKGJ1bGxldCk7XG4gICAgICAgIGJ1bGxldC5maXJlKGd1bi5vd25lci5wb3MpO1xuICAgIH07XG5cbiAgICBndW4udHlwZSA9ICdndW4nO1xuXG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBvcHRpb25zLnN0YXJ0QW1tbzsgaSsrKSB7XG4gICAgfVxuXG4gICAgcmV0dXJuIGd1bjtcbn07XG5cblxuXG4iLCJtb2R1bGUuZXhwb3J0cyA9IFtcbntcImVudGl0eVwiOiBcInRpbGVcIixcbiAgICBcInBvc1wiOiB7XG4gICAgICAgIFwieFwiOjk5MzAsXG4gICAgICAgIFwieVwiOjEwMTU2LFxuICAgICAgICBcInJvdFwiOjAuNzhcbiAgICB9LFxuICAgIFwid2lkdGhcIjpcIjUwMDBcIixcbiAgICBcImhlaWdodFwiOlwiNTAwMFwifSxcbntcImVudGl0eVwiOlwicGxheWVyXCIsXG4gICAgXCJwb3NcIjoge1wieFwiOjEwMDIzLjAyODg2ODk5NjA4NSxcInlcIjo5OTgwLjc3MzE2NDc3NTIxMyxcInJvdFwiOjB9LFwicmFkaXVzXCI6NTB9LFxue1wiZW50aXR5XCI6XCJndW5cIixcbiAgICBcInBvc1wiOiB7XCJ4XCI6MTAwMjMuMDI4ODY4OTk2MDg1LFwieVwiOjk5ODAuNzczMTY0Nzc1MjEzLFwicm90XCI6MH19LFxue1wiZW50aXR5XCI6XCJ3YWxsXCIsXCJwb3NcIjp7XCJ4XCI6MTA0NDgsXCJ5XCI6MTA3NzMsXCJyb3RcIjowLjc4fSxcIndpZHRoXCI6XCIxMDBcIixcImhlaWdodFwiOlwiMTIwMFwifSx7XCJlbnRpdHlcIjpcIndhbGxcIixcInBvc1wiOntcInhcIjo5NTk5LFwieVwiOjk3OTksXCJyb3RcIjowLjc4fSxcIndpZHRoXCI6XCIxMDBcIixcImhlaWdodFwiOlwiMTIwMFwifSx7XCJlbnRpdHlcIjpcIndhbGxcIixcInBvc1wiOntcInhcIjo4MTMzLFwieVwiOjg0NDUsXCJyb3RcIjowLjc4fSxcIndpZHRoXCI6XCIxMDBcIixcImhlaWdodFwiOlwiNTAwMFwifSx7XCJlbnRpdHlcIjpcIndhbGxcIixcInBvc1wiOntcInhcIjoxMDY4MSxcInlcIjo5Nzc3LFwicm90XCI6Mi4zNH0sXCJ3aWR0aFwiOlwiMTAwXCIsXCJoZWlnaHRcIjpcIjEyMDBcIn0se1wiZW50aXR5XCI6XCJ3YWxsXCIsXCJwb3NcIjp7XCJ4XCI6MTA5MjQsXCJ5XCI6ODUxNCxcInJvdFwiOjEuNTh9LFwid2lkdGhcIjpcIjEwMFwiLFwiaGVpZ2h0XCI6XCI4MDBcIn0se1wiZW50aXR5XCI6XCJ3YWxsXCIsXCJwb3NcIjp7XCJ4XCI6MTAwMDMsXCJ5XCI6ODYwOCxcInJvdFwiOjMuMTR9LFwid2lkdGhcIjpcIjEwMFwiLFwiaGVpZ2h0XCI6XCIxNjAwXCJ9LHtcImVudGl0eVwiOlwid2FsbFwiLFwicG9zXCI6e1wieFwiOjExNjQyLFwieVwiOjg0MTMsXCJyb3RcIjoyLjM0fSxcIndpZHRoXCI6XCIxMDBcIixcImhlaWdodFwiOlwiNTAwMFwifSx7XCJlbnRpdHlcIjpcIndhbGxcIixcInBvc1wiOntcInhcIjoxMTY5NSxcInlcIjoxMTg3NyxcInJvdFwiOjAuNzh9LFwid2lkdGhcIjpcIjEwMFwiLFwiaGVpZ2h0XCI6XCI1MDAwXCJ9LHtcImVudGl0eVwiOlwid2FsbFwiLFwicG9zXCI6e1wieFwiOjgxODMsXCJ5XCI6MTE5MjEsXCJyb3RcIjoyLjM0fSxcIndpZHRoXCI6XCIxMDBcIixcImhlaWdodFwiOlwiNTAwMFwifSx7XCJlbnRpdHlcIjpcIndhbGxcIixcInBvc1wiOntcInhcIjoxMDI2NyxcInlcIjo4NzkwLFwicm90XCI6My4xNH0sXCJ3aWR0aFwiOlwiMTAwXCIsXCJoZWlnaHRcIjpcIjEyMDBcIn0se1wiZW50aXR5XCI6XCJ3YWxsXCIsXCJwb3NcIjp7XCJ4XCI6MTAzNTEsXCJ5XCI6Nzg2MSxcInJvdFwiOjEuNTh9LFwid2lkdGhcIjpcIjEwMFwiLFwiaGVpZ2h0XCI6XCI4MDBcIn0se1wiZW50aXR5XCI6XCJ3YWxsXCIsXCJwb3NcIjp7XCJ4XCI6MTEwMjQsXCJ5XCI6OTA1NSxcInJvdFwiOjAuM30sXCJ3aWR0aFwiOlwiNDAwXCIsXCJoZWlnaHRcIjpcIjI1MFwifSx7XCJlbnRpdHlcIjpcIndhbGxcIixcInBvc1wiOntcInhcIjoxMTg5OCxcInlcIjo5NDkwLFwicm90XCI6MC42fSxcIndpZHRoXCI6XCI5MDBcIixcImhlaWdodFwiOlwiMTAwXCJ9LHtcImVudGl0eVwiOlwid2FsbFwiLFwicG9zXCI6e1wieFwiOjExNjE5LFwieVwiOjk4OTUsXCJyb3RcIjowLjZ9LFwid2lkdGhcIjpcIjkwMFwiLFwiaGVpZ2h0XCI6XCIxMDBcIn0se1wiZW50aXR5XCI6XCJ3YWxsXCIsXCJwb3NcIjp7XCJ4XCI6OTUwMCxcInlcIjoxMTc4NixcInJvdFwiOjB9LFwid2lkdGhcIjpcIjgwMFwiLFwiaGVpZ2h0XCI6XCI4MDBcIn0sXG57XCJlbnRpdHlcIjpcInpvbWJpZVNwYXduZXJcIixcInBvc1wiOntcInhcIjo3NzY5LFwieVwiOjk0MTEsXCJyb3RcIjowfSxcInJhZGl1c1wiOjEwLCBcInN0YXJ0XCI6IHRydWUsIFwiaW50ZXJ2YWxcIjogMjAwMDAsIFwic3Bhd25Db3VudFwiOiAxNX0sXG57XCJlbnRpdHlcIjpcInpvbWJpZVNwYXduZXJcIixcInBvc1wiOntcInhcIjoxMjM3OSxcInlcIjo5NDQ5LFwicm90XCI6MH0sXCJyYWRpdXNcIjoxMCwgXCJzdGFydFwiOiBmYWxzZSwgXCJpbnRlcnZhbFwiOiA0NTAwMCwgXCJzcGF3bkNvdW50XCI6IDM1fSxcbntcImVudGl0eVwiOlwiem9tYmllU3Bhd25lclwiLFwicG9zXCI6e1wieFwiOjg3NjAsXCJ5XCI6MTE5ODMsXCJyb3RcIjowfSxcInJhZGl1c1wiOjEwLCBcInN0YXJ0XCI6IHRydWUsIFwiaW50ZXJ2YWxcIjogMjAwMDAsIFwic3Bhd25Db3VudFwiOiA1fVxuXG5dO1xuXG5cbiIsInZhciBwZXJwUG9pbnQgPSBmdW5jdGlvbih2ZXJ0cywgcCkge1xuICAgIHZhciBvdXRwdXQgPSB2ZXJ0cy5tYXAoZnVuY3Rpb24odjAsIGluZGV4LCBhcnJheSkge1xuICAgICAgICB2YXIgdjEgPSBhcnJheVtpbmRleCArIDFdO1xuICAgICAgICBpZiAoaW5kZXggKyAxID09PSBhcnJheS5sZW5ndGgpIHYxID0gYXJyYXlbMF07XG4gICAgICAgIHZhciBrID0gKCh2MS55IC0gdjAueSkgKiAocC54IC0gdjAueCkgLSAodjEueCAtIHYwLngpICogKHAueSAtIHYwLnkpKSAvIChNYXRoLnBvdyh2MS55IC0gdjAueSwgMikgKyBNYXRoLnBvdyh2MS54IC0gdjAueCwgMikpO1xuICAgICAgICB2YXIgcGVycFBvaW50ID0ge3g6IHAueCAtIGsgKiAodjEueSAtIHYwLnkpLCB5OiBwLnkgKyBrICogKHYxLnggLSB2MC54KX07XG4gICAgICAgIHZhciBkaXMgPSBNYXRoLnNxcnQoTWF0aC5wb3cocC54IC0gcGVycFBvaW50LngsIDIpICsgTWF0aC5wb3cocC55IC0gcGVycFBvaW50LnksIDIpKTtcbiAgICAgICAgcmV0dXJuIHtkaXM6IGRpcywgcGVycFBvaW50OiBwZXJwUG9pbnR9O1xuICAgIH0pO1xuICAgIHJldHVybiBvdXRwdXQucmVkdWNlKGZ1bmN0aW9uKHBhc3QsIGN1cnJlbnQpIHsgXG4gICAgICAgIGlmICghcGFzdC5kaXMpIHJldHVybiBjdXJyZW50O1xuICAgICAgICBpZiAoY3VycmVudC5kaXMgPCBwYXN0LmRpcykgcmV0dXJuIGN1cnJlbnQ7XG4gICAgICAgIHJldHVybiBwYXN0O1xuICAgIH0pLnBlcnBQb2ludDtcbn07XG5cblxudmFyIHBvaW50SW5Qb2x5Z29uID0gZnVuY3Rpb24oc3F1YXJlLCBjaXJjbGUpIHtcbiAgICB2YXIgYyA9IGZhbHNlO1xuICAgIHZhciBpLCBqLCB4LCB5LCBwO1xuICAgIHZhciB2ZXJ0aWNlcyA9IHNxdWFyZS52ZXJ0cztcbiAgICB2YXIgcG9pbnQgPSBjaXJjbGUucG9zO1xuXG4gICAgaiA9IHZlcnRpY2VzLmxlbmd0aCAtIDE7XG5cbiAgICBmb3IgKGkgPSAwOyBpIDwgdmVydGljZXMubGVuZ3RoOyBpKyspIHtcblxuICAgICAgICBpZiAoICgodmVydGljZXNbaV0ueSA+IHBvaW50LnkpICE9PSAodmVydGljZXNbal0ueSA+IHBvaW50LnkpKSAmJlxuICAgICAgICAocG9pbnQueCA8ICh2ZXJ0aWNlc1tqXS54IC0gdmVydGljZXNbaV0ueCkgKiAocG9pbnQueSAtIHZlcnRpY2VzW2ldLnkpIC8gKHZlcnRpY2VzW2pdLnkgLSB2ZXJ0aWNlc1tpXS55KSArIHZlcnRpY2VzW2ldLngpICkge1xuICAgICAgICAgICAgYyA9ICFjO1xuICAgICAgICB9XG5cbiAgICAgICAgaiA9IGk7XG4gICAgfVxuXG4gICAgaWYgKGMpIHtcbiAgICAgICAgaWYgKHNxdWFyZS5zb2xpZCAmJiBjaXJjbGUuc29saWQpIHtcbiAgICAgICAgICAgIHAgPSBwZXJwUG9pbnQodmVydGljZXMsIHBvaW50KTtcbiAgICAgICAgICAgIC8veCA9IHAueCAtIGNpcmNsZS5wb3MueDtcbiAgICAgICAgICAgIC8veSAuPSBwLnkgLSBjaXJjbGUucG9zLnk7XG4gICAgICAgICAgICAvL2NpcmNsZS5hZGRFZmZlY3QoZnVuY3Rpb24oKSB7IFxuICAgICAgICAgICAgICAgIGNpcmNsZS5tb3ZlKHt4OiBwLngsIHk6IHAueX0pOyBcbiAgICAgICAgICAgIC8vfSk7XG4gICAgICAgICAgICBjaXJjbGUuY29sbGlkZShzcXVhcmUpO1xuICAgICAgICAgICAgc3F1YXJlLmNvbGxpZGUoY2lyY2xlKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG59O1xuXG52YXIgbG9uZ1B1c2ggPSBmdW5jdGlvbihhLCBiKSB7XG4gICAgdmFyIHRoZW4gPSBEYXRlLm5vdygpO1xuICAgIHZhciB4ID0gTWF0aC5jb3MoYi5wb3Mucm90KSAqIGIudmVsb2NpdHk7XG4gICAgdmFyIHkgPSBNYXRoLnNpbihiLnBvcy5yb3QpICogYi52ZWxvY2l0eTtcbiAgICBhLmFkZEVmZmVjdChmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIGVsYXBzZWRUaW1lID0gKERhdGUubm93KCkgLSB0aGVuKSAvIDEwMDA7XG4gICAgICAgIHZhciBzY2FsZXIgPSBNYXRoLnBvdyhlbGFwc2VkVGltZSAtIDEsIDIpO1xuICAgICAgICBpZiAoZWxhcHNlZFRpbWUgPiAxKSByZXR1cm4gZmFsc2U7XG4gICAgICAgIGEucHVzaCh7eDogeCAqIHNjYWxlciwgeTogeSAqIHNjYWxlcn0pO1xuXG4gICAgfSk7XG59O1xuXG52YXIgY2lyY2xlRGV0ZWN0ID0gZnVuY3Rpb24oYSwgYikge1xuICAgIHZhciB4LCB5LCBkaXMsIHJhZGl1cywgZGVsdGEsIHRoZXRhLCBhRGVsdGEsIGJEZWx0YTtcbiAgICB4ID0gYS5wb3MueCAtIGIucG9zLng7XG4gICAgeSA9IGEucG9zLnkgLSBiLnBvcy55O1xuICAgIGRpcyA9IE1hdGguc3FydChNYXRoLnBvdyh4LCAyKSArIE1hdGgucG93KHksIDIpKTtcbiAgICByYWRpdXMgPSBwYXJzZUludChhLnJhZGl1cykgKyBwYXJzZUludChiLnJhZGl1cyk7XG5cbiAgICBpZiAoZGlzIDwgcmFkaXVzKSB7XG4gICAgICAgIGlmIChhLnNvbGlkICYmIGIuc29saWQpIHtcbiAgICAgICAgICAgIGRlbHRhID0gKHJhZGl1cyAtIGRpcyk7XG4gICAgICAgICAgICB0aGV0YSA9IE1hdGguYXRhbjIoeSwgeCk7XG4gICAgICAgICAgICBhLmFkZEVmZmVjdChmdW5jdGlvbigpIHsgXG4gICAgICAgICAgICAgICAgYS5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgeDogKE1hdGguY29zKHRoZXRhKSAqIGRlbHRhKSwgXG4gICAgICAgICAgICAgICAgICAgIHk6IChNYXRoLnNpbih0aGV0YSkgKiBkZWx0YSlcbiAgICAgICAgICAgICAgICB9KTsgXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBiLmFkZEVmZmVjdChmdW5jdGlvbigpIHsgXG4gICAgICAgICAgICAgICAgYi5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgeDogKE1hdGguY29zKHRoZXRhKSAqIC1kZWx0YSksICBcbiAgICAgICAgICAgICAgICAgICAgeTogKE1hdGguc2luKHRoZXRhKSAqIC1kZWx0YSlcbiAgICAgICAgICAgICAgICB9KTsgXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBpZiAoYi5pbmVydGlhKSBsb25nUHVzaChhLCBiKTtcbiAgICAgICAgICAgIGlmIChhLmluZXJ0aWEpIGxvbmdQdXNoKGIsIGEpO1xuICAgICAgICAgICAgYS5jb2xsaWRlKGIpO1xuICAgICAgICAgICAgYi5jb2xsaWRlKGEpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbn07XG5cbnZhciBzZXRBQUJCID0gZnVuY3Rpb24ob2JqKSB7XG4gICAgdmFyIEFBQkIgPSB7XG4gICAgICAgIHhzOiBbe3R5cGU6ICdiJywgdmFsOiBJbmZpbml0eSwgb2JqOiBvYmp9LCB7dHlwZTogJ2UnLCB2YWw6IC1JbmZpbml0eSwgb2JqOiBvYmp9XSxcbiAgICAgICAgeXM6IFt7dHlwZTogJ2InLCB2YWw6IEluZmluaXR5LCBvYmo6IG9ian0sIHt0eXBlOiAnZScsIHZhbDogLUluZmluaXR5LCBvYmo6IG9ian1dXG4gICAgfTtcblxuICAgIGlmIChvYmouZ2VvbWV0cnkgPT09ICdjaXJjbGUnKSB7XG4gICAgICAgIEFBQkIueHNbMF0udmFsID0gb2JqLnBvcy54IC0gb2JqLnJhZGl1cztcbiAgICAgICAgQUFCQi54c1sxXS52YWwgPSBvYmoucG9zLnggKyBvYmoucmFkaXVzO1xuICAgICAgICBBQUJCLnlzWzBdLnZhbCA9IG9iai5wb3MueSAtIG9iai5yYWRpdXM7XG4gICAgICAgIEFBQkIueXNbMV0udmFsID0gb2JqLnBvcy55ICsgb2JqLnJhZGl1cztcbiAgICAgICAgb2JqLkFBQkIgPSBBQUJCO1xuICAgICAgICByZXR1cm47XG4gICAgfTtcbiAgICBpZiAob2JqLmdlb21ldHJ5ID09PSAnc3F1YXJlJykge1xuICAgICAgICBvYmouQUFCQiA9IG9iai52ZXJ0cy5yZWR1Y2UoZnVuY3Rpb24oYWNjLCB2ZXJ0KSB7XG4gICAgICAgICAgICBpZiAodmVydC54IDwgYWNjLnhzWzBdLnZhbCkgYWNjLnhzWzBdLnZhbCA9IHZlcnQueDtcbiAgICAgICAgICAgIGlmICh2ZXJ0LnggPiBhY2MueHNbMV0udmFsKSBhY2MueHNbMV0udmFsID0gdmVydC54O1xuICAgICAgICAgICAgaWYgKHZlcnQueSA8IGFjYy55c1swXS52YWwpIGFjYy55c1swXS52YWwgPSB2ZXJ0Lnk7XG4gICAgICAgICAgICBpZiAodmVydC55ID4gYWNjLnlzWzFdLnZhbCkgYWNjLnlzWzFdLnZhbCA9IHZlcnQueTtcbiAgICAgICAgICAgIHJldHVybiBhY2M7XG4gICAgICAgIH0sIEFBQkIpO1xuICAgIH1cbn07XG5cbnZhciBzZXRWZXJ0cyA9IGZ1bmN0aW9uKG9iaikge1xuXG4gICAgb2JqLnBvcy54ID0gcGFyc2VJbnQob2JqLnBvcy54KTtcbiAgICBvYmoucG9zLnkgPSBwYXJzZUludChvYmoucG9zLnkpO1xuXG4gICAgdmFyIHZlcnRzID0gW1xuICAgICAgICB7eDogb2JqLnBvcy54IC0gb2JqLndpZHRoIC8gMiwgeTogb2JqLnBvcy55IC0gb2JqLmhlaWdodCAvIDJ9LCBcbiAgICAgICAge3g6IG9iai5wb3MueCArIG9iai53aWR0aCAvIDIsIHk6IG9iai5wb3MueSAtIG9iai5oZWlnaHQgLyAyfSwgXG4gICAgICAgIHt4OiBvYmoucG9zLnggKyBvYmoud2lkdGggLyAyLCB5OiBvYmoucG9zLnkgKyBvYmouaGVpZ2h0IC8gMn0sIFxuICAgICAgICB7eDogb2JqLnBvcy54IC0gb2JqLndpZHRoIC8gMiwgeTogb2JqLnBvcy55ICsgb2JqLmhlaWdodCAvIDJ9LCBcbiAgICBdO1xuXG4gICAgdmFyIHJvdCA9IG9iai5wb3Mucm90O1xuICAgIHZhciBveCA9IG9iai5wb3MueDtcbiAgICB2YXIgb3kgPSBvYmoucG9zLnk7XG5cbiAgICBvYmoudmVydHMgPSB2ZXJ0cy5tYXAoZnVuY3Rpb24oaXRlbSkge1xuICAgICAgICB2YXIgdnggPSBpdGVtLng7XG4gICAgICAgIHZhciB2eSA9IGl0ZW0ueTtcbiAgICAgICAgaXRlbS54ID0gTWF0aC5jb3Mocm90KSAqICh2eCAtIG94KSAtIE1hdGguc2luKHJvdCkgKiAodnkgLSBveSkgKyBveDtcbiAgICAgICAgaXRlbS55ID0gTWF0aC5zaW4ocm90KSAqICh2eCAtIG94KSArIE1hdGguY29zKHJvdCkgKiAodnkgLSBveSkgKyBveTtcbiAgICAgICAgcmV0dXJuIGl0ZW07XG4gICAgfSk7XG5cbiAgICBzZXRBQUJCKG9iaik7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKG9iaiwgdHlwZSkge1xuICAgIG9iai5nZW9tZXRyeSA9IHR5cGU7XG4gICAgaWYgKHR5cGUgPT09ICdjaXJjbGUnKSB7XG4gICAgICAgIG9iai5kZXRlY3RDb2xsaWRlID0gZnVuY3Rpb24oY29sbGlkZXIpIHtcbiAgICAgICAgICAgIGlmIChjb2xsaWRlci5nZW9tZXRyeSA9PT0gJ2NpcmNsZScpIHJldHVybiBjaXJjbGVEZXRlY3Qob2JqLCBjb2xsaWRlcik7XG4gICAgICAgICAgICBpZiAoY29sbGlkZXIuZ2VvbWV0cnkgPT09ICdzcXVhcmUnKSByZXR1cm4gcG9pbnRJblBvbHlnb24oY29sbGlkZXIsIG9iaik7XG4gICAgICAgIH07XG4gICAgICAgIG9iai5tb3ZlKHtldjogc2V0QUFCQi5iaW5kKG51bGwsIG9iail9KTtcbiAgICAgICAgc2V0QUFCQihvYmopO1xuICAgIH1cbiAgICBpZiAodHlwZSA9PT0gJ3NxdWFyZScpIHtcbiAgICAgICAgb2JqLmRldGVjdENvbGxpZGUgPSBmdW5jdGlvbihjb2xsaWRlcikge1xuICAgICAgICAgICAgaWYgKGNvbGxpZGVyLmdlb21ldHJ5ID09PSAnc3F1YXJlJykgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgaWYgKGNvbGxpZGVyLmdlb21ldHJ5ID09PSAnY2lyY2xlJykgcmV0dXJuIHBvaW50SW5Qb2x5Z29uKG9iaiwgY29sbGlkZXIpO1xuICAgICAgICB9O1xuICAgICAgICBvYmoud2lkdGggPSAxMDA7XG4gICAgICAgIG9iai5oZWlnaHQgPSAxMDA7XG4gICAgICAgIG9iai5zZXREaW1lbnNpb25zID0gZnVuY3Rpb24oZGltKSB7XG4gICAgICAgICAgICBpZiAoZGltKSB7XG4gICAgICAgICAgICAgICAgaWYgKGRpbS53aWR0aCkgb2JqLndpZHRoID0gZGltLndpZHRoO1xuICAgICAgICAgICAgICAgIGlmIChkaW0uaGVpZ2h0KSBvYmouaGVpZ2h0ID0gZGltLmhlaWdodDtcbiAgICAgICAgICAgICAgICBzZXRWZXJ0cyhvYmopO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIG9iai5tb3ZlKHtldjogc2V0VmVydHMuYmluZChudWxsLCBvYmopfSk7XG4gICAgICAgIHNldFZlcnRzKG9iaik7XG4gICAgfVxufTtcbiIsIlxubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihvYmopIHtcbiAgICBvYmouZ2V0SW5pdGlhbENvbmRpdGlvbnMgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIGluaXRpYWxDb25kaXRpb25zID0ge1xuICAgICAgICAgICAgZW50aXR5OiBvYmoudHlwZSxcbiAgICAgICAgICAgIHBvczoge1xuICAgICAgICAgICAgICAgIHg6IG9iai5wb3MueCxcbiAgICAgICAgICAgICAgICB5OiBvYmoucG9zLnksXG4gICAgICAgICAgICAgICAgcm90OiBvYmoucG9zLnJvdFxuICAgICAgICAgICAgfSxcbiAgICAgICAgfTtcbiAgICAgICAgaWYgKG9iai5nZW9tZXRyeSAmJiBvYmouZ2VvbWV0cnkgPT09ICdjaXJjbGUnKSB7XG4gICAgICAgICAgICBpbml0aWFsQ29uZGl0aW9ucy5yYWRpdXMgPSBvYmoucmFkaXVzO1xuICAgICAgICB9XG4gICAgICAgIGlmIChvYmouZ2VvbWV0cnkgJiYgb2JqLmdlb21ldHJ5ID09PSAnc3F1YXJlJykge1xuICAgICAgICAgICAgaW5pdGlhbENvbmRpdGlvbnMud2lkdGggPSBvYmoud2lkdGg7XG4gICAgICAgICAgICBpbml0aWFsQ29uZGl0aW9ucy5oZWlnaHQgPSBvYmouaGVpZ2h0O1xuICAgICAgICB9XG4gICAgICAgIHZhciBzdGFydE9wdGlvbnM7XG4gICAgICAgIGlmIChvYmouc3RhcnRPcHRpb25zKSB7XG4gICAgICAgICAgICBzdGFydE9wdGlvbnMgPSBvYmouc3RhcnRPcHRpb25zKCk7XG4gICAgICAgICAgICBmb3IgKHZhciBvcHRpb24gaW4gc3RhcnRPcHRpb25zKSB7XG4gICAgICAgICAgICAgICAgaW5pdGlhbENvbmRpdGlvbnNbb3B0aW9uXSA9IHN0YXJ0T3B0aW9uc1tvcHRpb25dO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBpbml0aWFsQ29uZGl0aW9ucztcbiAgICB9O1xufTtcbiIsIlxubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihvYmopIHtcblxuICAgIHZhciBpbnZlbnRvcnkgPSBbXTtcbiAgICBvYmoudGFrZUl0ZW1zID0gZnVuY3Rpb24oaXRlbXMpIHtcbiAgICAgICAgaWYgKCFpdGVtcy5sZW5ndGgpIGl0ZW1zID0gW2l0ZW1zXTtcbiAgICAgICAgaXRlbXMuZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7XG4gICAgICAgICAgICB2YXIgY3VycmVudE9iaiA9IG9iai5nZXRJbnZlbnRvcnlCeVR5cGUoaXRlbS50eXBlKVswXTtcbiAgICAgICAgICAgIGlmIChjdXJyZW50T2JqICYmIGN1cnJlbnRPYmouY29uc29saWRhdGVJbnZlbnRvcnkpIHtcbiAgICAgICAgICAgICAgICBjdXJyZW50T2JqLnRha2VJdGVtcyhpdGVtLmdldEludmVudG9yeSgpKTtcbiAgICAgICAgICAgICAgICBpdGVtLnVubG9hZCgpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBpbnZlbnRvcnkucHVzaChpdGVtKTtcbiAgICAgICAgICAgICAgICBpdGVtLm93bmVyID0gb2JqO1xuICAgICAgICAgICAgICAgIGl0ZW0ubG9hZCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9O1xuICAgIG9iai5kcm9wSXRlbSA9IGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICAgICAgaXRlbS5vd25lciA9IGZhbHNlO1xuICAgICAgICBpbnZlbnRvcnkgPSBpbnZlbnRvcnkuZmlsdGVyKGZ1bmN0aW9uKG1heWJlSXRlbSkgeyBpZiAobWF5YmVJdGVtLmlkICE9PSBpdGVtLmlkKSByZXR1cm4gdHJ1ZTsgfSk7XG4gICAgfTtcbiAgICBvYmouZ2V0SW52ZW50b3J5ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiBpbnZlbnRvcnkuc2xpY2UoKTtcbiAgICB9O1xuICAgIG9iai5nZXRJbnZlbnRvcnlCeVR5cGUgPSBmdW5jdGlvbih0eXBlKSB7XG4gICAgICAgIHJldHVybiBpbnZlbnRvcnkuZmlsdGVyKGZ1bmN0aW9uKGl0ZW0pIHsgaWYgKGl0ZW0udHlwZSA9PT0gdHlwZSkgcmV0dXJuIHRydWU7IH0pO1xuICAgIH07XG4gICAgb2JqLmdldEludmVudG9yeUJ5QmFzZSA9IGZ1bmN0aW9uKGJhc2UpIHtcbiAgICAgICAgcmV0dXJuIGludmVudG9yeS5maWx0ZXIoZnVuY3Rpb24oaXRlbSkgeyBpZiAoaXRlbS5iYXNlID09PSBiYXNlKSByZXR1cm4gdHJ1ZTsgfSk7XG4gICAgfTtcbn1cblxuIiwibW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihvYmopIHtcbiAgICBvYmouc29saWQgPSB0cnVlO1xufTtcbiIsIlxuXG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKG9iaikge1xuICAgIHZhciBzdGFydE9wdGlvbnMgPSB7fTtcbiAgICBvYmouc3RhcnRPcHRpb25zID0gZnVuY3Rpb24ob3B0aW9ucykge1xuICAgICAgICBpZiAoIW9wdGlvbnMpIHJldHVybiBzdGFydE9wdGlvbnM7XG4gICAgICAgIGZvciAodmFyIG9wdGlvbiBpbiBvcHRpb25zKSB7XG4gICAgICAgICAgICBzdGFydE9wdGlvbnNbb3B0aW9uXSA9IG9wdGlvbnNbb3B0aW9uXTtcbiAgICAgICAgfVxuICAgIH07XG59O1xuIiwidmFyIHRleHR1cmVEYXRhID0gcmVxdWlyZSgnLi90ZXh0dXJlRGF0YS5qcycpO1xuXG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIG1ha2VWaXNpYmxlIChvYmopIHtcbiAgICBvYmoubG9hZChmdW5jdGlvbigpIHsgXG4gICAgICAgIG9iai50ZXh0dXJlRGF0YSA9IHRleHR1cmVEYXRhW29iai5iYXNlXVtvYmoudHlwZV07IFxuICAgICAgICBvYmoudmlzaWJsZSA9IHRydWU7XG4gICAgICAgIG9iai5hZGRFZmZlY3QoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZiAob2JqLmluQ29udGFpbmVyKCkpIHtcbiAgICAgICAgICAgICAgICBvYmoudmlzaWJsZSA9IGZhbHNlO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBvYmoudmlzaWJsZSA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG59O1xuIiwiZnVuY3Rpb24gTWF0cml4U3RhY2soKSB7XG4gICAgICB0aGlzLnN0YWNrID0gW107XG5cbiAgICAgIC8vc2luY2UgdGhlIHN0YWNrIGlzIGVtcHR5IHRoaXMgd2lsbCBwdXQgYW4gaW5pdGlhbCBtYXRyaXggaW4gaXRcbiAgICAgICAgICB0aGlzLnJlc3RvcmUoKTtcbn1cblxuLy8gUG9wcyB0aGUgdG9wIG9mIHRoZSBzdGFjayByZXN0b3JpbmcgdGhlIHByZXZpb3VzbHkgc2F2ZWQgbWF0cml4XG5NYXRyaXhTdGFjay5wcm90b3R5cGUucmVzdG9yZSA9IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuc3RhY2sucG9wKCk7XG4gICAgLy8gTmV2ZXIgbGV0IHRoZSBzdGFjayBiZSB0b3RhbGx5IGVtcHR5XG4gICAgaWYgKHRoaXMuc3RhY2subGVuZ3RoIDwgMSkge1xuICAgICAgICB0aGlzLnN0YWNrWzBdID0gbTQuaWRlbnRpdHkoKTtcbiAgICB9XG59O1xuXG4vLyBQdXNoZXMgYSBjb3B5IG9mIHRoZSBjdXJyZW50IG1hdHJpeCBvbiB0aGUgc3RhY2tcbk1hdHJpeFN0YWNrLnByb3RvdHlwZS5zYXZlID0gZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5zdGFjay5wdXNoKHRoaXMuZ2V0Q3VycmVudE1hdHJpeCgpKTtcbn07XG5cbi8vIEdldHMgYSBjb3B5IG9mIHRoZSBjdXJyZW50IG1hdHJpeCAodG9wIG9mIHRoZSBzdGFjaylcbk1hdHJpeFN0YWNrLnByb3RvdHlwZS5nZXRDdXJyZW50TWF0cml4ID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMuc3RhY2tbdGhpcy5zdGFjay5sZW5ndGggLSAxXS5zbGljZSgpO1xufTtcblxuLy8gTGV0cyB1cyBzZXQgdGhlIGN1cnJlbnQgbWF0cml4XG5NYXRyaXhTdGFjay5wcm90b3R5cGUuc2V0Q3VycmVudE1hdHJpeCA9IGZ1bmN0aW9uKG0pIHtcbiAgICByZXR1cm4gdGhpcy5zdGFja1t0aGlzLnN0YWNrLmxlbmd0aCAtIDFdID0gbTtcbn07XG5cbi8vIFRyYW5zbGF0ZXMgdGhlIGN1cnJlbnQgbWF0cml4XG5NYXRyaXhTdGFjay5wcm90b3R5cGUudHJhbnNsYXRlID0gZnVuY3Rpb24oeCwgeSwgeikge1xuICAgIGlmICh6ID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgeiA9IDA7XG4gICAgfVxuICAgIHZhciBtID0gdGhpcy5nZXRDdXJyZW50TWF0cml4KCk7XG4gICAgdGhpcy5zZXRDdXJyZW50TWF0cml4KG00LnRyYW5zbGF0ZShtLCB4LCB5LCB6KSk7XG59O1xuXG4vLyBSb3RhdGVzIHRoZSBjdXJyZW50IG1hdHJpeCBhcm91bmQgWlxuTWF0cml4U3RhY2sucHJvdG90eXBlLnJvdGF0ZVogPSBmdW5jdGlvbihhbmdsZUluUmFkaWFucykge1xuICAgIHZhciBtID0gdGhpcy5nZXRDdXJyZW50TWF0cml4KCk7XG4gICAgdGhpcy5zZXRDdXJyZW50TWF0cml4KG00LnpSb3RhdGUobSwgYW5nbGVJblJhZGlhbnMpKTtcbn07XG5cbi8vIFNjYWxlcyB0aGUgY3VycmVudCBtYXRyaXhcbk1hdHJpeFN0YWNrLnByb3RvdHlwZS5zY2FsZSA9IGZ1bmN0aW9uKHgsIHksIHopIHtcbiAgICBpZiAoeiA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHogPSAxO1xuICAgIH1cbiAgICB2YXIgbSA9IHRoaXMuZ2V0Q3VycmVudE1hdHJpeCgpO1xuICAgIHRoaXMuc2V0Q3VycmVudE1hdHJpeChtNC5zY2FsZShtLCB4LCB5LCB6KSk7XG59O1xuXG5cbm1vZHVsZS5leHBvcnRzID0gTWF0cml4U3RhY2s7XG4iLCJcbm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24odXJsLCBkYXRhLCBjYWxsYmFjaykge1xuICAgIHZhciBodHRwID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XG4gICAgdmFyIHBhcmFtcyA9ICcnO1xuICAgIGZvciAodmFyIHBhcmFtIGluIGRhdGEpIHtcbiAgICAgICAgcGFyYW1zICs9ICgocGFyYW1zLmxlbmd0aCkgPyAnJicgOiAnJykgKyBwYXJhbSArICc9JyArIGRhdGFbcGFyYW1dO1xuICAgIH1cbiAgICBodHRwLm9wZW4oJ1BPU1QnLCB1cmwsIHRydWUpO1xuXG4gICAgLy9TZW5kIHRoZSBwcm9wZXIgaGVhZGVyIGluZm9ybWF0aW9uIGFsb25nIHdpdGggdGhlIHJlcXVlc3RcbiAgICBodHRwLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtdHlwZScsICdhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQnKTtcblxuICAgIGh0dHAub25yZWFkeXN0YXRlY2hhbmdlID0gZnVuY3Rpb24oKSB7Ly9DYWxsIGEgZnVuY3Rpb24gd2hlbiB0aGUgc3RhdGUgY2hhbmdlcy5cbiAgICAgICAgdmFyIGRhdGE7XG4gICAgICAgIGlmKGh0dHAucmVhZHlTdGF0ZSA9PT0gNCAmJiBodHRwLnN0YXR1cyA9PT0gMjAwKSB7XG4gICAgICAgICAgICBkYXRhID0gSlNPTi5wYXJzZShodHRwLnJlc3BvbnNlVGV4dCk7XG4gICAgICAgICAgICBjYWxsYmFjayhkYXRhKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgaHR0cC5zZW5kKHBhcmFtcyk7XG5cbn07XG5cbiIsInZhciBiYXNlRW50aXR5ID0gcmVxdWlyZSgnLi9iYXNlRW50aXR5LmpzJyk7XG52YXIgbWFrZVZpc2libGUgPSByZXF1aXJlKCcuL21ha2VWaXNpYmxlLmpzJyk7XG52YXIgbWFrZUdlb21ldHJ5ID0gcmVxdWlyZSgnLi9tYWtlR2VvbWV0cnkuanMnKTtcblxubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgcHJvamVjdGlsZSA9IGJhc2VFbnRpdHkoKTtcbiAgICBtYWtlVmlzaWJsZShwcm9qZWN0aWxlKTtcbiAgICBtYWtlR2VvbWV0cnkocHJvamVjdGlsZSwgJ2NpcmNsZScpO1xuICAgIHByb2plY3RpbGUuYmFzZSA9ICdwcm9qZWN0aWxlJztcblxuICAgIHJldHVybiBwcm9qZWN0aWxlO1xufTtcblxuIiwidmFyIGV2ZW50cyA9IHJlcXVpcmUoJ2V2ZW50cycpO1xudmFyIGdsID0gcmVxdWlyZSgnLi93ZWJnbC1sYWIuanMnKTtcbnZhciBXb3JsZCA9IHJlcXVpcmUoJy4vd29ybGQuanMnKTtcbi8vdmFyIGF1ZGlvID0gcmVxdWlyZSgnLi9hdWRpby5qcycpO1xudmFyIGN1cnJlbnRMZXZlbDtcbnZhciBwb3Y7XG52YXIgY2FudmFzRGltID0gZ2wuY2FudmFzRGltZW5zaW9ucztcbldvcmxkLmNhbnZhc0RpbSA9IGNhbnZhc0RpbTtcblxuXG52YXIgc3RlcCA9IGZ1bmN0aW9uKCkge1xuXG4gICAgZ2wuY2xlYXIoKTtcbiAgICB2YXIgd29ybGQgPSBXb3JsZC5nZXRJdGVtcygpO1xuICAgIC8vaWYgKHBvdikgYXVkaW8udXBkYXRlUG92KHBvdi5wb3MpO1xuICAgIHdvcmxkLmZvckVhY2goZnVuY3Rpb24oaXRlbSkgeyBcbiAgICAgICAgdmFyIHdpZHRoLCBoZWlnaHQsIHN4LCBzeSwgaSwgc3csIHNoLCBwYXR0ZXJuO1xuICAgICAgICBpZiAoaXRlbS5hdWRpbykge1xuICAgICAgICAgICAgYXVkaW9baXRlbS50eXBlXVtpdGVtLmF1ZGlvXShpdGVtLnBvcyk7XG4gICAgICAgICAgICBpdGVtLmF1ZGlvID0gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICBpZiAoaXRlbS52aXNpYmxlKSB7XG4gICAgICAgICAgICBpZiAoaXRlbS50ZXh0dXJlRGF0YS5wb3Nlcykge1xuICAgICAgICAgICAgICAgIHN3ID0gaXRlbS50ZXh0dXJlRGF0YS5mcmFtZS53IC8gaXRlbS50ZXh0dXJlRGF0YS5wb3Nlcy54O1xuICAgICAgICAgICAgICAgIHNoID0gaXRlbS50ZXh0dXJlRGF0YS5mcmFtZS5oIC8gaXRlbS50ZXh0dXJlRGF0YS5wb3Nlcy55O1xuICAgICAgICAgICAgICAgIHN4ID0gaXRlbS50ZXh0dXJlRGF0YS5mcmFtZS54ICsgc3cgKiBpdGVtLnBvc2UueDtcbiAgICAgICAgICAgICAgICBzeSA9IGl0ZW0udGV4dHVyZURhdGEuZnJhbWUueSArIHNoICogaXRlbS5wb3NlLnk7XG5cbiAgICAgICAgICAgIH0gIGVsc2Uge1xuICAgICAgICAgICAgICAgIHN4ID0gaXRlbS50ZXh0dXJlRGF0YS5mcmFtZS54XG4gICAgICAgICAgICAgICAgc3kgPSBpdGVtLnRleHR1cmVEYXRhLmZyYW1lLnlcbiAgICAgICAgICAgICAgICBzdyA9IGl0ZW0udGV4dHVyZURhdGEuZnJhbWUudztcbiAgICAgICAgICAgICAgICBzaCA9IGl0ZW0udGV4dHVyZURhdGEuZnJhbWUuaDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChpdGVtLmdlb21ldHJ5ID09PSAnc3F1YXJlJykgeyBcbiAgICAgICAgICAgICAgICB3aWR0aCA9IGl0ZW0ud2lkdGg7XG4gICAgICAgICAgICAgICAgaGVpZ2h0ID0gaXRlbS5oZWlnaHQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoaXRlbS5nZW9tZXRyeSA9PT0gJ2NpcmNsZScpIHsgXG4gICAgICAgICAgICAgICAgd2lkdGggPSBzdztcbiAgICAgICAgICAgICAgICBoZWlnaHQgPSBzaDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGdsLm1hdHJpeC5yZXN0b3JlKCk7IFxuXG4gICAgICAgICAgICBnbC5tYXRyaXgudHJhbnNsYXRlKCAoaXRlbS5wb3MueCArIChjYW52YXNEaW0ueCAvIDIgLSBwb3YueCkpLCAoaXRlbS5wb3MueSArIChjYW52YXNEaW0ueSAvIDIgLSBwb3YueSkpKTtcbiAgICAgICAgICAgIGdsLm1hdHJpeC5yb3RhdGVaKGl0ZW0ucG9zLnJvdCk7XG4gICAgICAgICAgICBnbC5kcmF3SW1nKHN4LCBzeSwgc3csIHNoLCAtIHdpZHRoIC8gMiwgLSBoZWlnaHQgLyAyLCB3aWR0aCwgaGVpZ2h0KTtcblxuICAgICAgICB9XG4gICAgfSk7XG5cbn07XG5cbnZhciBhcGkgPSB7XG4gICAgc3RlcDogZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmIChwb3YpIHN0ZXAoKTtcbiAgICB9LFxuICAgIGNvbm5lY3RDYW1lcmE6IGZ1bmN0aW9uKGNhbWVyYSkge1xuICAgICAgICBwb3YgPSBjYW1lcmEucG9zO1xuICAgIH0sXG4gICAgc2V0R2w6IGZ1bmN0aW9uKGcpIHtcbiAgICAgICAgZ2wgPSBnO1xuICAgIH1cbn07XG5cblxubW9kdWxlLmV4cG9ydHMgPSBhcGk7XG4iLCJ2YXIgYmFzZUVudGl0eSA9IHJlcXVpcmUoJy4vYmFzZUVudGl0eS5qcycpO1xudmFyIHpvbWJpZSA9IHJlcXVpcmUoJy4vWm9tYmllLmpzJyk7XG52YXIgbWFrZVN0YXJ0T3B0aW9ucyA9IHJlcXVpcmUoJy4vbWFrZVN0YXJ0T3B0aW9ucy5qcycpO1xudmFyIG1ha2VHZW9tZXRyeSA9IHJlcXVpcmUoJy4vbWFrZUdlb21ldHJ5LmpzJyk7XG4vL3ZhciB3b3JsZCA9IHJlcXVpcmUoJy4vd29ybGQuanMnKTtcblxubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgdmFyIHNwYXduZXIgPSBiYXNlRW50aXR5KCk7XG4gICAgbWFrZVN0YXJ0T3B0aW9ucyhzcGF3bmVyKTtcbiAgICBtYWtlR2VvbWV0cnkoc3Bhd25lciwgJ2NpcmNsZScpO1xuICAgIHZhciB0aW1lciA9IERhdGUubm93KCk7XG4gICAgdmFyIHNwYXduaW5nID0gb3B0aW9ucy5zdGFydDtcbiAgICB2YXIgc3Bhd25Db3VudCA9IG9wdGlvbnMuc3Bhd25Db3VudDtcbiAgICB2YXIgbGFzdFNwYXduID0gRGF0ZS5ub3coKTtcbiAgICBzcGF3bmVyLnN0YXJ0T3B0aW9ucyh7XG4gICAgICAgIHN0YXJ0OiBvcHRpb25zLnN0YXJ0LFxuICAgICAgICBzcGF3bkNvdW50OiBvcHRpb25zLnNwYXduQ291bnQsXG4gICAgICAgIGludGVydmFsOiBvcHRpb25zLmludGVydmFsXG4gICAgfSk7XG4gICAgXG4gICAgc3Bhd25lci5iYXNlID0gJ3NwYXduZXInO1xuICAgIHNwYXduZXIudHlwZSA9ICd6b21iaWVTcGF3bmVyJztcbiAgICBzcGF3bmVyLm1vdmUob3B0aW9ucy5wb3MpO1xuICAgIHNwYXduZXIuc3RlcChmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIG5vdyA9IERhdGUubm93KCk7XG4gICAgICAgIGlmIChzcGF3bmluZykge1xuICAgICAgICAgICAgaWYgKHNwYXduQ291bnQgPT09IDApIHtcbiAgICAgICAgICAgICAgICBzcGF3bkNvdW50ID0gb3B0aW9ucy5zcGF3bkNvdW50O1xuICAgICAgICAgICAgICAgIHNwYXduaW5nID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgdGltZXIgPSBub3c7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAobm93IC0gbGFzdFNwYXduID4gNTAwKSB7XG4gICAgICAgICAgICAgICAgbGFzdFNwYXduID0gbm93O1xuICAgICAgICAgICAgICAgIHdvcmxkLmxvYWRJdGVtcyh6b21iaWUoe3Bvczogc3Bhd25lci5wb3N9KSk7XG4gICAgICAgICAgICAgICAgc3Bhd25Db3VudC0tO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpZiAobm93IC0gdGltZXIgPiBvcHRpb25zLmludGVydmFsKSB7XG4gICAgICAgICAgICAgICAgc3Bhd25pbmcgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSk7XG5cbiAgICByZXR1cm4gc3Bhd25lcjtcbn07XG5cbiIsIm1vZHVsZS5leHBvcnRzID0ge1wiZnJhbWVzXCI6e1wiYnVsbGV0XCI6e1wiZnJhbWVcIjp7XCJ4XCI6NDUzLFwieVwiOjkyMixcIndcIjoyMDEsXCJoXCI6NDZ9LFwicm90YXRlZFwiOmZhbHNlLFwidHJpbW1lZFwiOmZhbHNlLFwic3ByaXRlU291cmNlU2l6ZVwiOntcInhcIjowLFwieVwiOjAsXCJ3XCI6MjAxLFwiaFwiOjQ2fSxcInNvdXJjZVNpemVcIjp7XCJ3XCI6MjAxLFwiaFwiOjQ2fX0sXCJtYWNoaW5lZ3VuXCI6e1wiZnJhbWVcIjp7XCJ4XCI6MCxcInlcIjo5MjIsXCJ3XCI6MTUwLFwiaFwiOjE1MH0sXCJyb3RhdGVkXCI6ZmFsc2UsXCJ0cmltbWVkXCI6ZmFsc2UsXCJzcHJpdGVTb3VyY2VTaXplXCI6e1wieFwiOjAsXCJ5XCI6MCxcIndcIjoxNTAsXCJoXCI6MTUwfSxcInNvdXJjZVNpemVcIjp7XCJ3XCI6MTUwLFwiaFwiOjE1MH19LFwicGlzdG9sXCI6e1wiZnJhbWVcIjp7XCJ4XCI6MTUxLFwieVwiOjkyMixcIndcIjoxNTAsXCJoXCI6MTUwfSxcInJvdGF0ZWRcIjpmYWxzZSxcInRyaW1tZWRcIjpmYWxzZSxcInNwcml0ZVNvdXJjZVNpemVcIjp7XCJ4XCI6MCxcInlcIjowLFwid1wiOjE1MCxcImhcIjoxNTB9LFwic291cmNlU2l6ZVwiOntcIndcIjoxNTAsXCJoXCI6MTUwfX0sXCJwbGF5ZXJcIjp7XCJmcmFtZVwiOntcInhcIjowLFwieVwiOjAsXCJ3XCI6MTUwMCxcImhcIjoyODB9LFwicm90YXRlZFwiOmZhbHNlLFwidHJpbW1lZFwiOmZhbHNlLFwic3ByaXRlU291cmNlU2l6ZVwiOntcInhcIjowLFwieVwiOjAsXCJ3XCI6MTUwMCxcImhcIjoyODB9LFwic291cmNlU2l6ZVwiOntcIndcIjoxNTAwLFwiaFwiOjI4MH19LFwic2hvdGd1blwiOntcImZyYW1lXCI6e1wieFwiOjMwMixcInlcIjo5MjIsXCJ3XCI6MTUwLFwiaFwiOjE1MH0sXCJyb3RhdGVkXCI6ZmFsc2UsXCJ0cmltbWVkXCI6ZmFsc2UsXCJzcHJpdGVTb3VyY2VTaXplXCI6e1wieFwiOjAsXCJ5XCI6MCxcIndcIjoxNTAsXCJoXCI6MTUwfSxcInNvdXJjZVNpemVcIjp7XCJ3XCI6MTUwLFwiaFwiOjE1MH19LFwid2FsbFwiOntcImZyYW1lXCI6e1wieFwiOjQ1MyxcInlcIjo5NjksXCJ3XCI6MTAwLFwiaFwiOjEwMH0sXCJyb3RhdGVkXCI6ZmFsc2UsXCJ0cmltbWVkXCI6ZmFsc2UsXCJzcHJpdGVTb3VyY2VTaXplXCI6e1wieFwiOjAsXCJ5XCI6MCxcIndcIjoxMDAsXCJoXCI6MTAwfSxcInNvdXJjZVNpemVcIjp7XCJ3XCI6MTAwLFwiaFwiOjEwMH19LFwiem9tYmllMVwiOntcImZyYW1lXCI6e1wieFwiOjAsXCJ5XCI6MTc2MCxcIndcIjoxNTAwLFwiaFwiOjU2MH0sXCJyb3RhdGVkXCI6ZmFsc2UsXCJ0cmltbWVkXCI6ZmFsc2UsXCJzcHJpdGVTb3VyY2VTaXplXCI6e1wieFwiOjAsXCJ5XCI6MCxcIndcIjoxNTAwLFwiaFwiOjU2MH0sXCJzb3VyY2VTaXplXCI6e1wid1wiOjE1MDAsXCJoXCI6NTYwfX0sXCJ6b21iaWUyXCI6e1wiZnJhbWVcIjp7XCJ4XCI6MCxcInlcIjoyODEsXCJ3XCI6MTUwMCxcImhcIjo2NDB9LFwicm90YXRlZFwiOmZhbHNlLFwidHJpbW1lZFwiOmZhbHNlLFwic3ByaXRlU291cmNlU2l6ZVwiOntcInhcIjowLFwieVwiOjAsXCJ3XCI6MTUwMCxcImhcIjo2NDB9LFwic291cmNlU2l6ZVwiOntcIndcIjoxNTAwLFwiaFwiOjY0MH19LFwiem9tYmllM1wiOntcImZyYW1lXCI6e1wieFwiOjAsXCJ5XCI6MTYzNCxcIndcIjoxNTAwLFwiaFwiOjY4Nn0sXCJyb3RhdGVkXCI6ZmFsc2UsXCJ0cmltbWVkXCI6ZmFsc2UsXCJzcHJpdGVTb3VyY2VTaXplXCI6e1wieFwiOjAsXCJ5XCI6MCxcIndcIjoxNTAwLFwiaFwiOjY4Nn0sXCJzb3VyY2VTaXplXCI6e1wid1wiOjE1MDAsXCJoXCI6Njg2fX19LFwibWV0YVwiOntcImFwcFwiOlwiaHR0cHM6Ly93d3cubGVzaHlsYWJzLmNvbS9hcHBzL3NzdG9vbC9cIixcInZlcnNpb25cIjpcIkxlc2h5IFNwcml0ZVNoZWV0IFRvb2wgdjAuOC40XCIsXCJpbWFnZVwiOlwic3ByaXRlc2hlZXQucG5nXCIsXCJzaXplXCI6e1wid1wiOjE1MDAsXCJoXCI6MjMyMH0sXCJzY2FsZVwiOjF9fTtcbiIsInZhciBiYXNlRW50aXR5ID0gcmVxdWlyZSgnLi9iYXNlRW50aXR5LmpzJyk7XG52YXIgbWFrZVZpc2libGUgPSByZXF1aXJlKCcuL21ha2VWaXNpYmxlLmpzJyk7XG52YXIgbWFrZUdlb21ldHJ5ID0gcmVxdWlyZSgnLi9tYWtlR2VvbWV0cnkuanMnKTtcblxubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgdmFyIHNxdWFyZSA9IGJhc2VFbnRpdHkoKTtcbiAgICBtYWtlVmlzaWJsZShzcXVhcmUpO1xuICAgIG1ha2VHZW9tZXRyeShzcXVhcmUsICdzcXVhcmUnKTtcbiAgICBzcXVhcmUuc2V0RGltZW5zaW9ucyh7d2lkdGg6IG9wdGlvbnMud2lkdGgsIGhlaWdodDogb3B0aW9ucy5oZWlnaHR9KTtcbiAgICBzcXVhcmUubW92ZShvcHRpb25zLnBvcyk7XG4gICAgc3F1YXJlLmJhc2UgPSAnc3F1YXJlJztcbiAgICBzcXVhcmUudHlwZSA9ICd0aWxlJztcbiAgICBzcXVhcmUuY29sbGlkZSA9IGZ1bmN0aW9uKCkge307XG5cbiAgICByZXR1cm4gc3F1YXJlO1xufTtcbiIsIm1vZHVsZS5leHBvcnRzID0gW1xuXG4gICAge2VudGl0eTogJ3Rlc3QnLCBwb3M6IHt4OiAtNDAwLCB5OiAtNDA1LCByb3Q6IDB9fSxcbiAgICB7ZW50aXR5OiAndGVzdCcsIHBvczoge3g6IC00MDAsIHk6IC00MDUsIHJvdDogMH19XG4gICAgLy97ZW50aXR5OiAnd2FsbCcsIHBvczoge3g6IC00NTAsIHk6IC00NTAsIHJvdDogMH0sIGRpbToge3c6IDMwMCwgaDogMzAwfX0sXG4gICAgLy97ZW50aXR5OiAnc3F1YXJlJywgcG9zOiB7eDogLTEyNTAsIHk6IC0xMjUwLCByb3Q6IDQ1fSwgZGltOiB7dzogMjUwMCwgaDogMjUwMH19XG5cbiAgICAvKntlbnRpdHk6ICdUaWxlJywgcG9zOiB7eDogMjUwMCwgeTogMjUwMH0sIHdpZHRoOiA1MDAwLCBoZWlnaHQ6IDUwMDAsIHBhdGg6ICcuL2ltZy9iYWNrZ3JvdW5kLmpwZyd9LFxuICAgIHtlbnRpdHk6ICdCbG9jaycsIHBhdGg6ICcuL2ltZy93YWxsLnBuZycsIHBvczoge3g6IDAsIHk6IDM5MDAsIHJvdDogMH0sIHdpZHRoOiAxMDAsIGhlaWdodDogMjYwMH0sXG4gICAge2VudGl0eTogJ0Jsb2NrJywgcGF0aDogJy4vaW1nL3dhbGwucG5nJywgcG9zOiB7eDogMCwgeTogMTEwMCwgcm90OiAwfSwgd2lkdGg6IDEwMCwgaGVpZ2h0OiAyMjAwfSxcbiAgICB7ZW50aXR5OiAnQmxvY2snLCBwYXRoOiAnLi9pbWcvd2FsbC5wbmcnLCBwb3M6IHt4OiAyNTAwLCB5OiAwLCByb3Q6IDB9LCB3aWR0aDogNTAwMCwgaGVpZ2h0OiAxMDB9LFxuICAgIHtlbnRpdHk6ICdCbG9jaycsIHBhdGg6ICcuL2ltZy93YWxsLnBuZycsIHBvczoge3g6IDI1MDAsIHk6IDUwMDAsIHJvdDogMH0sIHdpZHRoOiA1MDAwLCBoZWlnaHQ6IDEwMH0sXG4gICAge2VudGl0eTogJ0Jsb2NrJywgcGF0aDogJy4vaW1nL3dhbGwucG5nJywgcG9zOiB7eDogNTAwMCwgeTogMjUwMCwgcm90OiAwfSwgd2lkdGg6IDEwMCwgaGVpZ2h0OiA1MDAwfSxcbiAgICB7ZW50aXR5OiAnQmxvY2snLCBwYXRoOiAnLi9pbWcvY2FyMS5wbmcnLCBwb3M6IHt4OiAzMDAsIHk6IDMwMCwgcm90OiAyfSwgd2lkdGg6IDIwMCwgaGVpZ2h0OiAzMDB9LFxuICAgIHtlbnRpdHk6ICdab21iaWUnLCBpbWc6IDIsIHBvczoge3g6IDE5MDAsIHk6IDE3MDAsIHJvdDogMH19XG4qL1xuXTtcblxuXG4iLCJ2YXIgYmFzZUVudGl0eSA9IHJlcXVpcmUoJy4vYmFzZUVudGl0eS5qcycpO1xudmFyIG1ha2VHZW9tZXRyeSA9IHJlcXVpcmUoJy4vbWFrZUdlb21ldHJ5LmpzJyk7XG52YXIgbWFrZVNvbGlkID0gcmVxdWlyZSgnLi9tYWtlU29saWQuanMnKTtcblxubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgdmFyIG9iaiA9IGJhc2VFbnRpdHkoKTtcbiAgICBvYmoucmFkaXVzID0gMTA7XG4gICAgbWFrZUdlb21ldHJ5KG9iaiwgJ2NpcmNsZScpO1xuICAgIG1ha2VTb2xpZChvYmopO1xuICAgIG9iai5iYXNlID0gJ29iaic7XG4gICAgb2JqLnR5cGUgPSAndGVzdCc7XG4gICAgb2JqLm1vdmUob3B0aW9ucy5wb3MpO1xuICAgIG9iai5jb2xsaWRlID0gZnVuY3Rpb24oKSB7fTtcblxuICAgIHJldHVybiBvYmo7XG59O1xuXG4iLCJ2YXIgc3ByaXRlcyA9IHJlcXVpcmUoJy4vc3ByaXRlcy5qcycpO1xuXG5tb2R1bGUuZXhwb3J0cyA9IHtcbiAgICBjaGFyYWN0ZXI6IHtcbiAgICAgICAgem9tYmllOiB7IFxuICAgICAgICAgICAgZnJhbWU6IHNwcml0ZXMuZnJhbWVzLnpvbWJpZTIuZnJhbWUsXG4gICAgICAgICAgICBwb3Nlczoge1xuICAgICAgICAgICAgICAgIHg6IDYsXG4gICAgICAgICAgICAgICAgeTogNCxcbiAgICAgICAgICAgICAgICBzbGlkZXM6IFs2LCA1LCAyLCAzXVxuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICB6b21iaWUyOiB7IFxuICAgICAgICAgICAgZnJhbWU6IHNwcml0ZXMuZnJhbWVzLnpvbWJpZTIuZnJhbWUsXG4gICAgICAgICAgICBwb3Nlczoge1xuICAgICAgICAgICAgICAgIHg6IDYsXG4gICAgICAgICAgICAgICAgeTogMixcbiAgICAgICAgICAgICAgICBzbGlkZXM6IFs2LCA1XVxuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICB6b21iaWUzOiB7IFxuICAgICAgICAgICAgZnJhbWU6IHNwcml0ZXMuZnJhbWVzLnpvbWJpZTMuZnJhbWUsXG4gICAgICAgICAgICBwb3Nlczoge1xuICAgICAgICAgICAgICAgIHg6IDYsXG4gICAgICAgICAgICAgICAgeTogMixcbiAgICAgICAgICAgICAgICBzbGlkZXM6IFs2LCA1XVxuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBwbGF5ZXI6IHsgXG4gICAgICAgICAgICBmcmFtZTogc3ByaXRlcy5mcmFtZXMucGxheWVyLmZyYW1lLFxuICAgICAgICAgICAgcG9zZXM6IHtcbiAgICAgICAgICAgICAgICB4OiA2LFxuICAgICAgICAgICAgICAgIHk6IDIsXG4gICAgICAgICAgICAgICAgc2xpZGVzOiBbNiwgNV1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0sXG4gICAgcHJvamVjdGlsZToge1xuICAgICAgICBidWxsZXQ6IHtcbiAgICAgICAgICAgIGZyYW1lOiBzcHJpdGVzLmZyYW1lcy5idWxsZXQuZnJhbWVcbiAgICAgICAgfVxuICAgIH0sXG4gICAgc3F1YXJlOiB7XG4gICAgICAgIHRpbGU6IHtcbiAgICAgICAgICAgIGZyYW1lOiBzcHJpdGVzLmZyYW1lcy53YWxsLmZyYW1lXG4gICAgICAgIH0sXG4gICAgICAgIHdhbGw6IHtcbiAgICAgICAgICAgIGZyYW1lOiBzcHJpdGVzLmZyYW1lcy53YWxsLmZyYW1lXG4gICAgICAgIH1cbiAgICB9LFxuICAgIHdlYXBvbjoge1xuICAgICAgICBndW46IHtcbiAgICAgICAgICAgIGZyYW1lOiBzcHJpdGVzLmZyYW1lcy5waXN0b2wuZnJhbWVcbiAgICAgICAgfVxuICAgIH1cbn07XG4iLCJ2YXIgc3F1YXJlID0gcmVxdWlyZSgnLi9zcXVhcmUuanMnKTtcbnZhciBtYWtlU29saWQgPSByZXF1aXJlKCcuL21ha2VTb2xpZC5qcycpO1xuXG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKG9wdGlvbnMpIHtcbiAgICB3YWxsID0gc3F1YXJlKG9wdGlvbnMpO1xuICAgIHdhbGwub25Ub3AgPSB0cnVlO1xuICAgIG1ha2VTb2xpZCh3YWxsKTtcbiAgICB3YWxsLnR5cGUgPSAnd2FsbCc7XG5cbiAgICByZXR1cm4gd2FsbDtcbn07XG4iLCJ2YXIgbWFrZVZpc2libGUgPSByZXF1aXJlKCcuL21ha2VWaXNpYmxlLmpzJyk7XG52YXIgbWFrZUludmVudG9yeSA9IHJlcXVpcmUoJy4vbWFrZUludmVudG9yeS5qcycpO1xudmFyIGJhc2VFbnRpdHkgPSByZXF1aXJlKCcuL2Jhc2VFbnRpdHkuanMnKTtcbnZhciBtYWtlU29saWQgPSByZXF1aXJlKCcuL21ha2VTb2xpZC5qcycpO1xudmFyIG1ha2VHZW9tZXRyeSA9IHJlcXVpcmUoJy4vbWFrZUdlb21ldHJ5LmpzJyk7XG5cblxubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgd2VhcG9uID0gYmFzZUVudGl0eSgpO1xuICAgIG1ha2VHZW9tZXRyeSh3ZWFwb24sICdjaXJjbGUnKTtcbiAgICBtYWtlU29saWQod2VhcG9uKTtcbiAgICBtYWtlVmlzaWJsZSh3ZWFwb24pO1xuICAgIG1ha2VJbnZlbnRvcnkod2VhcG9uKTtcbiAgICB3ZWFwb24uYmFzZSA9ICd3ZWFwb24nO1xuICAgIHdlYXBvbi5yYWRpdXMgPSAnMTAnO1xuICAgIHdlYXBvbi5jb29sRG93biA9IDU7XG4gICAgd2VhcG9uLmNvbnNvbGlkYXRlSW52ZW50b3J5ID0gdHJ1ZTtcbiAgICB3ZWFwb24uY29sbGlkZSA9IGZ1bmN0aW9uKGNvbGxpZGVyKSB7XG4gICAgICAgIHN3aXRjaCAoY29sbGlkZXIudHlwZSkge1xuICAgICAgICAgICAgY2FzZSAncGxheWVyJzpcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuXG4gICAgfTtcblxuICAgIHJldHVybiB3ZWFwb247XG59O1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgbWF0cml4U3RhY2sgPSByZXF1aXJlKCcuL21hdHJpeFN0YWNrLmpzJyk7XG5tYXRyaXhTdGFjayA9IG5ldyBtYXRyaXhTdGFjaygpO1xuXG52YXIgY2FudmFzU3BhY2UgPSB7fTtcbmNhbnZhc1NwYWNlLndpZHRoID0gMzAwMDtcbmNhbnZhc1NwYWNlLmhlaWdodCA9IDE1MDA7XG5cbnZhciBnbCwgZHJhd0ltYWdlID0ge30sIGRyYXdJbnN0YW5jZXM7XG53aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignbG9hZCcsIGZ1bmN0aW9uKCkge1xuICAgIHZhciBjYW52YXMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2FudmFzJyk7XG4gICAgY2FudmFzLnNldEF0dHJpYnV0ZSgnd2lkdGgnLCBjYW52YXNTcGFjZS53aWR0aCk7XG4gICAgY2FudmFzLnNldEF0dHJpYnV0ZSgnaGVpZ2h0JywgY2FudmFzU3BhY2UuaGVpZ2h0KTtcbiAgICBnbCA9IGNhbnZhcy5nZXRDb250ZXh0KCd3ZWJnbCcpO1xuICAgIHZhciBleHQgPSBnbC5nZXRFeHRlbnNpb24oXCJBTkdMRV9pbnN0YW5jZWRfYXJyYXlzXCIpOyAvLyBWZW5kb3IgcHJlZml4ZXMgbWF5IGFwcGx5IVxuXG5cblxuICAgIC8vIEdldCBBIFdlYkdMIGNvbnRleHRcbiAgICAvKiogQHR5cGUge0hUTUxDYW52YXNFbGVtZW50fSAqL1xuXG5cbiAgICAvLyBzZXR1cCBHTFNMIHByb2dyYW1cbiAgICB2YXIgcHJvZ3JhbSA9IHdlYmdsVXRpbHMuY3JlYXRlUHJvZ3JhbUZyb21TY3JpcHRzKGdsLCBbXCJkcmF3SW1hZ2UtdmVydGV4LXNoYWRlclwiLCBcImRyYXdJbWFnZS1mcmFnbWVudC1zaGFkZXJcIl0pO1xuXG4gICAgLy8gbG9vayB1cCB3aGVyZSB0aGUgdmVydGV4IGRhdGEgbmVlZHMgdG8gZ28uXG4gICAgdmFyIHBvc2l0aW9uTG9jYXRpb24gPSBnbC5nZXRBdHRyaWJMb2NhdGlvbihwcm9ncmFtLCBcImFfcG9zaXRpb25cIik7XG4gICAgdmFyIHRleGNvb3JkTG9jYXRpb24gPSBnbC5nZXRBdHRyaWJMb2NhdGlvbihwcm9ncmFtLCBcImFfdGV4Y29vcmRcIik7XG4gICAgdmFyIGluc3RhbmNlTG9jYXRpb24gPSBnbC5nZXRBdHRyaWJMb2NhdGlvbihwcm9ncmFtLCBcImFfaW5zdGFuY2VcIik7XG5cbiAgICAvLyBsb29rdXAgdW5pZm9ybXNcbiAgICB2YXIgbWF0cml4TG9jYXRpb24gPSBnbC5nZXRVbmlmb3JtTG9jYXRpb24ocHJvZ3JhbSwgXCJ1X21hdHJpeFwiKTtcbiAgICB2YXIgdGV4dHVyZU1hdHJpeExvY2F0aW9uID0gZ2wuZ2V0VW5pZm9ybUxvY2F0aW9uKHByb2dyYW0sIFwidV90ZXh0dXJlTWF0cml4XCIpO1xuICAgIHZhciB0ZXh0dXJlTG9jYXRpb24gPSBnbC5nZXRVbmlmb3JtTG9jYXRpb24ocHJvZ3JhbSwgXCJ1X3RleHR1cmVcIik7XG5cbiAgICB2YXIgaW5zdGFuY2VCdWZmZXIgPSBnbC5jcmVhdGVCdWZmZXIoKTtcbiAgICBnbC5iaW5kQnVmZmVyKGdsLkFSUkFZX0JVRkZFUiwgaW5zdGFuY2VCdWZmZXIpO1xuICAgIGdsLmJ1ZmZlckRhdGEoZ2wuQVJSQVlfQlVGRkVSLCBbMCwgMCwgMF0sIGdsLlNUQVRJQ19EUkFXKTtcbiAgICAvLyBDcmVhdGUgYSBidWZmZXIuXG4gICAgdmFyIHBvc2l0aW9uQnVmZmVyID0gZ2wuY3JlYXRlQnVmZmVyKCk7XG4gICAgZ2wuYmluZEJ1ZmZlcihnbC5BUlJBWV9CVUZGRVIsIHBvc2l0aW9uQnVmZmVyKTtcblxuICAgIC8vIFB1dCBhIHVuaXQgcXVhZCBpbiB0aGUgYnVmZmVyXG4gICAgdmFyIHBvc2l0aW9ucyA9IFtcbiAgICAgICAgMCwgMCxcbiAgICAgICAgMCwgMSxcbiAgICAgICAgMSwgMCxcbiAgICAgICAgMSwgMCxcbiAgICAgICAgMCwgMSxcbiAgICAgICAgMSwgMSxcbiAgICBdO1xuICAgIGdsLmJ1ZmZlckRhdGEoZ2wuQVJSQVlfQlVGRkVSLCBuZXcgRmxvYXQzMkFycmF5KHBvc2l0aW9ucyksIGdsLlNUQVRJQ19EUkFXKTtcblxuICAgIC8vIENyZWF0ZSBhIGJ1ZmZlciBmb3IgdGV4dHVyZSBjb29yZHNcbiAgICB2YXIgdGV4Y29vcmRCdWZmZXIgPSBnbC5jcmVhdGVCdWZmZXIoKTtcbiAgICBnbC5iaW5kQnVmZmVyKGdsLkFSUkFZX0JVRkZFUiwgdGV4Y29vcmRCdWZmZXIpO1xuXG4gICAgLy8gUHV0IHRleGNvb3JkcyBpbiB0aGUgYnVmZmVyXG4gICAgdmFyIHRleGNvb3JkcyA9IFtcbiAgICAgICAgMCwgMCxcbiAgICAgICAgMCwgMSxcbiAgICAgICAgMSwgMCxcbiAgICAgICAgMSwgMCxcbiAgICAgICAgMCwgMSxcbiAgICAgICAgMSwgMSxcbiAgICBdO1xuICAgIGdsLmJ1ZmZlckRhdGEoZ2wuQVJSQVlfQlVGRkVSLCBuZXcgRmxvYXQzMkFycmF5KHRleGNvb3JkcyksIGdsLlNUQVRJQ19EUkFXKTtcblxuICAgIC8vIGNyZWF0ZXMgYSB0ZXh0dXJlIGluZm8geyB3aWR0aDogdywgaGVpZ2h0OiBoLCB0ZXh0dXJlOiB0ZXggfVxuICAgIC8vIFRoZSB0ZXh0dXJlIHdpbGwgc3RhcnQgd2l0aCAxeDEgcGl4ZWxzIGFuZCBiZSB1cGRhdGVkXG4gICAgLy8gd2hlbiB0aGUgaW1hZ2UgaGFzIGxvYWRlZFxuICAgIGZ1bmN0aW9uIGxvYWRJbWFnZUFuZENyZWF0ZVRleHR1cmVJbmZvKHVybCkge1xuICAgICAgICB2YXIgdGV4ID0gZ2wuY3JlYXRlVGV4dHVyZSgpO1xuICAgICAgICBnbC5iaW5kVGV4dHVyZShnbC5URVhUVVJFXzJELCB0ZXgpO1xuICAgICAgICAvLyBGaWxsIHRoZSB0ZXh0dXJlIHdpdGggYSAxeDEgYmx1ZSBwaXhlbC5cbiAgICAgICAgZ2wudGV4SW1hZ2UyRChnbC5URVhUVVJFXzJELCAwLCBnbC5SR0JBLCAxLCAxLCAwLCBnbC5SR0JBLCBnbC5VTlNJR05FRF9CWVRFLFxuICAgICAgICAgICAgICAgIG5ldyBVaW50OEFycmF5KFswLCAwLCAyNTUsIDI1NV0pKTtcblxuICAgICAgICAvLyBsZXQncyBhc3N1bWUgYWxsIGltYWdlcyBhcmUgbm90IGEgcG93ZXIgb2YgMlxuICAgICAgICBnbC50ZXhQYXJhbWV0ZXJpKGdsLlRFWFRVUkVfMkQsIGdsLlRFWFRVUkVfV1JBUF9TLCBnbC5DTEFNUF9UT19FREdFKTtcbiAgICAgICAgZ2wudGV4UGFyYW1ldGVyaShnbC5URVhUVVJFXzJELCBnbC5URVhUVVJFX1dSQVBfVCwgZ2wuQ0xBTVBfVE9fRURHRSk7XG4gICAgICAgIGdsLnRleFBhcmFtZXRlcmkoZ2wuVEVYVFVSRV8yRCwgZ2wuVEVYVFVSRV9NSU5fRklMVEVSLCBnbC5MSU5FQVIpO1xuXG4gICAgICAgIHZhciB0ZXh0dXJlSW5mbyA9IHtcbiAgICAgICAgICAgIHdpZHRoOiAxLCAgIC8vIHdlIGRvbid0IGtub3cgdGhlIHNpemUgdW50aWwgaXQgbG9hZHNcbiAgICAgICAgICAgIGhlaWdodDogMSxcbiAgICAgICAgICAgIHRleHR1cmU6IHRleCxcbiAgICAgICAgfTtcbiAgICAgICAgdmFyIGltZyA9IG5ldyBJbWFnZSgpO1xuICAgICAgICBpbWcuYWRkRXZlbnRMaXN0ZW5lcignbG9hZCcsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdGV4dHVyZUluZm8ud2lkdGggPSBpbWcud2lkdGg7XG4gICAgICAgICAgICB0ZXh0dXJlSW5mby5oZWlnaHQgPSBpbWcuaGVpZ2h0O1xuXG4gICAgICAgICAgICBnbC5iaW5kVGV4dHVyZShnbC5URVhUVVJFXzJELCB0ZXh0dXJlSW5mby50ZXh0dXJlKTtcbiAgICAgICAgICAgIGdsLnRleEltYWdlMkQoZ2wuVEVYVFVSRV8yRCwgMCwgZ2wuUkdCQSwgZ2wuUkdCQSwgZ2wuVU5TSUdORURfQllURSwgaW1nKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGltZy5zcmMgPSB1cmw7XG5cbiAgICAgICAgcmV0dXJuIHRleHR1cmVJbmZvO1xuICAgIH07XG5cbiAgICB2YXIgdGV4dHVyZSA9IGxvYWRJbWFnZUFuZENyZWF0ZVRleHR1cmVJbmZvKCcuL2ltZy9zcHJpdGVzaGVldC5wbmcnKTtcblxuXG4gICAgLy8gVW5saWtlIGltYWdlcywgdGV4dHVyZXMgZG8gbm90IGhhdmUgYSB3aWR0aCBhbmQgaGVpZ2h0IGFzc29jaWF0ZWRcbiAgICAvLyB3aXRoIHRoZW0gc28gd2UnbGwgcGFzcyBpbiB0aGUgd2lkdGggYW5kIGhlaWdodCBvZiB0aGUgdGV4dHVyZVxuICAgIGRyYXdJbWFnZSA9IGZ1bmN0aW9uKFxuICAgICAgICAgICAgc3JjWCwgc3JjWSwgc3JjV2lkdGgsIHNyY0hlaWdodCxcbiAgICAgICAgICAgIGRzdFgsIGRzdFksIGRzdFdpZHRoLCBkc3RIZWlnaHRcbiAgICAgICAgICAgICkge1xuICAgICAgICB2YXIgc3JjUm90YXRpb24gPSAwO1xuICAgICAgICBpZiAoZHN0WCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBkc3RYID0gc3JjWDtcbiAgICAgICAgICAgIHNyY1ggPSAwO1xuICAgICAgICB9XG4gICAgICAgIGlmIChkc3RZID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGRzdFkgPSBzcmNZO1xuICAgICAgICAgICAgc3JjWSA9IDA7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHNyY1dpZHRoID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHNyY1dpZHRoID0gdGV4dHVyZS53aWR0aDtcbiAgICAgICAgfVxuICAgICAgICBpZiAoc3JjSGVpZ2h0ID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHNyY0hlaWdodCA9IHRleHR1cmUuaGVpZ2h0O1xuICAgICAgICB9XG4gICAgICAgIGlmIChkc3RXaWR0aCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBkc3RXaWR0aCA9IHNyY1dpZHRoO1xuICAgICAgICAgICAgc3JjV2lkdGggPSB0ZXh0dXJlLndpZHRoO1xuICAgICAgICB9XG4gICAgICAgIGlmIChkc3RIZWlnaHQgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgZHN0SGVpZ2h0ID0gc3JjSGVpZ2h0O1xuICAgICAgICAgICAgc3JjSGVpZ2h0ID0gdGV4dHVyZS5oZWlnaHQ7XG4gICAgICAgIH1cblxuICAgICAgICBnbC5iaW5kVGV4dHVyZShnbC5URVhUVVJFXzJELCB0ZXh0dXJlLnRleHR1cmUpO1xuXG4gICAgICAgIC8vIFRlbGwgV2ViR0wgdG8gdXNlIG91ciBzaGFkZXIgcHJvZ3JhbSBwYWlyXG4gICAgICAgIGdsLnVzZVByb2dyYW0ocHJvZ3JhbSk7XG5cbiAgICAgICAgLy8gU2V0dXAgdGhlIGF0dHJpYnV0ZXMgdG8gcHVsbCBkYXRhIGZyb20gb3VyIGJ1ZmZlcnNcbiAgICAgICAgZ2wuYmluZEJ1ZmZlcihnbC5BUlJBWV9CVUZGRVIsIHBvc2l0aW9uQnVmZmVyKTtcbiAgICAgICAgZ2wuZW5hYmxlVmVydGV4QXR0cmliQXJyYXkocG9zaXRpb25Mb2NhdGlvbik7XG4gICAgICAgIGdsLnZlcnRleEF0dHJpYlBvaW50ZXIocG9zaXRpb25Mb2NhdGlvbiwgMiwgZ2wuRkxPQVQsIGZhbHNlLCAwLCAwKTtcbiAgICAgICAgZ2wuYmluZEJ1ZmZlcihnbC5BUlJBWV9CVUZGRVIsIHRleGNvb3JkQnVmZmVyKTtcbiAgICAgICAgZ2wuZW5hYmxlVmVydGV4QXR0cmliQXJyYXkodGV4Y29vcmRMb2NhdGlvbik7XG4gICAgICAgIGdsLnZlcnRleEF0dHJpYlBvaW50ZXIodGV4Y29vcmRMb2NhdGlvbiwgMiwgZ2wuRkxPQVQsIGZhbHNlLCAwLCAwKTtcblxuICAgICAgICAvLyB0aGlzIG1hdGlyeCB3aWxsIGNvbnZlcnQgZnJvbSBwaXhlbHMgdG8gY2xpcCBzcGFjZVxuICAgICAgICB2YXIgbWF0cml4ID0gbTQub3J0aG9ncmFwaGljKDAsIGNhbnZhc1NwYWNlLndpZHRoLCBjYW52YXNTcGFjZS5oZWlnaHQsIDAsIC0xLCAxKTtcblxuICAgICAgICAvLyB0aGlzIG1hdHJpeCBtb3ZlcyB0aGUgb3JpZ2luIHRvIHRoZSBvbmUgcmVwcmVzZW50ZWQgYnlcbiAgICAgICAgLy8gdGhlIGN1cnJlbnQgbWF0cml4IHN0YWNrLlxuICAgICAgICBtYXRyaXggPSBtNC5tdWx0aXBseShtYXRyaXgsIG1hdHJpeFN0YWNrLmdldEN1cnJlbnRNYXRyaXgoKSk7XG5cbiAgICAgICAgbWF0cml4ID0gbTQudHJhbnNsYXRlKG1hdHJpeCwgZHN0WCwgZHN0WSwgMCk7XG5cbiAgICAgICAgLy8gdGhpcyBtYXRyaXggd2lsbCBzY2FsZSBvdXIgMSB1bml0IHF1YWRcbiAgICAgICAgLy8gZnJvbSAxIHVuaXQgdG8gdGV4dHVyZS53aWR0aCwgdGV4dHVyZS5oZWlnaHQgdW5pdHNcbiAgICAgICAgbWF0cml4ID0gbTQuc2NhbGUobWF0cml4LCBkc3RXaWR0aCwgZHN0SGVpZ2h0LCAxKTtcblxuICAgICAgICAvLyBTZXQgdGhlIG1hdHJpeC5cbiAgICAgICAgZ2wudW5pZm9ybU1hdHJpeDRmdihtYXRyaXhMb2NhdGlvbiwgZmFsc2UsIG1hdHJpeCk7XG5cbiAgICAgICAgLy8ganVzdCBsaWtlIGEgMmQgcHJvamVjdGlvbiBtYXRyaXggZXhjZXB0IGluIHRleHR1cmUgc3BhY2UgKDAgdG8gMSlcbiAgICAgICAgLy8gaW5zdGVhZCBvZiBjbGlwIHNwYWNlLiBUaGlzIG1hdHJpeCBwdXRzIHVzIGluIHBpeGVsIHNwYWNlLlxuICAgICAgICB2YXIgdGV4TWF0cml4ID0gbTQuc2NhbGluZygxIC8gdGV4dHVyZS53aWR0aCwgMSAvIHRleHR1cmUuaGVpZ2h0LCAxKTtcblxuICAgICAgICAvLyBXZSBuZWVkIHRvIHBpY2sgYSBwbGFjZSB0byByb3RhdGUgYXJvdW5kXG4gICAgICAgIC8vIFdlJ2xsIG1vdmUgdG8gdGhlIG1pZGRsZSwgcm90YXRlLCB0aGVuIG1vdmUgYmFja1xuICAgICAgICAvL3RleE1hdHJpeCA9IG00LnRyYW5zbGF0ZSh0ZXhNYXRyaXgsIChzcmNYICsgc3JjV2lkdGggKiAwLjUpLCAoc3JjWSArIHNyY0hlaWdodCAqIDAuNSksIDApO1xuICAgICAgICAvL3RleE1hdHJpeCA9IG00LnpSb3RhdGUodGV4TWF0cml4LCBzcmNSb3RhdGlvbik7XG4gICAgICAgIC8vdGV4TWF0cml4ID0gbTQudHJhbnNsYXRlKHRleE1hdHJpeCwgLShzcmNYICsgc3JjV2lkdGggKiAwLjUpLCAtKHNyY1kgKyBzcmNIZWlnaHQgKiAwLjUpLCAwKTtcblxuICAgICAgICAvLyBiZWNhdXNlIHdlcmUgaW4gcGl4ZWwgc3BhY2VcbiAgICAgICAgLy8gdGhlIHNjYWxlIGFuZCB0cmFuc2xhdGlvbiBhcmUgbm93IGluIHBpeGVsc1xuICAgICAgICB0ZXhNYXRyaXggPSBtNC50cmFuc2xhdGUodGV4TWF0cml4LCBzcmNYLCBzcmNZLCAwKTtcbiAgICAgICAgdGV4TWF0cml4ID0gbTQuc2NhbGUodGV4TWF0cml4LCBzcmNXaWR0aCwgc3JjSGVpZ2h0LCAxKTtcblxuICAgICAgICAvLyBTZXQgdGhlIHRleHR1cmUgbWF0cml4LlxuICAgICAgICBnbC51bmlmb3JtTWF0cml4NGZ2KHRleHR1cmVNYXRyaXhMb2NhdGlvbiwgZmFsc2UsIHRleE1hdHJpeCk7XG5cbiAgICAgICAgLy8gVGVsbCB0aGUgc2hhZGVyIHRvIGdldCB0aGUgdGV4dHVyZSBmcm9tIHRleHR1cmUgdW5pdCAwXG4gICAgICAgIGdsLnVuaWZvcm0xaSh0ZXh0dXJlTG9jYXRpb24sIDApO1xuXG4gICAgICAgIC8vIGRyYXcgdGhlIHF1YWQgKDIgdHJpYW5nbGVzLCA2IHZlcnRpY2VzKVxuICAgICAgICBnbC5kcmF3QXJyYXlzKGdsLlRSSUFOR0xFUywgMCwgNik7XG4gICAgfTtcblxuICAgIGRyYXdJbnN0YW5jZXMgPSBmdW5jdGlvbih0eXBlLCBpbnN0YW5jZXMpIHtcbiAgICAgICAgZ2wuYmluZFRleHR1cmUoZ2wuVEVYVFVSRV8yRCwgdGV4dHVyZS50ZXh0dXJlKTtcblxuICAgICAgICAvLyBUZWxsIFdlYkdMIHRvIHVzZSBvdXIgc2hhZGVyIHByb2dyYW0gcGFpclxuICAgICAgICBnbC51c2VQcm9ncmFtKHByb2dyYW0pO1xuXG4gICAgICAgIHZhciBkYXRhID0gbmV3IEZsb2F0MzJBcnJheShpbnN0YW5jZXMpO1xuICAgICAgICB2YXIgaW5zdGFuY2VDb3VudCA9IGluc3RhbmNlcy5sZW5ndGggLyAzO1xuICAgICAgICBnbC5iaW5kQnVmZmVyKGdsLkFSUkFZX0JVRkZFUiwgaW5zdGFuY2VCdWZmZXIpO1xuICAgICAgICBnbC5idWZmZXJEYXRhKGdsLkFSUkFZX0JVRkZFUiwgZGF0YSwgZ2wuU1RBVElDX0RSQVcpO1xuICAgICAgICBnbC5lbmFibGVWZXJ0ZXhBdHRyaWJBcnJheShpbnN0YW5jZUxvY2F0aW9uKTtcbiAgICAgICAgZ2wudmVydGV4QXR0cmliUG9pbnRlcihpbnN0YW5jZUxvY2F0aW9uLCAzLCBnbC5GTE9BVCwgZmFsc2UsIDEyLCAwKTtcbiAgICAgICAgZXh0LnZlcnRleEF0dHJpYkRpdmlzb3JBTkdMRShpbnN0YW5jZUxvY2F0aW9uLCAzKTsgLy8gVGhpcyBtYWtlcyBpdCBpbnN0YW5jZWQhXG5cbiAgICAgICAgLy8gU2V0dXAgdGhlIGF0dHJpYnV0ZXMgdG8gcHVsbCBkYXRhIGZyb20gb3VyIGJ1ZmZlcnNcbiAgICAgICAgZ2wuYmluZEJ1ZmZlcihnbC5BUlJBWV9CVUZGRVIsIHBvc2l0aW9uQnVmZmVyKTtcbiAgICAgICAgZ2wuZW5hYmxlVmVydGV4QXR0cmliQXJyYXkocG9zaXRpb25Mb2NhdGlvbik7XG4gICAgICAgIGdsLnZlcnRleEF0dHJpYlBvaW50ZXIocG9zaXRpb25Mb2NhdGlvbiwgMiwgZ2wuRkxPQVQsIGZhbHNlLCAwLCAwKTtcbiAgICAgICAgZ2wuYmluZEJ1ZmZlcihnbC5BUlJBWV9CVUZGRVIsIHRleGNvb3JkQnVmZmVyKTtcbiAgICAgICAgZ2wuZW5hYmxlVmVydGV4QXR0cmliQXJyYXkodGV4Y29vcmRMb2NhdGlvbik7XG4gICAgICAgIGdsLnZlcnRleEF0dHJpYlBvaW50ZXIodGV4Y29vcmRMb2NhdGlvbiwgMiwgZ2wuRkxPQVQsIGZhbHNlLCAwLCAwKTtcblxuICAgICAgICB2YXIgbWF0cml4ID0gbTQub3J0aG9ncmFwaGljKDAsIGNhbnZhc1NwYWNlLndpZHRoLCBjYW52YXNTcGFjZS5oZWlnaHQsIDAsIC0xLCAxKTtcbiAgICAgICAgbWF0cml4ID0gbTQubXVsdGlwbHkobWF0cml4LCBtYXRyaXhTdGFjay5nZXRDdXJyZW50TWF0cml4KCkpO1xuICAgICAgICBnbC51bmlmb3JtTWF0cml4NGZ2KG1hdHJpeExvY2F0aW9uLCBmYWxzZSwgbWF0cml4KTtcblxuICAgICAgICAvLyBUZWxsIHRoZSBzaGFkZXIgdG8gZ2V0IHRoZSB0ZXh0dXJlIGZyb20gdGV4dHVyZSB1bml0IDBcbiAgICAgICAgZ2wudW5pZm9ybTFpKHRleHR1cmVMb2NhdGlvbiwgMCk7XG5cbiAgICAgICAgLy8gQmluZCB0aGUgaW5zdGFuY2UgcG9zaXRpb24gZGF0YVxuICAgICAgICBcbiAgICAgICAgLy8gRHJhdyB0aGUgaW5zdGFuY2VkIG1lc2hlc1xuICAgICAgICBleHQuZHJhd0FycmF5c0luc3RhbmNlZEFOR0xFKGdsLlRSSUFOR0xFUywgMCwgNiwgaW5zdGFuY2VDb3VudCk7XG4gICAgfTtcbn0pO1xuXG5cbm1vZHVsZS5leHBvcnRzID0ge1xuICAgIGRyYXdJbnN0YW5jZXM6IGZ1bmN0aW9uKCkge1xuICAgICAgICBkcmF3SW5zdGFuY2VzLmFwcGx5KG51bGwsIGFyZ3VtZW50cyk7XG4gICAgfSxcbiAgICBkcmF3SW1nOiBmdW5jdGlvbigpIHtcbiAgICAgICAgZHJhd0ltYWdlLmFwcGx5KG51bGwsIGFyZ3VtZW50cyk7XG4gICAgfSxcbiAgICBjbGVhcjogZnVuY3Rpb24oKSB7XG4gICAgICAgIGdsLnZpZXdwb3J0KDAsIDAsIGNhbnZhc1NwYWNlLndpZHRoLCBjYW52YXNTcGFjZS5oZWlnaHQpO1xuXG4gICAgICAgIGdsLmNsZWFyKGdsLkNPTE9SX0JVRkZFUl9CSVQpO1xuICAgIH0sXG4gICAgbWF0cml4OiBtYXRyaXhTdGFjayxcbiAgICBjYW52YXNEaW1lbnNpb25zOiB7XG4gICAgICAgIHg6IGNhbnZhc1NwYWNlLndpZHRoLFxuICAgICAgICB5OiBjYW52YXNTcGFjZS5oZWlnaHRcbiAgICB9XG59O1xuIiwidmFyIGV2ZW50cyA9IHJlcXVpcmUoJy4vZXZlbnRzLmpzJyk7XG52YXIgbGV2ZWwgPSB7fTtcbmxldmVsLmdhbWUgPSByZXF1aXJlKCcuL2xldmVsLmpzJyk7XG5sZXZlbC50ZXN0ID0gcmVxdWlyZSgnLi90ZXN0LWxldmVsLmpzJyk7XG52YXIgRW50aXRpZXMgPSByZXF1aXJlKCcuL2dldEVudGl0aWVzLmpzJyk7XG52YXIgY2lyY2xlcyA9IFtdO1xudmFyIHNxdWFyZXMgPSBbXTtcbnZhciBwb2ludHMgPSBbXTtcbnZhciB4cyA9IFtdO1xuXG52YXIgZ2V0ID0gcmVxdWlyZSgnLi9nZXQuanMnKTtcblxudmFyIHdvcmxkID0gW107XG52YXIgbmV3SXRlbXMgPSBbXTtcbnZhciB1bml2ZXJzYWxEZWNvcmF0b3JzID0gW107XG52YXIgbGV2ZWxNZXRhZGF0YSA9IHt9O1xuXG52YXIgYXBpID0ge1xuICAgIHNldExldmVsTWV0YWRhdGE6IGZ1bmN0aW9uKG5ld0RhdGEpIHtcbiAgICAgICAgZm9yICh2YXIgdmFsIGluIG5ld0RhdGEpIHtcbiAgICAgICAgICAgIGxldmVsTWV0YWRhdGFbdmFsXSA9IG5ld0RhdGFbdmFsXTtcbiAgICAgICAgfVxuICAgICAgICBldmVudHMuZW1pdCgndXBkYXRlTGV2ZWxOYW1lJyk7XG4gICAgfSxcbiAgICBnZXRMZXZlbE1ldGFkYXRhOiBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIGxldmVsTWV0YWRhdGE7XG4gICAgfSxcbiAgICBkZWNvcmF0ZUFsbEl0ZW1zOiBmdW5jdGlvbihkZWNvcmF0b3IpIHtcbiAgICAgICAgd29ybGQuZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7IGRlY29yYXRvcihpdGVtKTsgfSk7XG4gICAgICAgIHVuaXZlcnNhbERlY29yYXRvcnMucHVzaChkZWNvcmF0b3IpO1xuICAgIH0sXG4gICAgdW5sb2FkV29ybGQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICB3b3JsZC5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICAgICAgICAgIGl0ZW0udW5sb2FkKCk7XG4gICAgICAgIH0pO1xuICAgICAgICBhcGkuc2V0TGV2ZWxNZXRhZGF0YSh7XG4gICAgICAgICAgICBpZDogbnVsbCxcbiAgICAgICAgICAgIG5hbWU6IG51bGxcbiAgICAgICAgfSk7XG4gICAgfSxcbiAgICBsb2FkTGV2ZWw6IGZ1bmN0aW9uKGxldmVsSWQsIGNhbGxiYWNrKSB7XG4gICAgICAgIGFwaS51bmxvYWRXb3JsZCgpO1xuICAgICAgICBnZXQoJy4vbGV2ZWxzLycgKyBsZXZlbElkLCBmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICBhcGkubG9hZEl0ZW1zKEpTT04ucGFyc2UoZGF0YS5kYXRhKSk7XG4gICAgICAgICAgICBhcGkuc3RlcCgpO1xuICAgICAgICAgICAgYXBpLnNldExldmVsTWV0YWRhdGEoe1xuICAgICAgICAgICAgICAgIG5hbWU6IGRhdGEubmFtZSxcbiAgICAgICAgICAgICAgICBpZDogZGF0YS5pZFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBpZiAoY2FsbGJhY2spIGNhbGxiYWNrKCk7XG4gICAgICAgIH0pO1xuICAgICAgICBhcGkuc29ydEl0ZW1zKCk7XG4gICAgfSxcbiAgICBsb2FkSXRlbXM6IGZ1bmN0aW9uKGl0ZW1zKSB7XG4gICAgICAgIFxuICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkoaXRlbXMpKSB7XG4gICAgICAgICAgICBpdGVtcyA9IFtpdGVtc107XG4gICAgICAgIH1cblxuICAgICAgICBpdGVtcyA9IGl0ZW1zLm1hcChmdW5jdGlvbihpdGVtKSB7XG4gICAgICAgICAgICB2YXIgZW50aXR5ID0gaXRlbTtcbiAgICAgICAgICAgIGlmICghZW50aXR5LnR5cGUpIGVudGl0eSA9IEVudGl0aWVzW2l0ZW0uZW50aXR5XShpdGVtKTtcbiAgICAgICAgICAgIGVudGl0eS5sb2FkKCk7XG4gICAgICAgICAgICB1bml2ZXJzYWxEZWNvcmF0b3JzLmZvckVhY2goZnVuY3Rpb24oZGVjb3JhdG9yKSB7XG4gICAgICAgICAgICAgICAgZGVjb3JhdG9yKGVudGl0eSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiBlbnRpdHk7XG4gICAgICAgIH0pO1xuICAgICAgICBuZXdJdGVtcyA9IG5ld0l0ZW1zLmNvbmNhdChpdGVtcyk7XG4gICAgICAgIGlmIChpdGVtcy5sZW5ndGggPiAxKSByZXR1cm4gaXRlbXM7XG4gICAgICAgIHJldHVybiBpdGVtc1swXTtcbiAgICB9LFxuICAgIGdldEl0ZW1zOiBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHdvcmxkLnNsaWNlKCk7XG4gICAgfSxcbiAgICBnZXRJdGVtQnlJZDogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgcmV0dXJuIHdvcmxkLmZpbHRlcihmdW5jdGlvbihpdGVtKSB7XG4gICAgICAgICAgICBpZiAoaXRlbS5pZCA9PT0gaWQpIHJldHVybiB0cnVlO1xuICAgICAgICB9KVswXTtcbiAgICB9LFxuICAgIGdldEl0ZW1zQnlUeXBlOiBmdW5jdGlvbih0eXBlKSB7XG4gICAgICAgIHJldHVybiB3b3JsZC5maWx0ZXIoZnVuY3Rpb24oaXRlbSkge1xuICAgICAgICAgICAgaWYgKGl0ZW0udHlwZSA9PT0gdHlwZSkgcmV0dXJuIHRydWU7XG4gICAgICAgIH0pO1xuICAgIH0sXG4gICAgZGVsZXRlSXRlbTogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgd29ybGQgPSB3b3JsZC5maWx0ZXIoZnVuY3Rpb24oaXRlbSkgeyBpZiAoaXRlbS5pZCAhPT0gaWQpIHJldHVybiB0cnVlOyB9KTtcbiAgICAgICAgZXZlbnRzLmVtaXQoJ2VudGl0eUNvdW50Jyk7XG4gICAgfSxcbiAgICBnZXRYczogZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiB4cztcbiAgICB9LFxuICAgIHVwZGF0ZU5ld0l0ZW1zOiBmdW5jdGlvbigpIHtcbiAgICAgICAgd29ybGQgPSB3b3JsZC5jb25jYXQobmV3SXRlbXMpO1xuICAgICAgICBhcGkuc29ydEl0ZW1zKCk7XG4gICAgICAgIGlmIChuZXdJdGVtcy5sZW5ndGgpIGV2ZW50cy5lbWl0KCdlbnRpdHlDb3VudCcpO1xuICAgICAgICBuZXdJdGVtcyA9IFtdO1xuICAgIH0sXG4gICAgc3RlcDogZnVuY3Rpb24oKSB7XG4gICAgICAgIGFwaS51cGRhdGVOZXdJdGVtcygpO1xuICAgICAgICB4cyA9IFtdO1xuICAgICAgICB5cyA9IFtdO1xuICAgICAgICBuZXdJdGVtcyA9IFtdO1xuICAgICAgICBjaXJjbGVzID0gW107XG4gICAgICAgIHNxdWFyZXMgPSBbXTtcbiAgICAgICAgcG9pbnRzID0gW107XG4gICAgICAgIHdvcmxkLmZvckVhY2goZnVuY3Rpb24oaXRlbSkgeyBcbiAgICAgICAgICAgIGlmIChpdGVtLmdlb21ldHJ5ID09PSAnY2lyY2xlJyAmJiBpdGVtLnNvbGlkKSB7XG4gICAgICAgICAgICAgICAgY2lyY2xlcy5wdXNoKGl0ZW0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGl0ZW0uZ2VvbWV0cnkgPT09ICdzcXVhcmUnICYmIGl0ZW0uc29saWQpIHNxdWFyZXMucHVzaChpdGVtKTtcbiAgICAgICAgICAgIGlmIChpdGVtLmdlb21ldHJ5ID09PSAncG9pbnQnICYmIGl0ZW0uc29saWQpIHBvaW50cy5wdXNoKGl0ZW0pO1xuICAgICAgICAgICAgaXRlbS5jb2xsaXNpb25EYXRhID0ge307XG4gICAgICAgICAgICBpdGVtLnN0ZXAuY2FsbChpdGVtKTsgXG4gICAgICAgICAgICBpZiAoaXRlbS5nZW9tZXRyeSAmJiBpdGVtLnNvbGlkICYmICFpdGVtLmluQ29udGFpbmVyKCkpIHhzID0geHMuY29uY2F0KGl0ZW0uQUFCQi54cyk7XG4gICAgICAgIH0pO1xuICAgICAgICBhcGkuc29ydEl0ZW1zKCk7XG4gICAgICAgIHhzLnNvcnQoZnVuY3Rpb24oYSwgYikge1xuICAgICAgICAgICAgcmV0dXJuIChhLnZhbCAtIGIudmFsKTtcbiAgICAgICAgfSk7XG4gICAgfSxcbiAgICBzb3J0SXRlbXM6IGZ1bmN0aW9uKCkge1xuICAgICAgICB3b3JsZC5zb3J0KGZ1bmN0aW9uKGEsIGIpIHtcbiAgICAgICAgICAgIHJldHVybiBhLm9uVG9wO1xuICAgICAgICB9KTtcbiAgICB9LFxuICAgIGdldEdlb21ldHJ5KGdlb21ldHJ5KSB7XG4gICAgICAgIGlmIChnZW9tZXRyeSA9PT0gJ2NpcmNsZScpIHJldHVybiBjaXJjbGVzO1xuICAgICAgICBpZiAoZ2VvbWV0cnkgPT09ICdzcXVhcmUnKSByZXR1cm4gc3F1YXJlcztcbiAgICAgICAgaWYgKGdlb21ldHJ5ID09PSAncG9pbnQnKSByZXR1cm4gcG9pbnRzO1xuICAgIH0sXG4gICAgZ2V0RW50aXR5VHlwZXMoKSB7XG4gICAgICAgIHZhciBlbnRpdGllcyA9IFtdO1xuICAgICAgICBmb3IgKHZhciBlbnRpdHkgaW4gRW50aXRpZXMpIHtcbiAgICAgICAgICAgIGVudGl0aWVzLnB1c2goZW50aXR5KTtcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIGVudGl0aWVzO1xuICAgIH0gXG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IGFwaTtcbiIsIi8vIENvcHlyaWdodCBKb3llbnQsIEluYy4gYW5kIG90aGVyIE5vZGUgY29udHJpYnV0b3JzLlxuLy9cbi8vIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhXG4vLyBjb3B5IG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlXG4vLyBcIlNvZnR3YXJlXCIpLCB0byBkZWFsIGluIHRoZSBTb2Z0d2FyZSB3aXRob3V0IHJlc3RyaWN0aW9uLCBpbmNsdWRpbmdcbi8vIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzIHRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCxcbi8vIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsIGNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0byBwZXJtaXRcbi8vIHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXMgZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvIHRoZVxuLy8gZm9sbG93aW5nIGNvbmRpdGlvbnM6XG4vL1xuLy8gVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWRcbi8vIGluIGFsbCBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLlxuLy9cbi8vIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCBcIkFTIElTXCIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1Ncbi8vIE9SIElNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0Zcbi8vIE1FUkNIQU5UQUJJTElUWSwgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4gSU5cbi8vIE5PIEVWRU5UIFNIQUxMIFRIRSBBVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLFxuLy8gREFNQUdFUyBPUiBPVEhFUiBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SXG4vLyBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSwgT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgU09GVFdBUkUgT1IgVEhFXG4vLyBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4gVEhFIFNPRlRXQVJFLlxuXG5mdW5jdGlvbiBFdmVudEVtaXR0ZXIoKSB7XG4gIHRoaXMuX2V2ZW50cyA9IHRoaXMuX2V2ZW50cyB8fCB7fTtcbiAgdGhpcy5fbWF4TGlzdGVuZXJzID0gdGhpcy5fbWF4TGlzdGVuZXJzIHx8IHVuZGVmaW5lZDtcbn1cbm1vZHVsZS5leHBvcnRzID0gRXZlbnRFbWl0dGVyO1xuXG4vLyBCYWNrd2FyZHMtY29tcGF0IHdpdGggbm9kZSAwLjEwLnhcbkV2ZW50RW1pdHRlci5FdmVudEVtaXR0ZXIgPSBFdmVudEVtaXR0ZXI7XG5cbkV2ZW50RW1pdHRlci5wcm90b3R5cGUuX2V2ZW50cyA9IHVuZGVmaW5lZDtcbkV2ZW50RW1pdHRlci5wcm90b3R5cGUuX21heExpc3RlbmVycyA9IHVuZGVmaW5lZDtcblxuLy8gQnkgZGVmYXVsdCBFdmVudEVtaXR0ZXJzIHdpbGwgcHJpbnQgYSB3YXJuaW5nIGlmIG1vcmUgdGhhbiAxMCBsaXN0ZW5lcnMgYXJlXG4vLyBhZGRlZCB0byBpdC4gVGhpcyBpcyBhIHVzZWZ1bCBkZWZhdWx0IHdoaWNoIGhlbHBzIGZpbmRpbmcgbWVtb3J5IGxlYWtzLlxuRXZlbnRFbWl0dGVyLmRlZmF1bHRNYXhMaXN0ZW5lcnMgPSAxMDtcblxuLy8gT2J2aW91c2x5IG5vdCBhbGwgRW1pdHRlcnMgc2hvdWxkIGJlIGxpbWl0ZWQgdG8gMTAuIFRoaXMgZnVuY3Rpb24gYWxsb3dzXG4vLyB0aGF0IHRvIGJlIGluY3JlYXNlZC4gU2V0IHRvIHplcm8gZm9yIHVubGltaXRlZC5cbkV2ZW50RW1pdHRlci5wcm90b3R5cGUuc2V0TWF4TGlzdGVuZXJzID0gZnVuY3Rpb24obikge1xuICBpZiAoIWlzTnVtYmVyKG4pIHx8IG4gPCAwIHx8IGlzTmFOKG4pKVxuICAgIHRocm93IFR5cGVFcnJvcignbiBtdXN0IGJlIGEgcG9zaXRpdmUgbnVtYmVyJyk7XG4gIHRoaXMuX21heExpc3RlbmVycyA9IG47XG4gIHJldHVybiB0aGlzO1xufTtcblxuRXZlbnRFbWl0dGVyLnByb3RvdHlwZS5lbWl0ID0gZnVuY3Rpb24odHlwZSkge1xuICB2YXIgZXIsIGhhbmRsZXIsIGxlbiwgYXJncywgaSwgbGlzdGVuZXJzO1xuXG4gIGlmICghdGhpcy5fZXZlbnRzKVxuICAgIHRoaXMuX2V2ZW50cyA9IHt9O1xuXG4gIC8vIElmIHRoZXJlIGlzIG5vICdlcnJvcicgZXZlbnQgbGlzdGVuZXIgdGhlbiB0aHJvdy5cbiAgaWYgKHR5cGUgPT09ICdlcnJvcicpIHtcbiAgICBpZiAoIXRoaXMuX2V2ZW50cy5lcnJvciB8fFxuICAgICAgICAoaXNPYmplY3QodGhpcy5fZXZlbnRzLmVycm9yKSAmJiAhdGhpcy5fZXZlbnRzLmVycm9yLmxlbmd0aCkpIHtcbiAgICAgIGVyID0gYXJndW1lbnRzWzFdO1xuICAgICAgaWYgKGVyIGluc3RhbmNlb2YgRXJyb3IpIHtcbiAgICAgICAgdGhyb3cgZXI7IC8vIFVuaGFuZGxlZCAnZXJyb3InIGV2ZW50XG4gICAgICB9XG4gICAgICB0aHJvdyBUeXBlRXJyb3IoJ1VuY2F1Z2h0LCB1bnNwZWNpZmllZCBcImVycm9yXCIgZXZlbnQuJyk7XG4gICAgfVxuICB9XG5cbiAgaGFuZGxlciA9IHRoaXMuX2V2ZW50c1t0eXBlXTtcblxuICBpZiAoaXNVbmRlZmluZWQoaGFuZGxlcikpXG4gICAgcmV0dXJuIGZhbHNlO1xuXG4gIGlmIChpc0Z1bmN0aW9uKGhhbmRsZXIpKSB7XG4gICAgc3dpdGNoIChhcmd1bWVudHMubGVuZ3RoKSB7XG4gICAgICAvLyBmYXN0IGNhc2VzXG4gICAgICBjYXNlIDE6XG4gICAgICAgIGhhbmRsZXIuY2FsbCh0aGlzKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDI6XG4gICAgICAgIGhhbmRsZXIuY2FsbCh0aGlzLCBhcmd1bWVudHNbMV0pO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMzpcbiAgICAgICAgaGFuZGxlci5jYWxsKHRoaXMsIGFyZ3VtZW50c1sxXSwgYXJndW1lbnRzWzJdKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICAvLyBzbG93ZXJcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIGFyZ3MgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpO1xuICAgICAgICBoYW5kbGVyLmFwcGx5KHRoaXMsIGFyZ3MpO1xuICAgIH1cbiAgfSBlbHNlIGlmIChpc09iamVjdChoYW5kbGVyKSkge1xuICAgIGFyZ3MgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpO1xuICAgIGxpc3RlbmVycyA9IGhhbmRsZXIuc2xpY2UoKTtcbiAgICBsZW4gPSBsaXN0ZW5lcnMubGVuZ3RoO1xuICAgIGZvciAoaSA9IDA7IGkgPCBsZW47IGkrKylcbiAgICAgIGxpc3RlbmVyc1tpXS5hcHBseSh0aGlzLCBhcmdzKTtcbiAgfVxuXG4gIHJldHVybiB0cnVlO1xufTtcblxuRXZlbnRFbWl0dGVyLnByb3RvdHlwZS5hZGRMaXN0ZW5lciA9IGZ1bmN0aW9uKHR5cGUsIGxpc3RlbmVyKSB7XG4gIHZhciBtO1xuXG4gIGlmICghaXNGdW5jdGlvbihsaXN0ZW5lcikpXG4gICAgdGhyb3cgVHlwZUVycm9yKCdsaXN0ZW5lciBtdXN0IGJlIGEgZnVuY3Rpb24nKTtcblxuICBpZiAoIXRoaXMuX2V2ZW50cylcbiAgICB0aGlzLl9ldmVudHMgPSB7fTtcblxuICAvLyBUbyBhdm9pZCByZWN1cnNpb24gaW4gdGhlIGNhc2UgdGhhdCB0eXBlID09PSBcIm5ld0xpc3RlbmVyXCIhIEJlZm9yZVxuICAvLyBhZGRpbmcgaXQgdG8gdGhlIGxpc3RlbmVycywgZmlyc3QgZW1pdCBcIm5ld0xpc3RlbmVyXCIuXG4gIGlmICh0aGlzLl9ldmVudHMubmV3TGlzdGVuZXIpXG4gICAgdGhpcy5lbWl0KCduZXdMaXN0ZW5lcicsIHR5cGUsXG4gICAgICAgICAgICAgIGlzRnVuY3Rpb24obGlzdGVuZXIubGlzdGVuZXIpID9cbiAgICAgICAgICAgICAgbGlzdGVuZXIubGlzdGVuZXIgOiBsaXN0ZW5lcik7XG5cbiAgaWYgKCF0aGlzLl9ldmVudHNbdHlwZV0pXG4gICAgLy8gT3B0aW1pemUgdGhlIGNhc2Ugb2Ygb25lIGxpc3RlbmVyLiBEb24ndCBuZWVkIHRoZSBleHRyYSBhcnJheSBvYmplY3QuXG4gICAgdGhpcy5fZXZlbnRzW3R5cGVdID0gbGlzdGVuZXI7XG4gIGVsc2UgaWYgKGlzT2JqZWN0KHRoaXMuX2V2ZW50c1t0eXBlXSkpXG4gICAgLy8gSWYgd2UndmUgYWxyZWFkeSBnb3QgYW4gYXJyYXksIGp1c3QgYXBwZW5kLlxuICAgIHRoaXMuX2V2ZW50c1t0eXBlXS5wdXNoKGxpc3RlbmVyKTtcbiAgZWxzZVxuICAgIC8vIEFkZGluZyB0aGUgc2Vjb25kIGVsZW1lbnQsIG5lZWQgdG8gY2hhbmdlIHRvIGFycmF5LlxuICAgIHRoaXMuX2V2ZW50c1t0eXBlXSA9IFt0aGlzLl9ldmVudHNbdHlwZV0sIGxpc3RlbmVyXTtcblxuICAvLyBDaGVjayBmb3IgbGlzdGVuZXIgbGVha1xuICBpZiAoaXNPYmplY3QodGhpcy5fZXZlbnRzW3R5cGVdKSAmJiAhdGhpcy5fZXZlbnRzW3R5cGVdLndhcm5lZCkge1xuICAgIGlmICghaXNVbmRlZmluZWQodGhpcy5fbWF4TGlzdGVuZXJzKSkge1xuICAgICAgbSA9IHRoaXMuX21heExpc3RlbmVycztcbiAgICB9IGVsc2Uge1xuICAgICAgbSA9IEV2ZW50RW1pdHRlci5kZWZhdWx0TWF4TGlzdGVuZXJzO1xuICAgIH1cblxuICAgIGlmIChtICYmIG0gPiAwICYmIHRoaXMuX2V2ZW50c1t0eXBlXS5sZW5ndGggPiBtKSB7XG4gICAgICB0aGlzLl9ldmVudHNbdHlwZV0ud2FybmVkID0gdHJ1ZTtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJyhub2RlKSB3YXJuaW5nOiBwb3NzaWJsZSBFdmVudEVtaXR0ZXIgbWVtb3J5ICcgK1xuICAgICAgICAgICAgICAgICAgICAnbGVhayBkZXRlY3RlZC4gJWQgbGlzdGVuZXJzIGFkZGVkLiAnICtcbiAgICAgICAgICAgICAgICAgICAgJ1VzZSBlbWl0dGVyLnNldE1heExpc3RlbmVycygpIHRvIGluY3JlYXNlIGxpbWl0LicsXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2V2ZW50c1t0eXBlXS5sZW5ndGgpO1xuICAgICAgaWYgKHR5cGVvZiBjb25zb2xlLnRyYWNlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgIC8vIG5vdCBzdXBwb3J0ZWQgaW4gSUUgMTBcbiAgICAgICAgY29uc29sZS50cmFjZSgpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHJldHVybiB0aGlzO1xufTtcblxuRXZlbnRFbWl0dGVyLnByb3RvdHlwZS5vbiA9IEV2ZW50RW1pdHRlci5wcm90b3R5cGUuYWRkTGlzdGVuZXI7XG5cbkV2ZW50RW1pdHRlci5wcm90b3R5cGUub25jZSA9IGZ1bmN0aW9uKHR5cGUsIGxpc3RlbmVyKSB7XG4gIGlmICghaXNGdW5jdGlvbihsaXN0ZW5lcikpXG4gICAgdGhyb3cgVHlwZUVycm9yKCdsaXN0ZW5lciBtdXN0IGJlIGEgZnVuY3Rpb24nKTtcblxuICB2YXIgZmlyZWQgPSBmYWxzZTtcblxuICBmdW5jdGlvbiBnKCkge1xuICAgIHRoaXMucmVtb3ZlTGlzdGVuZXIodHlwZSwgZyk7XG5cbiAgICBpZiAoIWZpcmVkKSB7XG4gICAgICBmaXJlZCA9IHRydWU7XG4gICAgICBsaXN0ZW5lci5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgIH1cbiAgfVxuXG4gIGcubGlzdGVuZXIgPSBsaXN0ZW5lcjtcbiAgdGhpcy5vbih0eXBlLCBnKTtcblxuICByZXR1cm4gdGhpcztcbn07XG5cbi8vIGVtaXRzIGEgJ3JlbW92ZUxpc3RlbmVyJyBldmVudCBpZmYgdGhlIGxpc3RlbmVyIHdhcyByZW1vdmVkXG5FdmVudEVtaXR0ZXIucHJvdG90eXBlLnJlbW92ZUxpc3RlbmVyID0gZnVuY3Rpb24odHlwZSwgbGlzdGVuZXIpIHtcbiAgdmFyIGxpc3QsIHBvc2l0aW9uLCBsZW5ndGgsIGk7XG5cbiAgaWYgKCFpc0Z1bmN0aW9uKGxpc3RlbmVyKSlcbiAgICB0aHJvdyBUeXBlRXJyb3IoJ2xpc3RlbmVyIG11c3QgYmUgYSBmdW5jdGlvbicpO1xuXG4gIGlmICghdGhpcy5fZXZlbnRzIHx8ICF0aGlzLl9ldmVudHNbdHlwZV0pXG4gICAgcmV0dXJuIHRoaXM7XG5cbiAgbGlzdCA9IHRoaXMuX2V2ZW50c1t0eXBlXTtcbiAgbGVuZ3RoID0gbGlzdC5sZW5ndGg7XG4gIHBvc2l0aW9uID0gLTE7XG5cbiAgaWYgKGxpc3QgPT09IGxpc3RlbmVyIHx8XG4gICAgICAoaXNGdW5jdGlvbihsaXN0Lmxpc3RlbmVyKSAmJiBsaXN0Lmxpc3RlbmVyID09PSBsaXN0ZW5lcikpIHtcbiAgICBkZWxldGUgdGhpcy5fZXZlbnRzW3R5cGVdO1xuICAgIGlmICh0aGlzLl9ldmVudHMucmVtb3ZlTGlzdGVuZXIpXG4gICAgICB0aGlzLmVtaXQoJ3JlbW92ZUxpc3RlbmVyJywgdHlwZSwgbGlzdGVuZXIpO1xuXG4gIH0gZWxzZSBpZiAoaXNPYmplY3QobGlzdCkpIHtcbiAgICBmb3IgKGkgPSBsZW5ndGg7IGktLSA+IDA7KSB7XG4gICAgICBpZiAobGlzdFtpXSA9PT0gbGlzdGVuZXIgfHxcbiAgICAgICAgICAobGlzdFtpXS5saXN0ZW5lciAmJiBsaXN0W2ldLmxpc3RlbmVyID09PSBsaXN0ZW5lcikpIHtcbiAgICAgICAgcG9zaXRpb24gPSBpO1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAocG9zaXRpb24gPCAwKVxuICAgICAgcmV0dXJuIHRoaXM7XG5cbiAgICBpZiAobGlzdC5sZW5ndGggPT09IDEpIHtcbiAgICAgIGxpc3QubGVuZ3RoID0gMDtcbiAgICAgIGRlbGV0ZSB0aGlzLl9ldmVudHNbdHlwZV07XG4gICAgfSBlbHNlIHtcbiAgICAgIGxpc3Quc3BsaWNlKHBvc2l0aW9uLCAxKTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5fZXZlbnRzLnJlbW92ZUxpc3RlbmVyKVxuICAgICAgdGhpcy5lbWl0KCdyZW1vdmVMaXN0ZW5lcicsIHR5cGUsIGxpc3RlbmVyKTtcbiAgfVxuXG4gIHJldHVybiB0aGlzO1xufTtcblxuRXZlbnRFbWl0dGVyLnByb3RvdHlwZS5yZW1vdmVBbGxMaXN0ZW5lcnMgPSBmdW5jdGlvbih0eXBlKSB7XG4gIHZhciBrZXksIGxpc3RlbmVycztcblxuICBpZiAoIXRoaXMuX2V2ZW50cylcbiAgICByZXR1cm4gdGhpcztcblxuICAvLyBub3QgbGlzdGVuaW5nIGZvciByZW1vdmVMaXN0ZW5lciwgbm8gbmVlZCB0byBlbWl0XG4gIGlmICghdGhpcy5fZXZlbnRzLnJlbW92ZUxpc3RlbmVyKSB7XG4gICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDApXG4gICAgICB0aGlzLl9ldmVudHMgPSB7fTtcbiAgICBlbHNlIGlmICh0aGlzLl9ldmVudHNbdHlwZV0pXG4gICAgICBkZWxldGUgdGhpcy5fZXZlbnRzW3R5cGVdO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgLy8gZW1pdCByZW1vdmVMaXN0ZW5lciBmb3IgYWxsIGxpc3RlbmVycyBvbiBhbGwgZXZlbnRzXG4gIGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAwKSB7XG4gICAgZm9yIChrZXkgaW4gdGhpcy5fZXZlbnRzKSB7XG4gICAgICBpZiAoa2V5ID09PSAncmVtb3ZlTGlzdGVuZXInKSBjb250aW51ZTtcbiAgICAgIHRoaXMucmVtb3ZlQWxsTGlzdGVuZXJzKGtleSk7XG4gICAgfVxuICAgIHRoaXMucmVtb3ZlQWxsTGlzdGVuZXJzKCdyZW1vdmVMaXN0ZW5lcicpO1xuICAgIHRoaXMuX2V2ZW50cyA9IHt9O1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgbGlzdGVuZXJzID0gdGhpcy5fZXZlbnRzW3R5cGVdO1xuXG4gIGlmIChpc0Z1bmN0aW9uKGxpc3RlbmVycykpIHtcbiAgICB0aGlzLnJlbW92ZUxpc3RlbmVyKHR5cGUsIGxpc3RlbmVycyk7XG4gIH0gZWxzZSBpZiAobGlzdGVuZXJzKSB7XG4gICAgLy8gTElGTyBvcmRlclxuICAgIHdoaWxlIChsaXN0ZW5lcnMubGVuZ3RoKVxuICAgICAgdGhpcy5yZW1vdmVMaXN0ZW5lcih0eXBlLCBsaXN0ZW5lcnNbbGlzdGVuZXJzLmxlbmd0aCAtIDFdKTtcbiAgfVxuICBkZWxldGUgdGhpcy5fZXZlbnRzW3R5cGVdO1xuXG4gIHJldHVybiB0aGlzO1xufTtcblxuRXZlbnRFbWl0dGVyLnByb3RvdHlwZS5saXN0ZW5lcnMgPSBmdW5jdGlvbih0eXBlKSB7XG4gIHZhciByZXQ7XG4gIGlmICghdGhpcy5fZXZlbnRzIHx8ICF0aGlzLl9ldmVudHNbdHlwZV0pXG4gICAgcmV0ID0gW107XG4gIGVsc2UgaWYgKGlzRnVuY3Rpb24odGhpcy5fZXZlbnRzW3R5cGVdKSlcbiAgICByZXQgPSBbdGhpcy5fZXZlbnRzW3R5cGVdXTtcbiAgZWxzZVxuICAgIHJldCA9IHRoaXMuX2V2ZW50c1t0eXBlXS5zbGljZSgpO1xuICByZXR1cm4gcmV0O1xufTtcblxuRXZlbnRFbWl0dGVyLnByb3RvdHlwZS5saXN0ZW5lckNvdW50ID0gZnVuY3Rpb24odHlwZSkge1xuICBpZiAodGhpcy5fZXZlbnRzKSB7XG4gICAgdmFyIGV2bGlzdGVuZXIgPSB0aGlzLl9ldmVudHNbdHlwZV07XG5cbiAgICBpZiAoaXNGdW5jdGlvbihldmxpc3RlbmVyKSlcbiAgICAgIHJldHVybiAxO1xuICAgIGVsc2UgaWYgKGV2bGlzdGVuZXIpXG4gICAgICByZXR1cm4gZXZsaXN0ZW5lci5sZW5ndGg7XG4gIH1cbiAgcmV0dXJuIDA7XG59O1xuXG5FdmVudEVtaXR0ZXIubGlzdGVuZXJDb3VudCA9IGZ1bmN0aW9uKGVtaXR0ZXIsIHR5cGUpIHtcbiAgcmV0dXJuIGVtaXR0ZXIubGlzdGVuZXJDb3VudCh0eXBlKTtcbn07XG5cbmZ1bmN0aW9uIGlzRnVuY3Rpb24oYXJnKSB7XG4gIHJldHVybiB0eXBlb2YgYXJnID09PSAnZnVuY3Rpb24nO1xufVxuXG5mdW5jdGlvbiBpc051bWJlcihhcmcpIHtcbiAgcmV0dXJuIHR5cGVvZiBhcmcgPT09ICdudW1iZXInO1xufVxuXG5mdW5jdGlvbiBpc09iamVjdChhcmcpIHtcbiAgcmV0dXJuIHR5cGVvZiBhcmcgPT09ICdvYmplY3QnICYmIGFyZyAhPT0gbnVsbDtcbn1cblxuZnVuY3Rpb24gaXNVbmRlZmluZWQoYXJnKSB7XG4gIHJldHVybiBhcmcgPT09IHZvaWQgMDtcbn1cbiJdfQ==
